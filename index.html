<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>2026 Comprehensive Exam Review Tracker</title>
    <!-- FIX: Updated favicon link -->
    <link rel="icon" href="https://raw.githubusercontent.com/ariiannemay/2026-USACOL-Comprehensive-Exam-Tracker/main/Images/usacol.png">
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    
    <!-- ADDED: Calendar Dependencies -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.29.4/moment.min.js"></script>
    <link href='https://cdnjs.cloudflare.com/ajax/libs/fullcalendar/3.10.2/fullcalendar.min.css' rel='stylesheet' />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/fullcalendar/3.10.2/fullcalendar.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <!-- END: Calendar Dependencies -->
    
    <!-- ADDED: Case Tracker Dependencies -->
    <script src="https://unpkg.com/docx@7.1.0/build/index.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js"></script>
    <!-- END: Case Tracker Dependencies -->
    
    <style>
        /* Attempt to import a decorative font for the quote */
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;700;900&family=Bebas+Neue&family=Cormorant+Garamond:ital,wght@1,600&display=swap');
        @import url('https://fonts.googleapis.com/css2?family=Dancing+Script:wght@400..700&display=swap');

        /* --- CORE AESTHETIC VARIABLES (FIXED MAROON) --- */
        :root {
            --color-primary-dark: #6D1B1B; 
            --color-secondary-gold: #FECE1B; 
            --color-light-bg: #F4F7F9;
        }
        /* Calendar Stylesheet START */
        /* Minified/Consolidated Styles */
        .calendar-wrapper{max-width:1280px;margin:0 auto;padding:0 1rem;margin-top:0;padding-bottom:1.9rem;overflow-x:hidden}.calendar-wrapper.mx-auto{max-width:1280px;padding:0}.calendar-wrapper.p-0{padding:0}#calendar-grid-container{display:grid;grid-template-columns:3fr 1fr;gap:1.5rem;align-items:start;padding:.25rem .5rem .5rem .5rem}#calendar-details{border-radius:.75rem;overflow:hidden}#calendar-details summary{background-color:var(--color-primary-dark);color:#fff;border-bottom:3px solid var(--color-secondary-gold);padding:.75rem 1.5rem;font-size:1.125rem;font-weight:700}.toggle-indicator{transition:transform .2s}#notepad-sidebar{background-color:#fff;border-radius:.75rem;box-shadow:0 4px 12px rgba(0,0,0,.1);padding:1.5rem;display:flex;flex-direction:column;border:1px solid #e5e7eb;grid-column:2}#calendar-details[data-calendar-ready=true] #notepad-sidebar{min-height:var(--calendar-height,450px)}#notepad-sidebar h3{background-color:var(--color-primary-dark);color:#fff;border-radius:.375rem .375rem 0 0;padding:.4rem .75rem;margin:calc(-1.5rem - 1px) -1.5rem .75rem -1.5rem;text-transform:uppercase;font-weight:800;font-size:.9rem;border-bottom:3px solid var(--color-secondary-gold)}#review-notes{width:100%;flex-grow:1;padding:1.5rem 1rem 1rem 1rem;font-size:.95rem;border:none;border-radius:.5rem;box-shadow:inset 0 1px 4px rgba(0,0,0,.1);resize:none;font-family:'Dancing Script',cursive;font-weight:600;line-height:1.95;color:#333;overflow-y:auto;background-color:#f7f7f7;background-image: url('https://raw.githubusercontent.com/ariiannemay/2026-Bar-Exam-Tracker/main/Images/blank-cream-notepaper.jpg');background-size:cover;background-position:center;background-repeat:no-repeat}#review-notes::placeholder{font-family:'Dancing Script',cursive;font-weight:700;color:#b33a3a;opacity:.8;transform:translateY(-5px);display:block}#calendar-content{grid-column:1;padding:0}#calendar-card{background-color:#fff;border-radius:.75rem;box-shadow:0 4px 12px rgba(0,0,0,.1);padding:0}.fc-toolbar{padding:.1rem .75rem;background-color:var(--color-primary-dark);margin-bottom:0;border:0 solid var(--color-secondary-gold);color:#fff;border-radius:.5rem;display:flex;align-items:center;font-size:.85rem}#customMonthTitle{color:#fff;font-weight:800;text-transform:uppercase;font-size:1.4em;padding:.3em .6em;margin-right:.5rem;font-family:inherit}

.fc-widget-header{background-color:var(--color-primary-dark) !important;color:#fff !important;text-transform:uppercase !important;font-weight:700 !important;padding: 0 !important;height:100%}

.fc-view-container .fc-view>table{border-top:none !important}.fc-toolbar + div{border-top:none !important}.fc-head{border-top:none !important;border-bottom:3px solid var(--color-secondary-gold) !important}#calendar{padding:0 !important}.fc-view-container{border-top:none !important}.fc-unthemed,.fc-unthemed table{border-top:none !important;border-color:transparent !important}.fc-unthemed td,.fc-unthemed th{border-color:#e5e7eb}#dateJump{display:none !important;visibility:hidden !important;position:absolute;top:0;left:0}#dateJump.temp-visible{display:block !important;visibility:visible !important;position:fixed !important;z-index:9999;width:200px;height:40px;opacity:.01;pointer-events:auto}.fc-toolbar .fc-right{flex-grow:1;display:flex;justify-content:flex-end;margin:0 !important;width:auto !important}.fc-toolbar .fc-button-group:last-child{margin-left:.5rem}.fc-toolbar .fc-button,#jumpToDateButton{padding:.3em .6em !important;line-height:1.2 !important;font-size:.75rem !important;background-color:#fff !important;color:var(--color-primary-dark) !important;border-color:var(--color-primary-dark) !important;box-shadow:none;text-transform:uppercase;font-weight:700;border-radius:.25rem;margin-left:.5rem}#jumpToDateButton{background-color:var(--color-secondary-gold) !important;color:var(--color-primary-dark) !important;border-color:var(--color-primary-dark) !important}.fc-toolbar .fc-button:hover:not(.fc-state-active),#jumpToDateButton:hover{background-color:#f0f0f0 !important;color:var(--color-primary-dark) !important}#jumpToDateButton:hover{filter:brightness(.9)}.fc-toolbar .fc-state-active,.fc-toolbar .fc-state-active:hover{background-color:var(--color-secondary-gold) !important;color:var(--color-primary-dark) !important;border-color:var(--color-primary-dark) !important}.fc-toolbar .fc-today-button.fc-state-active{background-color:var(--color-secondary-gold) !important;color:var(--color-primary-dark) !important}.fc-day-number{display:inline-block;background-color:transparent;color:#4b5563;font-weight:700;padding:2px 4px;margin-right:0;float:right;line-height:1.2;font-size:.9rem}.fc-other-month .fc-day-number{color:#9ca3af;background-color:transparent}.fc-event{border-radius:.25rem !important;border:1px solid rgba(0,0,0,.1);font-size:.6rem;font-weight:600;padding:2px 5px;white-space:normal;text-transform:uppercase}.fc-event-title-wrap{display:flex;align-items:center}.event-status-icon{font-size:.8rem;margin-right:.5rem;width:1.25rem;text-align:center}.event-icon-book{color:#fff}.modal{z-index:1000;background-color:rgba(0,0,0,.75)}.modal-content{background-color:#fff !important;padding:1.5rem;border-radius:.75rem;box-shadow:0 25px 50px -12px rgba(0, 0, 0, 0.5);min-width:300px;width:90%;max-width:500px}.syllabus-select-wrapper select{min-height:200px}
        /* Calendar Stylesheet END */

        /* -------------------------------------------------------------------------- */
        /* 1. CORE LAYOUT & TYPOGRAPHY STYLES */
        /* -------------------------------------------------------------------------- */
        
        /* Global & Countdown Styles */
        body {
            font-family: 'Inter', sans-serif;
            display: flex; 
            flex-direction: column;
        }
        .main-content-wrapper { flex-grow: 1; }
        .header-font { font-family: 'Bebas Neue', sans-serif; letter-spacing: .1em; }
        .header-bg { background-color: #6D1B1B; border-bottom: 5px solid #FECE1B; }
        .card-header-bg { background-color: #6D1B1B; }
        .time-value { font-size: 1.5rem; font-weight: 900; line-height: 1; color: #1a202c; }
        .time-label { font-size: .5rem; font-weight: 700; color: #4a5568; text-transform: uppercase; }
        .date-display-wrapper { display: inline-block; padding-bottom: 0; cursor: pointer; transition: color .2s; }
        .date-display-wrapper:hover .date-text { color: #1d4ed8; }
        .date-text { font-family: 'Bebas Neue', sans-serif; font-size: 1.75rem; font-weight: 800; color: #000000; text-transform: uppercase; letter-spacing: .15em; line-height: 1; }
        .today-date-text { font-size: 0.9rem; white-space: nowrap; font-weight: 700; line-height: 1; }
        .dashboard-footer-text { font-size: 0.65rem; margin-top: 0.5rem; }
        .text-miss { color: #000000; }
        .text-atty { color: #674ea7; }
        .text-cpa { color: #f472b6; }
        .global-app-footer { text-align: center; padding: 1rem 0; margin-top: 0.5rem; }
        .global-app-footer .quote, .global-app-footer .signature .date-text-signature { font-family: 'Cormorant Garamond', 'Times New Roman', serif; font-style: italic; font-weight: 600; font-size: 1rem; color: #4a5568; }
        .global-app-footer .signature { font-family: 'Inter', sans-serif; font-style: italic; font-weight: 600; font-size: 0.75rem; color: #4a5568; }


        /* -------------------------------------------------------------------------- */
        /* 2. DASHBOARD & SCHEDULE STYLES (Existing) */
        /* -------------------------------------------------------------------------- */

        .border-custom-yellow { border-color: #FECE1B; }
        .text-custom-yellow { color: #FECE1B; }
        .bg-chart-done { background-color: #38761d; }
        .text-chart-done { color: #38761d; }
        .bg-chart-toread { background-color: #ef4444; }
        .text-chart-toread { color: #ef4444; }
        .text-chart-title { color: #6D1B1B; font-size: 1.5rem; margin-top: 0.5rem; margin-bottom: 0.5rem; }
        
        #overall-dashboard { background-color: transparent; box-shadow: none; border: none; padding: 0; }
        .dashboard-container { display: flex; flex-wrap: wrap; padding: 0; }

.chart-panel { 
    width: 100%; 
    padding: 0 0.3rem; 
    border-bottom: 1px solid #e5e7eb; 
    background-color: #fff; 
    border-radius: 0.75rem; 
    box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06); 
}

        .schedule-panel { width: 100%; padding: 0.5rem 0.3rem; background-color: #fff; border-radius: 0.75rem; box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06); }
        
        @media (min-width: 1024px) {
            #overall-dashboard { padding: 0; }
            .dashboard-container { display: grid; grid-template-columns: 1fr 1.5rem 1fr 1.5rem 1fr; padding: 0; }
            .chart-panel { grid-column: 1 / span 1; padding: 0.5rem 1rem; border-bottom: none; }
            .schedule-panel { grid-column: 3 / span 3; padding: 0.5rem 1rem; border-left: none; }
            .dashboard-container > div:nth-child(2) { grid-column: 2 / span 1; border-right: none; }
            .chart-panel .flex-col, .chart-panel .text-center { align-items: center; text-align: center; justify-content: center; }
        }

        .pie-chart-wrapper { position: relative; display: flex; align-items: center; justify-content: center; margin: 0.5rem auto 0.1rem; width: 100%; }
        .metric-pie-side { position: absolute; font-family: 'Inter', sans-serif; font-weight: 700; font-size: 0.7rem; text-align: center; line-height: 1.2; }
        .metric-pie-side.left { right: 50%; margin-right: 105px; transform: translateY(-50%); top: 50%; }
        .metric-pie-side.right { left: 50%; margin-left: 105px; transform: translateY(-50%); top: 50%; }
        .metric-pie-side .metric-value { font-size: 1rem; font-weight: 900; }
        
        .schedule-table { width: 100%; border-collapse: collapse; font-size: 0.8rem; border: 2px solid #e5e7eb; border-radius: 0.5rem; overflow: hidden; }
        .schedule-table th, .schedule-table td { padding: 0.1rem 0.3rem; vertical-align: middle; }
        .schedule-header th { background-color: #6D1B1B; color: #FFFFFF; font-weight: 700; text-transform: uppercase; border: 2px solid #FECE1B; font-size: 0.75rem; }
        .subject-cell { font-weight: 600; color: white; padding: 0.4rem; text-align: center; border-radius: 0.5rem; box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1); font-size: 0.7rem; text-transform: uppercase; }
        .progress-bar-sparkline { width: 100%; height: 0.8rem; background-color: #e5e7eb; border-radius: 9999px; overflow: hidden; box-shadow: inset 0 1px 3px 0 rgba(0, 0, 0, 0.1); padding: 2px; }
        .bg-progress-red { background-color: #ef4444; }
        .bg-progress-orange { background-color: #f97316; }
        .bg-progress-yellow { background-color: #facc15; }
        .bg-progress-green { background-color: #10b981; }

        .sparkline-fill { height: 100%; transition: width 0.5s ease-in-out; border-radius: 9999px; box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2); border: 2px solid white; max-width: 100%; }

        .bg-poli { background-color: #795548; }
        .bg-comm { background-color: #eab308; }
        .bg-civ { background-color: #1e3a8a; }
        .bg-lab { background-color: #38761d; }
        .bg-crim { background-color: #b33a3a; }
        .bg-rem { background-color: #674ea7; }
        
        /* -------------------------------------------------------------------------- */
        /* 3. SUBJECT TRACKER STYLES (Checklist Fix Applied) */
        /* -------------------------------------------------------------------------- */

        .syllabus-panel-container { border-radius: .75rem; overflow: hidden; }
        .syllabus-summary { padding: 1rem; font-size: 1.25rem; font-weight: 700; color: white; cursor: pointer; list-style: none; display: flex; flex-direction: column; align-items: flex-start; justify-content: space-between; gap: .5rem; border-top-left-radius: .75rem; border-top-right-radius: .75rem; }
        .topic-header { padding: .75rem; font-weight: 600; color: #1f2937; display: flex; align-items: center; justify-content: space-between; cursor: pointer; list-style: none; }
        
        /* ðŸš¨ MODIFIED: Increased width for 6 columns (1.5fr for topic text, 6x 100px for material, 1x 50px for final checkmark) */
        .checklist-grid { 
            display: grid; 
            grid-template-columns: 1.5fr repeat(6, 100px) minmax(40px, 50px); 
            gap: .2rem; 
            padding: .3rem 0; 
            align-items: center; 
            border-bottom: 1px dashed #e5e7eb; 
        }
        
        /* CRITICAL CHECKBOX STYLING OVERRIDE */
        .checklist-grid input[type="checkbox"] {
            -webkit-appearance: none; -moz-appearance: none; appearance: none;
            width: 1rem; height: 1rem; border: 1px solid #d1d5db; border-radius: 0.25rem;
            cursor: pointer; transition: background-color 0.2s, border-color 0.2s;
            background-color: #ffffff; align-self: center; position: relative;
        }

        .checklist-grid input[type="checkbox"]:checked { border-color: transparent !important; }

/* NEW: Column-specific colors for CHECKED state */
        .checkbox-codal:checked { background-color: #8b5cf6 !important; } /* Violet/Rem */
        /* NEW COLUMNS */
        .checkbox-first_reading:checked { background-color: #eab308 !important; } /* Yellow/Comm */
        .checkbox-second_reading:checked { background-color: #3b82f6 !important; } /* Blue/Civ */
        .checkbox-pre_bar_notes:checked { background-color: #10b981 !important; } /* Green */
        .checkbox-pre_week:checked { background-color: #f97316 !important; } /* Orange */
        .checkbox-lmts:checked { background-color: #ef4444 !important; } /* Red */

        .checklist-grid input[type="checkbox"]:checked::before {
        content: ''; position: absolute; width: 0.25rem; height: 0.5rem;
        border: solid white; border-width: 0 2px 2px 0; top: 50%; left: 50%;
        transform: translate(-50%, -55%) rotate(45deg);
        }
        
        .checklist-grid>div:first-child { 
            padding-left: 0.125rem; 
            font-size: .875rem; 
            color: #374151; 
            display: flex; 
            flex-direction: column; 
            align-items: flex-start; 
            justify-content: center; 
            /* SAFARI FIX */
            min-width: 0;
            overflow: hidden;
            /* END SAFARI FIX */
        }
        .font-trackable-lg { font-size: 1.5rem; font-weight: 600; }
        .progress-percent-bold { font-weight: 700; font-size: .8rem; }
        .syllabus-summary-title-row { display: flex; align-items: center; justify-content: space-between; width: 100%; }
        .syllabus-progress-metrics { display: flex; flex-wrap: wrap; gap: 1.5rem; align-items: center; width: 100%; font-size: .75rem; }
        .progress-stats { display: flex; gap: .5rem; white-space: nowrap; }
        .progress-overall-text { white-space: nowrap; font-weight: 700; margin-right: .5rem; }
        .progress-bar-container { height: .75rem; background: #e5e7eb; border-radius: 9999px; overflow: hidden; width: 100%; flex-grow: 1; max-width: none; }
        .progress-bar { height: 100%; transition: width .5s ease-in-out; }
        .main-summary-chevron { transition: transform .2s; }
        .syllabus-panel[open]>.syllabus-summary .main-summary-chevron { transform: rotate(90deg); }
        .syllabus-summary::-webkit-details-marker, .topic-header::-webkit-details-marker { display: none; }
        .syllabus-content { padding: .5rem 1rem 1rem 1rem; background: white; border: 1px solid #e5e7eb; border-top: none; border-bottom-left-radius: .75rem; border-bottom-right-radius: .75rem; }
        .syllabus-sub-section { border-bottom: 1px solid #e5e7eb; margin-bottom: .5rem; }
        .chevron-icon { transition: transform .2s; display: inline-block; margin-right: .5rem; }
        .syllabus-sub-section[open]>details>.topic-header .chevron-icon { transform: rotate(90deg); }
        .depth2-details { list-style: none; margin-bottom: .25rem; border: 1px solid #f3f4f6; border-radius: .375rem; overflow: hidden; background-color: #fafafa; }
        .depth2-details>summary { list-style: none; cursor: pointer; padding: 0; background-color: #ffffff; }
        .depth2-details>summary::-webkit-details-marker { display: none; }
        .depth2-chevron { transition: transform .2s; transform: rotate(0deg); flex-shrink: 0; margin-right: .5rem; }
        .depth2-details[open] .depth2-chevron { transform: rotate(90deg); }
        .topic-content-wrapper { display: flex; align-items: flex-start; padding-left: .5rem; }
        /* ðŸš¨ MODIFIED: Matched grid template to 6 columns */
        .checklist-grid.checklist-grid-header>div:first-child { grid-column: 1 / span 1; padding-left: 0; align-items: center; text-align: center; }
        .checklist-grid.checklist-grid-header { grid-template-columns: 1.5fr repeat(6, 100px) minmax(40px, 50px); }
        .checklist-grid-micro-progress { border-bottom: 1px solid #e5e7eb; }

        .depth3-content-wrapper>div { display: block; padding: .25rem .5rem; }
        /* ðŸš¨ MODIFIED: Border on 6 columns (n+2 through n+7) */
        .checklist-grid>div:nth-child(n+2):nth-child(-n+7) { border-right: 1px dashed #d1d5db; }
        /* ðŸš¨ MODIFIED: Remove border on the 7th cell (6th material column) */
        .checklist-grid>div:nth-child(7) { border-right: none; }
        .checklist-label-capsule { font-size: .65rem; font-weight: 7-00; text-transform: uppercase; text-align: center; word-break: keep-all; padding: .15rem .35rem; border-radius: 9999px; line-height: 1; color: white; box-shadow: 0 1px 2px 0 rgba(0, 0, 0, .05); }
        .col-progress-bar-container { height: .4rem; background: #e5e7eb; border-radius: 9999px; overflow: hidden; width: 100%; }
        .col-progress-bar { height: 100%; transition: width .3s ease-in-out; }
        .status-message-row { padding-top: .25rem; padding-bottom: .25rem; }
        
        .depth3-content-wrapper>div:first-child { grid-column: 1 / span 8; padding-left: 2.5rem; }
        .depth2-topic-row { grid-column: 1 / span 1; display: flex; align-items: flex-start; }
        
        /* SUBJECT PANEL THEMES */
        .syllabus-panel-rem .syllabus-summary { background-color: #674ea7; border-left: 5px solid #8e7cc3; }
        .syllabus-panel-rem .topic-header { background-color: #ede9fe; border-left: 3px solid #8b5cf6; }
        .syllabus-checkbox-rem { accent-color: #8b5cf6; }

        .syllabus-panel-crim .syllabus-summary { background-color: #b33a3a; border-left: 5px solid #d94a4a; }
        .syllabus-panel-crim .topic-header { background-color: #fee2e2; border-left: 3px solid #ef4444; }
        .syllabus-checkbox-crim { accent-color: #ef4444; }

        .syllabus-panel-lab { --lab-color: #38761d; --lab-color-dark: #274e13; }
        .syllabus-panel-lab .syllabus-summary { background-color: var(--lab-color); border-left: 5px solid #6aa84f; }
        .syllabus-panel-lab .topic-header { background-color: #f6fff6; border-left: 3px solid var(--lab-color); }
        .syllabus-checkbox-lab { accent-color: var(--lab-color); }
        .bg-lab-button { background-color: var(--lab-color); }
        .hover\:bg-lab-button-dark:hover { background-color: var(--lab-color-dark); }

        .syllabus-panel-civ { --civ-color: #1e3a8a; --civ-color-dark: #142a63; }
        .syllabus-panel-civ .syllabus-summary { background-color: var(--civ-color); border-left: 5px solid #3b82f6; }
        .syllabus-panel-civ .topic-header { background-color: #eff6ff; border-left: 3px solid var(--civ-color); }
        .syllabus-checkbox-civ { accent-color: #2563eb; }
        .bg-civ-button { background-color: #2563eb; }
        .hover\:bg-civ-button-dark:hover { background-color: #1d4ed8; }

        .syllabus-panel-comm { --comm-color: #eab308; --comm-color-dark: #b88f06; --comm-color-light: #fefce8; --comm-checkbox-color: #eab308; }
        .syllabus-panel-comm .syllabus-summary { background-color: var(--comm-color); border-left: 5px solid #facc15; color: #000000 !important; }
        .syllabus-panel-comm .syllabus-summary i {
            color: #000000 !important; }
        .syllabus-panel-comm .syllabus-summary-title-row .flex:first-child, .syllabus-panel-comm .syllabus-progress-metrics span, .syllabus-panel-comm .syllabus-progress-metrics i { color: #000000 !important; }
        .syllabus-panel-comm .topic-header { background-color: var(--comm-color-light); border-left: 3px solid var(--comm-color); }
        .syllabus-checkbox-comm { accent-color: var(--comm-checkbox-color); }
        .bg-comm-button { background-color: var(--comm-color); }
        .hover\:bg-comm-button-dark:hover { background-color: var(--comm-color-dark); }
        
        .syllabus-panel-comm .syllabus-progress-metrics .text-gray-200 {
            color: #000000 !important;}
        
        .syllabus-panel-poli { --poli-color: #795548; --poli-color-dark: #553b32; --poli-color-light: #efe9e0; }
        .syllabus-panel-poli .syllabus-summary { background-color: var(--poli-color); border-left: 5px solid #a1887f; }
        .syllabus-panel-poli .topic-header { background-color: var(--poli-color-light); border-left: 3px solid var(--poli-color); }
        .syllabus-checkbox-poli { accent-color: var(--poli-color); }
        .bg-poli-button { background-color: var(--poli-color); }
        .hover\:bg-poli-button-dark:hover { background-color: var(--poli-color-dark); }
        /* END SUBJECT PANEL THEMES */

        /* -------------------------------------------------------------------------- */
        /* MERGED: Case Tracker Styles (Integrated from case_tracker.html) */
        /* -------------------------------------------------------------------------- */

        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&family=Bebas+Neue&family=Dancing+Script:wght@600&display=swap');
        
        :root { --maroon: #000000; --gold: #ffffff; --bg-light: #F4F7F9; }
        body { background-color: var(--bg-light); font-family: 'Inter', sans-serif; }
        .header-font { font-family: 'Bebas Neue', sans-serif; letter-spacing: 0.05em; }
        
        /* Custom Scrollbar */
        ::-webkit-scrollbar { width: 8px; height: 8px; }
        ::-webkit-scrollbar-track { background: #f1f1f1; }
        ::-webkit-scrollbar-thumb { background: #c7c7c7; border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: #a0a0a0; }

        /* Checkbox Styling */
        .custom-checkbox {
            appearance: none; background-color: #fff; margin: 0;
            font: inherit; color: currentColor; width: 1.15em; height: 1.15em;
            border: 2px solid #cbd5e1; border-radius: 0.25em; display: grid; place-content: center;
            cursor: pointer; transition: all 0.2s;
        }
        .custom-checkbox::before {
            content: ""; width: 0.65em; height: 0.65em; transform: scale(0);
            transition: 120ms transform ease-in-out; box-shadow: inset 1em 1em white;
            transform-origin: center; clip-path: polygon(14% 44%, 0 65%, 50% 100%, 100% 16%, 80% 0%, 43% 62%);
        }
.custom-checkbox:checked { background-color: #000; border-color: #000; }
        .custom-checkbox:checked::before { transform: scale(1); }
        
        /* Smooth Details Animation */
        details > summary { list-style: none; }
        details > summary::-webkit-details-marker { display: none; }
        details[open] summary ~ * { animation: sweep .3s ease-in-out; }
        @keyframes sweep {
            0%    { opacity: 0; transform: translateY(-10px); }
            100%  { opacity: 1; transform: translateY(0); }
        }

        /* Sortable Headers */
        th.sortable { cursor: pointer; user-select: none; transition: background-color 0.2s; }
th.sortable:hover { background-color: #f1f1f1; color: #000; }
        th.sortable .sort-icon { display: inline-block; margin-left: 4px; opacity: 0.3; }
        th.sortable:hover .sort-icon { opacity: 1; }

.modal-label {
    display: inline-block;
    border-bottom: 2px solid #000;
    padding-bottom: 2px;
    margin-bottom: 8px;
}

.animated-hourglass-svg {
    animation: flip 3s infinite linear; /* Flip every 3 seconds */
    transform-origin: center;
}

@keyframes flip {
    0% { transform: rotate(0deg); }
    45% { transform: rotate(0deg); }
    50% { transform: rotate(180deg); }
    95% { transform: rotate(180deg); }
    100% { transform: rotate(360deg); }
}

/* Flowing sand effect */
.sand {
    animation: flow 8s infinite linear;
}

@keyframes flow {
    0% { opacity: 1; }
    45% { opacity: 1; }
    50% { opacity: 0; } /* Sand "disappears" during flip */
    95% { opacity: 0; }
    100% { opacity: 1; }
}

/* When flipped, reverse the look */
.animated-hourglass-svg:hover { /* Optional: pause on hover */
    animation-play-state: paused;
}

#review-notes:focus {
    outline: none;
    border-right: 2px solid var(--color-secondary-gold);
}

    </style>
    <!-- Vercel Web Analytics -->
    <script defer src="/_vercel/insights/script.js"></script>
</head>

<body class="bg-gray-100 min-h-screen p-1 sm:p-2">

<div id="auth-overlay" class="fixed inset-0 z-[9999] bg-gray-100 overflow-hidden flex flex-col items-center transition-opacity duration-500">
    <div class="denial-content-container w-full max-w-[1152px] mt-1 mb-10 px-[10px]">
        
        <header class="header-bg text-white py-1 px-4 sm:py-2 sm:px-6 rounded-xl shadow-2xl mt-1">
            <div class="flex items-center justify-between">
                <div class="flex-shrink-0 w-32 h-32 flex items-center justify-center rounded-full overflow-hidden">
                    <img src="https://raw.githubusercontent.com/ariiannemay/2026-USACOL-Comprehensive-Exam-Tracker/main/Images/USA.png" alt="USA Logo" class="w-24 h-24 object-cover">
                </div>
                <div class="text-center mx-4 flex-grow">
                    <h1 class="text-xl sm:text-3xl font-extrabold header-font tracking-wider mb-2 underline" style="text-shadow: 2px 2px 0 #000000;">UNIVERSITY OF SAN AGUSTIN</h1>
                    <h2 class="text-2xl sm:text-4xl italic font-extrabold header-font tracking-widest" style="text-shadow: 2px 2px 0 #000000; line-height: 1.1; font-size: 2.75em;">2026 COMPREHENSIVE EXAM REVIEW TRACKER</h2>
                </div>
                <div class="flex-shrink-0 w-32 h-32 flex items-center justify-center rounded-full overflow-hidden">
                    <img src="https://raw.githubusercontent.com/ariiannemay/2026-USACOL-Comprehensive-Exam-Tracker/main/Images/usacol.png" alt="USACoL Icon" class="w-28 h-28 object-cover">
                </div>
            </div>
        </header>

        <div class="denial-message-box bg-[#f7f7f7] border-4 border-[#6D1B1B] rounded-[10px] shadow-[0_4px_15px_rgba(0,0,0,0.4)] p-[20px_10px_20px_10px] mt-[5px] text-center mb-[-10px]">
            <h1 class="header-font text-[#cc0000] text-[3.5em] tracking-[0.1em] mb-[2px]" style="text-shadow: 0 0 10px rgba(109, 27, 27, 0.4);">ACCESS TRACKER</h1>            
            <div class="max-w-md mx-auto px-4 mb-4">
                <input type="password" id="auth-input" 
                       class="w-full px-6 py-3 rounded-lg border-2 border-gray-300 focus:border-[#6D1B1B] outline-none text-center text-xl tracking-[0.3em] font-black mb-4"
                       placeholder="enter password here">
                <button onclick="validateAuth()" 
                        class="try-again-btn w-full bg-[#1d4ed8] text-white font-[900] py-[12px] px-[40px] rounded-[8px] shadow-[0_5px_#0f34a0] transition-all active:translate-y-[3px] active:shadow-[0_2px_#0f34a0] text-[1.2em] uppercase">
                    UNLOCK TRACKER
                </button>
            </div>

            <div class="grid grid-cols-1 lg:grid-cols-3 gap-6 mt-6">
                <div class="bg-white rounded-xl shadow-lg border border-gray-300 relative overflow-hidden">
                    <div class="flex items-center justify-between card-header-bg text-white p-2 text-lg font-bold text-center border-b-4 border-custom-yellow uppercase">
                        <i data-lucide="hourglass" class="w-6 h-6 mr-2" style="color: #FECE1B;"></i>COMPRE EXAM DAY 1<i data-lucide="hourglass" class="w-6 h-6 ml-2" style="color: #FECE1B;"></i>
                    </div>
                    <div class="p-2 text-center text-black">
                        <div class="mb-2 text-2xl header-font font-extrabold uppercase">JUNE 14, 2026</div>
                        <div class="grid grid-cols-4 py-2 border-y-2 border-dashed border-gray-300">
                            <div class="flex flex-col"><span id="auth-days-1" class="text-[1.75rem] font-black">---</span><span class="text-[0.5rem] uppercase font-bold text-gray-500">Days</span></div>
                            <div class="flex flex-col border-l-2 border-r-2 border-dashed border-gray-300"><span id="auth-hrs-1" class="text-[1.75rem] font-black">--</span><span class="text-[0.5rem] uppercase font-bold text-gray-500">Hrs</span></div>
                            <div class="flex flex-col border-r-2 border-dashed border-gray-300"><span id="auth-mins-1" class="text-[1.75rem] font-black">--</span><span class="text-[0.5rem] uppercase font-bold text-gray-500">Mins</span></div>
                            <div class="flex flex-col"><span id="auth-secs-1" class="text-[1.75rem] font-black">--</span><span class="text-[0.5rem] uppercase font-bold text-gray-500">Secs</span></div>
                        </div>
                    </div>
                </div>
                <div class="bg-white rounded-xl shadow-lg border border-gray-300 relative overflow-hidden">
                    <div class="flex items-center justify-between card-header-bg text-white p-2 text-lg font-bold text-center border-b-4 border-custom-yellow uppercase">
                        <i data-lucide="hourglass" class="w-6 h-6 mr-2" style="color: #FECE1B;"></i>COMPRE EXAM DAY 2<i data-lucide="hourglass" class="w-6 h-6 ml-2" style="color: #FECE1B;"></i>
                    </div>
                    <div class="p-2 text-center text-black">
                        <div class="mb-2 text-2xl header-font font-extrabold uppercase">JUNE 21, 2026</div>
                        <div class="grid grid-cols-4 py-2 border-y-2 border-dashed border-gray-300">
                            <div class="flex flex-col"><span id="auth-days-2" class="text-[1.75rem] font-black">---</span><span class="text-[0.5rem] uppercase font-bold text-gray-500">Days</span></div>
                            <div class="flex flex-col border-l-2 border-r-2 border-dashed border-gray-300"><span id="auth-hrs-2" class="text-[1.75rem] font-black">--</span><span class="text-[0.5rem] uppercase font-bold text-gray-500">Hrs</span></div>
                            <div class="flex flex-col border-r-2 border-dashed border-gray-300"><span id="auth-mins-2" class="text-[1.75rem] font-black">--</span><span class="text-[0.5rem] uppercase font-bold text-gray-500">Mins</span></div>
                            <div class="flex flex-col"><span id="auth-secs-2" class="text-[1.75rem] font-black">--</span><span class="text-[0.5rem] uppercase font-bold text-gray-500">Secs</span></div>
                        </div>
                    </div>
                </div>
                <div class="bg-white rounded-xl shadow-lg border border-gray-300 relative overflow-hidden">
                    <div class="flex items-center justify-between card-header-bg text-white p-2 text-lg font-bold text-center border-b-4 border-custom-yellow uppercase">
                        <i data-lucide="hourglass" class="w-6 h-6 mr-2" style="color: #FECE1B;"></i>COMPRE EXAM DAY 3<i data-lucide="hourglass" class="w-6 h-6 ml-2" style="color: #FECE1B;"></i>
                    </div>
                    <div class="p-2 text-center text-black">
                        <div class="mb-2 text-2xl header-font font-extrabold uppercase">JUNE 28, 2026</div>
                        <div class="grid grid-cols-4 py-2 border-y-2 border-dashed border-gray-300">
                            <div class="flex flex-col"><span id="auth-days-3" class="text-[1.75rem] font-black">---</span><span class="text-[0.5rem] uppercase font-bold text-gray-500">Days</span></div>
                            <div class="flex flex-col border-l-2 border-r-2 border-dashed border-gray-300"><span id="auth-hrs-3" class="text-[1.75rem] font-black">--</span><span class="text-[0.5rem] uppercase font-bold text-gray-500">Hrs</span></div>
                            <div class="flex flex-col border-r-2 border-dashed border-gray-300"><span id="auth-mins-3" class="text-[1.75rem] font-black">--</span><span class="text-[0.5rem] uppercase font-bold text-gray-500">Mins</span></div>
                            <div class="flex flex-col"><span id="auth-secs-3" class="text-[1.75rem] font-black">--</span><span class="text-[0.5rem] uppercase font-bold text-gray-500">Secs</span></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <footer class="mt-4 text-center">
            <p class="quote text-black font-semibold text-[15px]" style="font-family: 'Cormorant Garamond', serif;">Trust that your hard work will never betray you. You did not come this far to only come this far.</p>
            <p class="signature mt-1">
                <img src="https://raw.githubusercontent.com/ariiannemay/2026-USACOL-Comprehensive-Exam-Tracker/main/Images/missattycpa.PNG" alt="missattycpa signature" class="inline-block h-4">
                <span class="date-quote-style text-black ml-1 font-bold" style="font-family: 'Cormorant Garamond', serif; font-size: 0.9rem;">| november 2025</span>
            </p>
        </footer>
    </div>
</div>


    <div class="main-content-wrapper">
        <div class="max-w-6xl mx-auto space-y-2">

            <!-- 1. HEADER PANEL -->
<header class="header-bg text-white py-1 px-4 sm:py-2 sm:px-6 rounded-xl shadow-2xl">
            <div class="flex items-center justify-between">
                
                                <div class="flex-shrink-0 w-32 h-32 flex items-center justify-center rounded-full overflow-hidden">
                    <img src="https://raw.githubusercontent.com/ariiannemay/2026-USACOL-Comprehensive-Exam-Tracker/main/Images/USA.png" alt="USA Logo" class="w-24 h-24 object-cover" onerror="this.outerHTML = '<i data-lucide=\'graduation-cap\' class=\'w-full h-full object-cover\'></i>'">
                </div>
                
                <div class="text-center mx-4 flex-grow">
                    <h1 class="text-xl sm:text-3xl font-extrabold header-font tracking-wider mb-2 underline" style="text-shadow: 2px 2px 0 #000000;">
                        UNIVERSITY OF SAN AGUSTIN
                    </h1>
                    <h2 class="text-2xl sm:text-4xl italic font-extrabold header-font tracking-widest" style="text-shadow: 2px 2px 0 #000000; line-height: 1.1; font-size: 2.75em;">
                        2026 COMPREHENSIVE EXAM REVIEW TRACKER
                    </h2>
                </div>
        
                                        <div class="flex-shrink-0 w-32 h-32 flex items-center justify-center rounded-full overflow-hidden">
                        <img src="https://raw.githubusercontent.com/ariiannemay/2026-USACOL-Comprehensive-Exam-Tracker/main/Images/usacol.png" alt="USACOL Logo" class="w-28 h-28 object-cover" onerror="this.outerHTML = '<i data-lucide=\'shield\' class=\'w-full h-full object-cover\'></i>'">
                    </div>
                </div>
        </header>
        
            <!-- 2. COUNTDOWN PANELS (Hourglass color fixed to inherited white) -->
            <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                <div id="card-day-1" class="bg-white rounded-xl shadow-lg border border-gray-300 relative overflow-hidden">
                    <div class="flex items-center justify-between card-header-bg text-white p-2 text-sm font-bold text-center border-b-4 border-custom-yellow uppercase">
                        <svg class="animated-hourglass-svg w-5 h-5 text-white" viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg">    <!-- Frame -->    <path d="M20 10 H80 V20 H70 L50 40 L30 20 H20 Z" fill="none" stroke="currentColor" stroke-width="4"/>    <path d="M20 90 H80 V80 H70 L50 60 L30 80 H20 Z" fill="none" stroke="currentColor" stroke-width="4"/>    <line x1="50" y1="40" x2="50" y2="60" stroke="currentColor" stroke-width="4"/>
    <!-- Top sand (flows down) -->     <path class="sand top-sand" d="M30 20 L50 35 L70 20 Z" fill="#FECE1B"/>    
    <!-- Bottom sand (builds up) -->    <path class="sand bottom-sand" d="M30 80 L50 65 L70 80 Z" fill="#FECE1B"/></svg>COMPRE EXAM DAY 1<svg class="animated-hourglass-svg w-5 h-5 text-white" viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg">    <!-- Frame -->    <path d="M20 10 H80 V20 H70 L50 40 L30 20 H20 Z" fill="none" stroke="currentColor" stroke-width="4"/>    <path d="M20 90 H80 V80 H70 L50 60 L30 80 H20 Z" fill="none" stroke="currentColor" stroke-width="4"/>    <line x1="50" y1="40" x2="50" y2="60" stroke="currentColor" stroke-width="4"/>
    <!-- Top sand (flows down) -->     <path class="sand top-sand" d="M30 20 L50 35 L70 20 Z" fill="#FECE1B"/>    
    <!-- Bottom sand (builds up) -->    <path class="sand bottom-sand" d="M30 80 L50 65 L70 80 Z" fill="#FECE1B"/></svg>
                    </div>
                    <div class="p-2 text-center">
                        <div class="mb-2 flex justify-center items-center">
<!-- Day 1 -->
<span id="target-date-display-1" class="date-display-wrapper cursor-pointer relative inline-block">
    <input type="date" id="date-picker-1" class="absolute inset-0 w-full h-full opacity-0 cursor-pointer">
    <span class="date-text pointer-events-none"></span>
</span>

                        </div>
                        <div class="grid grid-cols-4 py-2 border-y-2 border-dashed border-gray-300">
                            <div class="flex flex-col"><span id="days-1" class="time-value">000</span><span class="time-label">Days</span></div>
                            <div class="flex flex-col border-l-2 border-r-2 border-dashed border-gray-300"><span id="hrs-1" class="time-value">00</span><span class="time-label">Hrs</span></div>
                            <div class="flex flex-col border-r-2 border-dashed border-gray-300"><span id="mins-1" class="time-value">00</span><span class="time-label">Mins</span></div>
                            <div class="flex flex-col"><span id="secs-1" class="time-value">00</span><span class="time-label">Secs</span></div>
                        </div>
                    </div>
                </div>
                <div id="card-day-2" class="bg-white rounded-xl shadow-lg border border-gray-300 relative overflow-hidden">
                    <div class="flex items-center justify-between card-header-bg text-white p-2 text-sm font-bold text-center border-b-4 border-custom-yellow uppercase">
                        <svg class="animated-hourglass-svg w-5 h-5 text-white" viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg">    <!-- Frame -->    <path d="M20 10 H80 V20 H70 L50 40 L30 20 H20 Z" fill="none" stroke="currentColor" stroke-width="4"/>    <path d="M20 90 H80 V80 H70 L50 60 L30 80 H20 Z" fill="none" stroke="currentColor" stroke-width="4"/>    <line x1="50" y1="40" x2="50" y2="60" stroke="currentColor" stroke-width="4"/>
    <!-- Top sand (flows down) -->     <path class="sand top-sand" d="M30 20 L50 35 L70 20 Z" fill="#FECE1B"/>    
    <!-- Bottom sand (builds up) -->    <path class="sand bottom-sand" d="M30 80 L50 65 L70 80 Z" fill="#FECE1B"/></svg></i>COMPRE EXAM DAY 2<svg class="animated-hourglass-svg w-5 h-5 text-white" viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg">    <!-- Frame -->    <path d="M20 10 H80 V20 H70 L50 40 L30 20 H20 Z" fill="none" stroke="currentColor" stroke-width="4"/>    <path d="M20 90 H80 V80 H70 L50 60 L30 80 H20 Z" fill="none" stroke="currentColor" stroke-width="4"/>    <line x1="50" y1="40" x2="50" y2="60" stroke="currentColor" stroke-width="4"/>
    <!-- Top sand (flows down) -->     <path class="sand top-sand" d="M30 20 L50 35 L70 20 Z" fill="#FECE1B"/>    
    <!-- Bottom sand (builds up) -->    <path class="sand bottom-sand" d="M30 80 L50 65 L70 80 Z" fill="#FECE1B"/></svg>
                    </div>
                    <div class="p-2 text-center">
                        <div class="mb-2 flex justify-center items-center">
<!-- Day 2 -->
<span id="target-date-display-2" class="date-display-wrapper cursor-pointer relative inline-block">
    <input type="date" id="date-picker-2" class="absolute inset-0 w-full h-full opacity-0 cursor-pointer">
    <span class="date-text pointer-events-none"></span>
</span>

                        </div>
                        <div class="grid grid-cols-4 py-2 border-y-2 border-dashed border-gray-300">
                            <div class="flex flex-col"><span id="days-2" class="time-value">000</span><span class="time-label">Days</span></div>
                            <div class="flex flex-col border-l-2 border-r-2 border-dashed border-gray-300"><span id="hrs-2" class="time-value">00</span><span class="time-label">Hrs</span></div>
                            <div class="flex flex-col border-r-2 border-dashed border-gray-300"><span id="mins-2" class="time-value">00</span><span class="time-label">Mins</span></div>
                            <div class="flex flex-col"><span id="secs-2" class="time-value">00</span><span class="time-label">Secs</span></div>
                        </div>
                    </div>
                </div>
                <div id="card-day-3" class="bg-white rounded-xl shadow-lg border border-gray-300 relative overflow-hidden">
                    <div class="flex items-center justify-between card-header-bg text-white p-2 text-sm font-bold text-center border-b-4 border-custom-yellow uppercase">
                        <svg class="animated-hourglass-svg w-5 h-5 text-white" viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg">    <!-- Frame -->    <path d="M20 10 H80 V20 H70 L50 40 L30 20 H20 Z" fill="none" stroke="currentColor" stroke-width="4"/>    <path d="M20 90 H80 V80 H70 L50 60 L30 80 H20 Z" fill="none" stroke="currentColor" stroke-width="4"/>    <line x1="50" y1="40" x2="50" y2="60" stroke="currentColor" stroke-width="4"/>
    <!-- Top sand (flows down) -->     <path class="sand top-sand" d="M30 20 L50 35 L70 20 Z" fill="#FECE1B"/>    
    <!-- Bottom sand (builds up) -->    <path class="sand bottom-sand" d="M30 80 L50 65 L70 80 Z" fill="#FECE1B"/></svg></i>COMPRE EXAM DAY 3<svg class="animated-hourglass-svg w-5 h-5 text-white" viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg">    <!-- Frame -->    <path d="M20 10 H80 V20 H70 L50 40 L30 20 H20 Z" fill="none" stroke="currentColor" stroke-width="4"/>    <path d="M20 90 H80 V80 H70 L50 60 L30 80 H20 Z" fill="none" stroke="currentColor" stroke-width="4"/>    <line x1="50" y1="40" x2="50" y2="60" stroke="currentColor" stroke-width="4"/>
    <!-- Top sand (flows down) -->     <path class="sand top-sand" d="M30 20 L50 35 L70 20 Z" fill="#FECE1B"/>    
    <!-- Bottom sand (builds up) -->    <path class="sand bottom-sand" d="M30 80 L50 65 L70 80 Z" fill="#FECE1B"/></svg>
                    </div>
                    <div class="p-2 text-center">
                        <div class="mb-2 flex justify-center items-center">
<!-- Day 3 -->
<span id="target-date-display-3" class="date-display-wrapper cursor-pointer relative inline-block">
    <input type="date" id="date-picker-3" class="absolute inset-0 w-full h-full opacity-0 cursor-pointer">
    <span class="date-text pointer-events-none"></span>
</span>

                        </div>
                        <div class="grid grid-cols-4 py-2 border-y-2 border-dashed border-gray-300">
                            <div class="flex flex-col"><span id="days-3" class="time-value">000</span><span class="time-label">Days</span></div>
                            <div class="flex flex-col border-l-2 border-r-2 border-dashed border-gray-300"><span id="hrs-3" class="time-value">00</span><span class="time-label">Hrs</span></div>
                            <div class="flex flex-col border-r-2 border-dashed border-gray-300"><span id="mins-3" class="time-value">00</span><span class="time-label">Mins</span></div>
                            <div class="flex flex-col"><span id="secs-3" class="time-value">00</span><span class="time-label">Secs</span></div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 3. Overall Progress (DASHBOARD) - Floating Effect -->
            <div id="overall-dashboard" class="mt-2 p-0">
                <div class="dashboard-container">
                    
                    <!-- LEFT SIDE: CHART & METRICS - Aligns with Day 1 Card -->
<div class="chart-panel py-1.5">
    
    <div class="header-bg p-0.5 rounded-lg mb-1 text-center header-font flex flex-col items-center justify-center border-b-2 border-custom-yellow">
        <span id="today-date-display" class="text-white today-date-text block font-extrabold" style="text-shadow: none;"></span>
    </div>
    
<div class="w-full flex items-center justify-center mb-1 relative"> 
    <input type="text" id="user-name-input" placeholder="Input your name here..." 
           class="w-[90%] text-center text-xl font-bold header-font border-b border-gray-300 
                  focus:border-blue-500 outline-none p-0 bg-transparent text-gray-800" 
           maxlength="30">

    <button onclick="if(confirm('Lock tracker and log out? Progress is saved.')) { localStorage.removeItem('auth_session_start'); location.reload(); }" 
            title="Lock Tracker (Logout)"
            class="absolute right-0 text-gray-400 hover:text-red-600 transition-all flex-shrink-0 hover-pulse">
        <i data-lucide="power" class="w-4 h-4"></i>
    </button>
</div>

    <h3 class="text-xl font-extrabold header-font tracking-wider text-chart-title text-center mt-1 mb-1">YOUR REVIEW PROGRESS</h3>
    
    <div class="pie-chart-wrapper" style="margin-top: 0.1rem; margin-bottom: 0.1rem;">
        <div id="global-pie-chart" class="relative" style="width: 160px; height: 160px;">
            </div>                            
                            <!-- Done Metric (Left of Pie) -->
                            <div class="metric-pie-side left">
                                <span id="global-progress-done" class="text-chart-done metric-value">0.0%</span>
                                <span class="text-chart-done block leading-tight">DONE</span>
                                <span class="text-gray-600 font-normal block leading-tight"><span id="global-total-done-count">0</span> TOPICS</span>
                            </div>

                            <!-- To Read Metric (Right of Pie, Red) -->
<div class="metric-pie-side right">
                                <span id="global-progress-toread" class="text-chart-toread metric-value">0.0%</span>
                                <span class="text-chart-toread block leading-tight">TO-READ</span>
                                <span class="text-gray-600 font-normal block leading-tight"><span id="global-total-toread-count">0</span> TOPICS</span>
                            </div>
                        </div>

                        <div class="mt-4 px-4 py-2 bg-yellow-50/30 border border-dashed border-[#B66D6D4D] rounded-lg shadow-inner">
                            <div class="flex items-center justify-between mb-1">
                                <span class="text-[10px] font-black text-[#6D1B1B] tracking-tighter flex items-center">
                                    <i data-lucide="pen-tool" class="w-3 h-3 mr-1"></i> GAERLAN PENNED CASES
                                </span>
<span id="casePercentText" class="text-[10px] font-black text-[#38761d]">0.0%</span>
                            </div>
                            <div class="w-full bg-gray-200 h-2 rounded-full overflow-hidden">
                                <div id="caseProgressBar" class="h-full bg-black transition-all duration-700" style="width: 0%"></div>
                            </div>
                            <div class="text-[7px] text-center mt-1 text-[#6D1B1B] font-bold uppercase tracking-widest" id="caseCountText">0/0 CASES READ</div>
                        </div>
                    </div>

                    <!-- Spacer Column -->
                    <div class="hidden lg:block border-r border-gray-300"></div>

                    <!-- RIGHT SIDE: SCHEDULE TABLE -->
                    <div class="schedule-panel">
                        <table class="schedule-table">
                            <thead>
                                <tr class="schedule-header">
                                    <th style="width: 20%;" class="border-b-2 border-r-2 border-t-2 border-l-2 text-white">DATE</th>
                                    <th style="width: 55%;" class="border-b-2 border-t-2 border-r-2 text-white">SUBJECT</th>
                                    <th style="width: 25%;" class="border-b-2 border-t-2 border-r-2 text-white">PROGRESS*</th>
                                </tr>
                            </thead>
                            <tbody id="schedule-table-body">
                                <!-- Rows dynamically populated by JS -->
                            </tbody>
                        </table>
                    </div>

                </div>
            </div>

            <!-- 4. SUBJECT TRACKERS (Dynamic Content) -->
            <div id="subject-trackers-container" class="space-y-4">
                
                <!-- CALENDAR MODULE INJECTION POINT (Before REM Tracker) -->
                <div id="calendar-module-placeholder"></div>
                
                <!-- Subject panels will be dynamically injected here -->
                <div id="subject-tracker-panel-rem"></div>
                <div id="subject-tracker-panel-crim"></div>
                <div id="subject-tracker-panel-lab"></div>
                <div id="subject-tracker-panel-civ"></div>
                <div id="subject-tracker-panel-comm"></div>
                <div id="subject-tracker-panel-poli"></div> 

            <!-- MERGED: Case Tracker (Placed below all subject trackers, which includes Political Law as the last one) -->
            <div class="mt-6">
                <!-- MAIN COLLAPSIBLE CARD FROM case_tracker.html -->
                <div class="bg-white rounded-xl shadow-lg border border-gray-300 overflow-hidden mb-6">       
                    <details class="group">
                        <!-- HEADER (SUMMARY) -->
<summary class="block p-0 cursor-pointer select-none transition-colors hover:bg-gray-900"
style="background-color: #000000; border-bottom: 5px solid #9ca3af;">
    <div class="flex flex-col items-start justify-between py-3 px-6 text-white gap-2">
        
        <div class="flex items-center justify-between w-full">
            <div class="flex items-center">
                <i data-lucide="pen-tool" class="w-6 h-6 mr-3"></i>
                <h1 class="text-xl sm:text-2xl font-bold uppercase tracking-tight">GAERLAN PENNED CASES</h1>
            </div>
            <div class="flex items-center text-xs">
                <span class="text-gray-300 mr-2 font-light hidden sm:inline">Press to Expand/Collapse</span>
                <i data-lucide="chevron-right" class="w-6 h-6 ml-2 transform transition-transform duration-300 group-open:rotate-90"></i>
            </div>
        </div>

<div class="flex flex-wrap items-center gap-6 w-full text-[0.7rem]">
    <div class="flex items-center gap-4 whitespace-nowrap">
        <span class="flex items-center font-bold tracking-tight uppercase"><i data-lucide="check-circle-2" class="w-4 h-4 mr-1 text-gray-200"></i>DONE:&nbsp;<span id="headerDone">0</span>&nbsp;CASES</span>
        <span class="flex items-center font-bold tracking-tight uppercase"><i data-lucide="book-open" class="w-4 h-4 mr-1 text-gray-200"></i>TO READ:&nbsp;<span id="headerRemaining">0</span>&nbsp;CASES</span>
    </div>
    
    <div class="flex items-center space-x-2 flex-grow min-w-[200px]">
        <span class="whitespace-nowrap flex items-center font-bold tracking-tight uppercase"><i data-lucide="bar-chart-3" class="w-4 h-4 mr-1"></i>OVERALL PROGRESS:</span>
                <div class="flex-grow bg-white/20 h-3 rounded-full overflow-hidden relative">
                    <div id="headerProgressBar" class="bg-white h-full rounded-full transition-all duration-700 ease-out" style="width: 0%"></div>
                </div>
                <span id="headerPercent" class="font-bold">0.0%</span>
            </div>
        </div>
    </div>
</summary>
 
                        <!-- EXPANDABLE CONTENT -->
<div class="bg-black border-t border-gray-200">
                            
<!-- 1. COMPACT TOOLBAR (Search & Filters) -->
<div class="bg-white p-2 border-b border-gray-200 flex flex-col md:flex-row gap-2 items-center justify-between sticky top-0 z-20 shadow-sm">
    
    <!-- Search + Buttons Row -->
    <div class="flex flex-col md:flex-row gap-2 w-full md:w-auto items-center">
        <div class="relative w-full md:w-80 group flex items-center">
            <i data-lucide="search" class="absolute left-3 z-10 h-4 w-4 text-gray-500 group-focus-within:text-[#00000] transition-colors pointer-events-none"></i>
            <input type="text" id="searchInput" onkeyup="filterTable()"
                   placeholder="Quick search title, date..."
                   class="w-full pl-10 pr-3 py-1.5 rounded-lg border border-gray-300 bg-white text-gray-800 text-xs font-semibold focus:outline-none focus:border-black focus:ring-1 focus:ring-black placeholder-gray-400 transition-all">
        </div>
        
        <!-- All three buttons together in one row -->
        <div class="flex gap-2">
            <button onclick="exportAllDigests()" class="px-3 py-1.5 bg-emerald-600 text-white text-[10px] font-bold uppercase rounded hover:bg-emerald-700 flex items-center gap-1">
                <i data-lucide="download" class="w-3 h-3"></i> Export All Digests
            </button>
            <button onclick="triggerImport()" class="px-3 py-1.5 bg-blue-600 text-white text-[10px] font-bold uppercase rounded hover:bg-blue-700 flex items-center gap-1">
                <i data-lucide="upload" class="w-3 h-3"></i> Import All Digests
            </button>
            <button onclick="preloadLatestDigests()" class="px-3 py-1.5 bg-purple-600 text-white text-[10px] font-bold uppercase rounded hover:bg-purple-700 flex items-center gap-1" title="Pull the latest pre-written digests from the repo">
                <i data-lucide="refresh-cw" class="w-3 h-3"></i> Preload Digests
            </button>
            <input type="file" id="importInput" class="hidden" accept=".json" onchange="importDigests(event)">
        </div>
    </div>

    <!-- Filters (Division + Type + Shown count) -->
    <div class="flex gap-2 w-full md:w-auto overflow-x-auto no-scrollbar">
        <select id="filterDivision" onchange="filterTable()" class="px-2 py-1.5 bg-gray-50 border border-gray-300 rounded text-[10px] font-bold uppercase text-gray-600 focus:outline-none focus:border-black cursor-pointer hover:bg-gray-100">
            <option value="">All Divisions</option>
            <option value="EN BANC">En Banc</option>
            <option value="1ST DIVISION">1st Division</option>
            <option value="2ND DIVISION">2nd Division</option>
            <option value="3RD DIVISION">3rd Division</option>
        </select>
        
        <select id="filterType" onchange="filterTable()" class="px-2 py-1.5 bg-gray-50 border border-gray-300 rounded text-[10px] font-bold uppercase text-gray-600 focus:outline-none focus:border-[#FECE1B] cursor-pointer hover:bg-gray-100">
            <option value="">All Types</option>
            <option value="DECISION">Decision</option>
            <option value="RESOLUTION">Resolution</option>
        </select>

        <div class="px-3 py-1.5 bg-white-50 text-[#6D1B1B] border border-white-100 rounded text-[10px] font-bold uppercase whitespace-nowrap flex items-center">
            <span id="visibleCount">0</span>&nbsp;Shown
        </div>
    </div>
</div>
  
                            <!-- 2. TABLE CONTAINER -->
<div class="overflow-x-auto" style="max-height: 75vh;">
    <table class="min-w-full divide-y divide-gray-200 relative" id="mainTable">
<thead class="bg-gray-50 sticky top-0 z-10 shadow-xs text-xs font-bold text-[#6D1B1B] uppercase tracking-wider">
    <tr>
        <th onclick="sortTable(0, 'number')" class="sortable px-2 py-1 text-left w-12 border-b border-gray-200 group whitespace-nowrap">
    <div class="flex items-center gap-1">
        <span class="text-[10px]">NO.</span>
        <i data-lucide="arrow-up-down" class="sort-icon w-2.5 h-2.5"></i>
    </div>
</th>
                                        <th onclick="sortTable(1, 'string')" class="sortable px-3 py-2 text-left border-b border-gray-200 min-w-[300px]">
                                            Case Title <i data-lucide="arrow-up-down" class="sort-icon w-3 h-3 align-middle"></i>
                                        </th>
                                        <th onclick="sortTable(2, 'string')" class="sortable px-3 py-2 text-center border-b border-gray-200 w-32">
                                            Division <i data-lucide="arrow-up-down" class="sort-icon w-3 h-3 align-middle"></i>
                                        </th>
                                        <th onclick="sortTable(3, 'date')" class="sortable px-3 py-2 text-center border-b border-gray-200 w-28">
                                            Date <i data-lucide="arrow-up-down" class="sort-icon w-3 h-3 align-middle"></i>
                                        </th>
                                        <th onclick="sortTable(4, 'string')" class="sortable px-3 py-2 text-center border-b border-gray-200 w-24">
                                            Type <i data-lucide="arrow-up-down" class="sort-icon w-3 h-3 align-middle"></i>
                                        </th>
<th class="px-3 py-2 text-center border-b border-gray-200 w-24">Digest</th>
<th class="px-3 py-2 text-center border-b border-gray-200 w-24">
    <div class="flex items-center justify-center gap-2">
        <span class="text-[10px] tracking-tighter">DONE</span>
        <input type="checkbox" id="checkAll" onclick="toggleAll(this)" class="custom-checkbox w-4 h-4">
    </div>
</th>
                                    </tr>
                                </thead>
                                <tbody id="caseTableBody" class="divide-y divide-gray-100 text-xs text-gray-700 bg-white">
                                    <!-- JS WILL INJECT ROWS HERE -->
                                </tbody>
                            </table>
                        </div>
                        
                    </div>
                </details>
            </div>

            <!-- NOTEPAD MODAL FROM case_tracker.html -->
<div id="digestModal" class="fixed inset-0 bg-black/60 backdrop-blur-sm hidden items-center justify-center z-50 p-2 transition-opacity duration-300">
    <div class="bg-white rounded-xl shadow-2xl w-full max-w-[98vw] max-h-[95vh] flex flex-col overflow-hidden transform transition-all scale-95 duration-300 ease-out" id="digestModalContent">
        
    <div class="bg-black border-b border-gray-700">
        <div class="p-3 flex justify-between items-center">
            <div class="flex items-center gap-3">
                <i data-lucide="notebook-pen" class="w-5 h-5 text-white"></i>
                <h2 class="text-sm header-font tracking-widest text-white uppercase">Case Digest Editor</h2>
            </div>
            <button onclick="closeModal()" class="text-gray-400 hover:text-white"><i data-lucide="x" class="w-5 h-5"></i></button>
        </div>
        <div class="px-4 pb-3">
            <h1 id="modalCaseTitle" class="text-xl sm:text-2xl font-black text-white uppercase tracking-tighter leading-tight drop-shadow-sm">
                Select a case...
            </h1>
        </div>
    </div>

<div class="p-3 pt-1 overflow-y-auto bg-[#f9fafb] flex-grow space-y-4">
        <input type="hidden" id="currentCaseId">

    
<div class="flex flex-col space-y-0.5 mb-2 px-1">
        <div class="flex items-center gap-2">
            <span class="text-sm font-black text-black uppercase tracking-tight">G.R. No:</span>
        <input type="text" id="noteGRNo" class="bg-transparent text-sm text-gray-800 font-bold focus:outline-none border-b border-dashed border-gray-300 flex-grow" placeholder="123556">
    </div>
    <div class="flex items-center gap-2">
        <span class="text-sm font-black text-black uppercase tracking-tight">Date:</span>
        <input type="text" id="noteCaseDate" class="bg-transparent text-sm text-gray-800 font-bold focus:outline-none border-b border-dashed border-gray-300 flex-grow" placeholder="November 21, 2003">
    </div>
</div>

<div class="bg-orange-50/50 p-2 rounded-r-lg shadow-sm border border-orange-200 border-l-[6px] border-l-orange-500">
        <label class="modal-label text-[10px] font-extrabold text-orange-700 border-orange-700 uppercase tracking-wider mb-1 block">Doctrine / Syllabus</label>
        <textarea id="noteDoctrine" class="w-full p-1 bg-transparent text-sm text-gray-800 leading-snug focus:outline-none font-bold" style="text-align: justify;" rows="3" placeholder="Enter doctrine..."></textarea>
    </div>

    <div class="bg-yellow-50/50 p-2 rounded-r-lg shadow-sm border border-yellow-200 border-l-[6px] border-l-yellow-500">
        <label class="modal-label text-[10px] font-extrabold text-yellow-700 border-yellow-700 uppercase tracking-wider mb-1 block">Facts</label>
        <textarea id="noteFacts" class="w-full p-1 bg-transparent text-sm text-gray-700 focus:outline-none font-bold" style="text-align: justify;" rows="5" placeholder="Brief facts..."></textarea>
    </div>

    <div class="bg-green-50/50 p-2 rounded-r-lg shadow-sm border border-green-200 border-l-[6px] border-l-green-500">
        <label class="modal-label text-[10px] font-extrabold text-green-700 border-green-700 uppercase tracking-wider mb-1 block">Issue/s</label>
        <textarea id="noteIssue" class="w-full p-1 bg-transparent text-sm text-gray-700 focus:outline-none font-bold" style="text-align: justify;" rows="3" placeholder="Legal issues..."></textarea>
    </div>

<div class="bg-pink-50/50 p-2 rounded-r-lg shadow-sm border border-pink-200 border-l-[6px] border-l-pink-500">
    <label class="modal-label text-[10px] font-extrabold text-pink-700 border-pink-700 uppercase tracking-wider mb-1 block">Ruling</label>
    <textarea id="noteRuling" class="w-full p-1 bg-transparent text-sm text-gray-700 focus:outline-none font-bold" style="text-align: justify;" rows="5" placeholder="Court's ruling..."></textarea>
</div>

    <div class="bg-red-50/50 p-2 rounded-r-lg shadow-sm border border-red-200 border-l-[6px] border-l-red-500">
        <label class="modal-label text-[10px] font-extrabold text-red-700 border-red-700 uppercase tracking-wider mb-1 block">Dispositive Portion</label>
        <textarea id="noteDispositive" class="w-full p-1 bg-transparent text-sm text-gray-700 focus:outline-none font-bold" style="text-align: justify;" rows="5" placeholder="WHEREFORE, premises considered..." ></textarea>
    </div>

<div class="bg-white px-4 py-2 border-t border-gray-100 flex justify-between items-center">
    <span class="text-[10px] text-gray-400 italic">Auto-saves on 'Save'</span>
    <div class="flex gap-2 items-center">
        <button onclick="exportSingleDigest()" class="px-3 py-1.5 bg-emerald-600 text-white text-[10px] font-bold uppercase rounded hover:bg-emerald-700 flex items-center gap-1">
            <i data-lucide="file-text" class="w-3 h-3"></i> Export
        </button>
        <button onclick="triggerImport()" class="px-3 py-1.5 bg-blue-600 text-white text-[10px] font-bold uppercase rounded hover:bg-blue-700 flex items-center gap-1">
            <i data-lucide="upload" class="w-3 h-3"></i> Import
        </button>
        
        <button onclick="closeModal()" class="px-3 py-1.5 text-gray-500 font-bold text-[10px] uppercase hover:bg-gray-100 rounded">Cancel</button>
        
        <button onclick="saveDigest()" class="px-5 py-2 bg-black text-white font-bold text-[10px] uppercase rounded shadow-md hover:bg-gray-800 border-b-4 border-gray-500 active:border-b-0 active:translate-y-1 transition-all flex items-center gap-2">
            <i data-lucide="save" class="w-3.5 h-3.5"></i> Save Digest
        </button>
    </div>
</div>
        </div>
    </div>
</div>
            </div> <!-- End Case Tracker -->


            <!-- 5. GLOBAL DATA MANAGEMENT BUTTONS (UPDATED) -->
            <div class="max-w-6xl mx-auto mt-6 mb-6 flex space-x-3 px-2 sm:px-0">
                <button onclick="exportAllData()" class="flex-1 px-3 py-2 bg-green-600 text-white font-semibold text-sm rounded-lg shadow-lg hover:bg-green-700 transition duration-150 uppercase flex items-center justify-center">
                    <i data-lucide="download-cloud" class="w-4 h-4 mr-1"></i> Export All Data
                </button>
                <button onclick="document.getElementById('global-file-input').click()" class="flex-1 px-3 py-2 bg-blue-600 text-white font-semibold text-sm rounded-lg shadow-lg hover:bg-blue-700 transition duration-150 uppercase flex items-center justify-center">
                    <i data-lucide="upload-cloud" class="w-4 h-4 mr-1"></i> Import Existing Data
                </button>
            </div>

<input type="file" id="global-file-input" class="hidden" accept=".json" onchange="importAllData(event)">
            
            <!-- START: AESTHETIC CLOUD NOTE BLOCK -->
            <div class="max-w-6xl mx-auto mt-8 mb-6 px-4 sm:px-0">
                <div class="bg-blue-50/70 backdrop-blur-sm border border-blue-200 shadow-xl p-5 rounded-xl transition duration-300 hover:shadow-2xl hover:border-blue-300">
                    <p class="font-bold text-sm text-blue-800 mb-2 flex items-center">
                        <i data-lucide="cloud" class="w-4 h-4 mr-2 text-blue-500"></i>
                        TRACKER LIMITATIONS
                    </p>
                    <ul class="list-disc list-outside ml-5 text-[11px] text-gray-700 space-y-2">
                        <li class="pl-1">
                            <strong style="color: #6D1B1B;">Progress Metric:</strong> Overall progress updates and a topic counts as â€œdoneâ€ only once <strong>4 out of 6 boxes</strong> per topic row are checked.
                        </li>
                        <li class="pl-1">
                            <strong style="color: #6D1B1B;">Data Portability:</strong> Your review progress is saved <strong>only within your current browser</strong> (Local Storage). Your data will not be synchronized automatically if you clear your browsing data or switch devices. To transfer your progress to a new device or browser, please use the <strong>Export All Data</strong> and <strong>Import Existing Data</strong> functions.
                        </li>
<li class="pl-1">
    <strong style="color: #6D1B1B;">Device Compatibility:</strong> This tracker is optimized for <strong>Laptop/Desktop</strong> use to ensure all features and layouts render correctly.
</li>
                        <li class="pl-1">
                            <strong style="color: #6D1B1B;">Other Trackers:</strong> Access the <a href="https://2026bar-reviewtracker.vercel.app/" target="_blank" class="text-blue-500 underline hover:text-blue-700 font-bold">2026 Bar Tracker</a> here // Access the <a href="https://docs.google.com/spreadsheets/d/1jGPx2rF3xePovioGsDeAyXhWuXMQeU5xXrEefAW5V8s/edit?usp=sharing" target="_blank" class="text-blue-500 underline hover:text-blue-700 font-bold">2026 Comprehensive Exam Tracker (Google Sheets version)</a> here.
                        </li>

                    </ul>
                </div>
            </div>
            <!-- END: AESTHETIC CLOUD NOTE BLOCK -->

        </div>
    </div>

        </div> <!-- end max-w-6xl -->
    </div> <!-- end main-content-wrapper -->

    <!-- GLOBAL FOOTER -->
    <footer class="global-app-footer">
        <p class="quote">
            Trust that your hard work will never betray you. You did not come this far to only come this far.
        </p>
        <p class="signature mt-1">
            <img src="https://raw.githubusercontent.com/ariiannemay/2026-Bar-Exam-Tracker/main/Images/missattycpa.PNG" 
                 alt="missattycpa signature" 
                 class="inline-block h-3.5"
                 onerror="this.outerHTML = '<span class=\'text-miss\'>made by miss</span><span class=\'text-atty\'>atty</span><span class=\'text-cpa\'>cpa</span>'">
            <span class="date-text-signature">| november 2025</span>
        </p>
    </footer>

    <script>
const ALLOWED_PASSWORDS = ["ama", "bar", "2026", "bar2026"];
const AUTH_TARGET_DATES = ["2026-07-12", "2026-07-19", "2026-07-26"];

function updateAuthCountdown() {
    const now = new Date();
    AUTH_TARGET_DATES.forEach((dateStr, i) => {
        const id = i + 1;
        const target = new Date(dateStr + 'T00:00:00Z');
        const diff = target - now;
        
        if (diff > 0) {
            document.getElementById(`auth-days-${id}`).textContent = Math.floor(diff / (1000 * 60 * 60 * 24)).toString().padStart(3, '0');
            document.getElementById(`auth-hrs-${id}`).textContent = Math.floor((diff % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60)).toString().padStart(2, '0');
            document.getElementById(`auth-mins-${id}`).textContent = Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60)).toString().padStart(2, '0');
            document.getElementById(`auth-secs-${id}`).textContent = Math.floor((diff % (1000 * 60)) / 1000).toString().padStart(2, '0');
        }
    });
}

// 1. Move validateAuth UP so the listener can see it
// 1. Defined globally so the listener can see it immediately
window.validateAuth = function() {
    const input = document.getElementById('auth-input');
    if (ALLOWED_PASSWORDS.includes(input.value.trim().toLowerCase())) {
        // Save current timestamp to local storage
        localStorage.setItem('auth_session_start', Date.now());
        document.getElementById('auth-overlay').style.display = "none";
        document.body.style.overflow = "auto";
    } else {
        window.location.href = 'denied.html';
    }
};


function checkAccess() {
    const overlay = document.getElementById('auth-overlay');
    const sessionStart = localStorage.getItem('auth_session_start');
    const sevenDaysInMs = 7 * 24 * 60 * 60 * 1000;

    // Check if session exists and is within 7 days
    if (sessionStart && (Date.now() - sessionStart < sevenDaysInMs)) {
        overlay.style.display = "none";
        document.body.style.overflow = "auto";
        document.body.style.display = "block";
    } else {
        // No session or expired: show the portal
        document.body.style.display = "block";
        document.body.style.overflow = "hidden";
        overlay.style.display = "flex";
        
        setTimeout(() => { 
            const input = document.getElementById('auth-input');
            if(input) input.focus(); 
        }, 50);
    }
    
    setInterval(updateAuthCountdown, 1000);
    updateAuthCountdown();
}

// 2. Event listener for the Enter key
document.addEventListener('keydown', function(e) {
    const overlay = document.getElementById('auth-overlay');
    if (e.key === 'Enter' && overlay && overlay.style.display !== 'none') {
        e.preventDefault(); 
        validateAuth();
    }
});

checkAccess();

        // --- INLINED CALENDAR MODULE HTML CONTENT ---
        const CALENDAR_MODULE_HTML = `
            <div id="calendar-module-container" class="mt-4">
                <div class="calendar-wrapper mx-auto max-w-6xl p-0">
                    <details id="calendar-details" class="bg-white rounded-xl shadow-lg border border-gray-300" open>
                        <summary class="flex justify-between items-center p-4 font-bold text-lg cursor-pointer select-none" style="background-color: #6D1B1B; color: white; border-bottom: 3px solid #FECE1B;">
                            <div class="summary-title-content text-2xl flex-grow text-center flex items-center justify-center gap-2">
                                <i class="fa-solid fa-calendar-days"></i>
                                <span>REVIEW CALENDAR</span>
                                <i class="fa-solid fa-calendar-days"></i>
                            </div>
                            <span class="text-white text-sm toggle-indicator">
                                <i class="fa-solid fa-chevron-down"></i>
                            </span>
                        </summary>
                         
                        <div id="calendar-grid-container" style="display: grid; grid-template-columns: 3fr 1fr; gap: 1.5rem; align-items: start; padding: 0.25rem 0.5rem 0.5rem 0.5rem;"> 
                             
                            <div id="calendar-content" style="grid-column: 1; padding: 0;">
                                <div id='calendar-card' style="background-color: white; border-radius: 0.75rem; box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1); padding: 0;">
                                    <div class="fc-toolbar fc-header-toolbar flex justify-between items-center p-2 rounded-lg border-1 border-secondary-gold" style="background-color: #6D1B1B;">
                                        <div class="fc-left flex items-center">
                                            <span id="customMonthTitle" class="text-secondary-gold font-extrabold text-lg" style="color: #fff;"></span>
                                            <div class="fc-button-group ml-4">
                                                <button type="button" class="fc-today-button fc-button fc-state-default fc-corner-left fc-corner-right" onclick="window.CALENDAR_APP.setActiveButton(this, 'today'); $('#calendar').fullCalendar('today')">today</button>
                                            </div>
                                            <div class="fc-button-group ml-1">
                                                <button type="button" class="fc-month-button fc-button fc-state-default fc-corner-left" onclick="window.CALENDAR_APP.setActiveButton(this); $('#calendar').fullCalendar('changeView', 'month')">month</button>
                                                <button type="button" class="fc-basicWeek-button fc-button fc-state-default" onclick="window.CALENDAR_APP.setActiveButton(this); $('#calendar').fullCalendar('changeView', 'basicWeek')">week</button>
                                                <button type="button" class="fc-basicDay-button fc-button fc-state-default fc-corner-right" onclick="window.CALENDAR_APP.setActiveButton(this); $('#calendar').fullCalendar('changeView', 'basicDay')">day</button>
                                            </div>
                                            <button id="jumpToDateButton" type="button" onclick="window.CALENDAR_APP.toggleDateJumpPicker()" class="fc-button fc-state-default font-inter ml-4" style="background-color: #FECE1B !important; color: #6D1B1B !important; border-color: #6D1B1B !important;">JUMP TO DATE</button>
                                        </div>
                                        <div class="fc-right flex items-center">
                                            <div class="fc-button-group">
                                                <button type="button" class="fc-prev-button fc-button fc-state-default fc-corner-left" onclick="$('#calendar').fullCalendar('prev')"><i class="fa-solid fa-chevron-left"></i></button>
                                                <button type="button" class="fc-next-button fc-button fc-state-default fc-corner-right" onclick="$('#calendar').fullCalendar('next')"><i class="fa-solid fa-chevron-right"></i></button>
                                            </div>
                                        </div>
                                    </div>
                                    <div id='calendar'></div>
                                </div>
                            </div>
                            <div id="notepad-sidebar" style="background-color: #FFF; border-radius: 1.0rem; box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1); padding: 1.5rem; display: flex; flex-direction: column; border: 1px solid #e5e7eb; grid-column: 2;">
<h3 class="text-4xl font-bold uppercase" 
    style="
        background-color: #6D1B1B; 
        color: white; 
        border-bottom: 3px solid #FECE1B;
        /* Increase internal vertical padding for height balance */
        padding: 0.75rem 1.5rem; 
        /* Ensure the font size stays maximized */
        font-size: 1.25rem; 
        font-weight: 800;
        line-height: 1.1;
    "
>
    <!-- INCREASE ICON SIZE -->
    <i class="fa-solid fas fa-pencil-alt mr-2" style="font-size: 1.25rem; vertical-align: middle;"></i>
    NOTES
</h3>                                <div class="flex space-x-2 mb-3">
                                    <button onclick="window.CALENDAR_APP.undoNotes()" class="text-xs px-2 py-1 bg-gray-200 text-gray-700 rounded-md hover:bg-gray-300 transition duration-150 flex items-center" title="Undo Last Change">
                                        <i class="fa-solid fa-undo mr-1"></i> Undo
                                    </button>
                                    <button onclick="window.CALENDAR_APP.redoNotes()" class="text-xs px-2 py-1 bg-gray-200 text-gray-700 rounded-md hover:bg-gray-300 transition duration-150 flex items-center" title="Redo Last Undo">
                                        <i class="fa-solid fa-redo mr-1"></i> Redo
                                    </button>
                                    <button onclick="window.CALENDAR_APP.clearNotes()" class="text-xs px-2 py-1 bg-red-100 text-red-600 rounded-md hover:bg-red-200 transition duration-150 flex items-center" title="Clear All Notes">
                                        <i class="fa-solid fa-eraser mr-1"></i> Clear
                                    </button>
                                    <button onclick="window.CALENDAR_APP.copyNotes()" class="text-xs px-2 py-1 bg-blue-100 text-blue-600 rounded-md hover:bg-blue-200 transition duration-150 flex items-center" title="Copy Notes to Clipboard">
                                        <i class="fa-solid fa-copy mr-1"></i> Copy
                                    </button>
                                </div>
                                <textarea 
                                    id="review-notes" 
placeholder="Input your notes here...&#10;&#10;WHEREFORE, it is most respectfully prayed that the reviewee be awarded a passing score, no less than 75%, more preferably 85%+, with grace, confidence, and faith...."
                                    oninput="window.CALENDAR_APP.saveNotes()"
                                    style="font-family: 'Dancing Script', cursive; font-weight: 600; line-height: 1.95; padding: 1.5rem 1.0rem 1.0rem 1.0rem; flex-grow: 1; resize: none;"
                                ></textarea>
                            </div>
                             
                        </div>
                    </details>
                </div>
                 
                <div id="topicModal" class="modal fixed inset-0 flex items-center justify-center hidden">
                    <div class="modal-content" style="background-color: white; border-radius: 0.75rem; box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.5); width: 90%; max-width: 500px; padding: 1.5rem;">
                        <h2 id="modalTitle" class="text-xl font-bold mb-4 text-gray-800">SCHEDULE NEW EVENT OR TOPIC</h2>
                        <input type="hidden" id="topicEventId">
                        <input type="hidden" id="originalStart">
                        <input type="hidden" id="originalEnd">
                        
                        <div class="mb-4">
                            <label for="eventNameInput" class="block text-sm font-medium text-gray-700">1. EVENT NAME (FOR REST DAYS, BIRTHDAYS, ETC.)</label>
                            <input type="text" id="eventNameInput" placeholder="Optional: Enter a custom event name" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-2 border focus:border-green-600 focus:ring focus:ring-green-600 focus:ring-opacity-50">
                        </div>

                        <div class="mb-4">
                            <label for="subjectSelect" class="block text-sm font-medium text-gray-700">2. OR: SELECT SUBJECT (FOR STUDY TASKS)</label>
                            <select id="subjectSelect" onchange="window.CALENDAR_APP.populateTopics()" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-red-600 focus:ring focus:ring-red-600 focus:ring-opacity-50 p-2 border">
                                <option value="">-- SELECT A SUBJECT --</option>
                            </select>
                        </div>
                         
                        <div class="mb-4">
                            <label for="topicSelect" class="block text-sm font-medium text-gray-700">3. SELECT TOPIC/TASK (DEPTH 1)</label>
                            <div class="syllabus-select-wrapper">
                                <select id="topicSelect" size="8" class="block w-full border-gray-300 focus:border-red-600 focus:ring focus:ring-red-600 focus:ring-red-600 focus:ring-opacity-50 text-sm p-2 border">
                                    <option value="">-- SELECT A TOPIC --</option>
                                </select>
                            </div>
                            <p class="text-xs text-red-500 mt-1" id="topic-error" hidden>PLEASE SELECT A SPECIFIC TOPIC.</p>
                        </div>
                         
                        <div class="grid grid-cols-2 gap-4 mb-4">
                            <div>
                                <label for="topicStart" class="block text-sm font-medium text-gray-700">START DATE</label>
                                <input type="date" id="topicStart" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-2 border">
                            </div>
                            <div>
                                <label for="topicEnd" class="block text-sm font-medium text-gray-700">END DATE (OPTIONAL)</label>
                                <input type="date" id="topicEnd" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-2 border">
                            </div>
                        </div>
                        <div class="flex justify-between items-center mt-6">
                            <button onclick="window.CALENDAR_APP.closeTopicModal()" class="px-4 py-2 text-gray-600 bg-gray-200 rounded-lg hover:bg-gray-300 transition duration-150">CANCEL</button>
                            <div class="flex space-x-2">
                                <button id="deleteTopicBtn" onclick="window.CALENDAR_APP.deleteTopicTask()" class="px-4 py-2 text-white bg-red-500 rounded-lg hover:bg-red-600 transition duration-150 hidden">DELETE</button>
                                <button id="saveTopicBtn" onclick="window.CALENDAR_APP.saveTopicTask()" class="px-4 py-2 text-white bg-red-600 rounded-lg hover:bg-red-700 transition duration-150">SCHEDULE TASK</button>
                            </div>
                        </div>
                    </div>
                     
                </div>
                 
                <div id="custom-alert-modal" class="modal fixed inset-0 flex items-center justify-center hidden">
                    <div class="modal-content max-w-sm p-6 rounded-xl text-center">
                        <h3 id="alertTitle" class="text-lg font-bold mb-3 text-gray-800">ALERT</h3>
                        <p id="alertMessage" class="text-sm text-gray-700 mb-4"></p>
                        <div class="flex justify-end">
                            <button onclick="window.CALENDAR_APP.closeCustomAlert()" class="px-4 py-2 text-white bg-red-600 rounded-lg hover:bg-red-700 transition duration-150">OK</button>
                        </div>
                    </div>
                </div>
                <!-- Hidden input to trigger native date picker, positioned absolutely initially -->
                <input type="date" id="dateJump" onchange="window.CALENDAR_APP.jumpToDate(this.value)"> 
                 
            </div>
        `;
        // --- END INLINED CALENDAR MODULE HTML CONTENT ---

        
        // --- CORE UTILITY AND COUNTDOWN LOGIC (REMAINS IN INDEX) ---
        
        // ðŸš¨ MODIFIED: Added two columns, renamed existing columns
        const CHECKLIST_COLUMNS = ['codal', 'first_reading', 'second_reading', 'pre_bar_notes', 'pre_week', 'lmts'];
        const COUNTDOWN_DATA = [
            {id:1,targetDate:localStorage.getItem('comp_exam_date_1')||'2026-07-12'},
            {id:2,targetDate:localStorage.getItem('comp_exam_date_2')||'2026-07-19'},
            {id:3,targetDate:localStorage.getItem('comp_exam_date_3')||'2026-07-26'}
        ];
        
        const DOM_ELEMENTS = {
            modal: document.getElementById('date-edit-modal'),
            modalTitle: document.getElementById('modal-title'),
            dateInput: document.getElementById('new-target-date'),
            saveBtn: document.getElementById('modal-save-btn'),
            cancelBtn: document.getElementById('modal-cancel-btn'),
            errorMsg: document.getElementById('modal-error'),
            globalFileInput: document.getElementById('global-file-input'),
            messageModal: document.getElementById('message-modal'),
            messageModalTitle: document.getElementById('message-modal-title'),
            messageModalContent: document.getElementById('message-modal-content'),
            messageModalCloseBtn: document.getElementById('message-modal-close-btn'),
            subjectContainer: document.getElementById('subject-trackers-container')
        };
        
        let currentEditingId = null;
        const SUBJECT_LOGIC_MAP = {};
        const ALL_SUBJECT_STORAGE_KEYS = [
            'rem_ethics_progress', 'crim_progress', 'lab_progress', 
            'civ_progress', 'comm_tax_progress', 'poli_progress'
        ];


        // --- Schedule Data (Central source of truth for table) ---
        const SCHEDULE_DATA = [
            { id: 1, dateId: 1, day: 'SUNDAY', subject: 'Political and Public International Law', weight: '15%', subjectName: 'poli' },
            { id: 2, dateId: 1, day: 'SUNDAY', subject: 'Commercial and Taxation Laws', weight: '20%', subjectName: 'comm' },
            { id: 3, dateId: 2, day: 'SUNDAY', subject: 'Civil Law and Land Titles and Deeds', weight: '20%', subjectName: 'civ' },
            { id: 4, dateId: 2, day: 'SUNDAY', subject: 'Labor and Social Legislation', weight: '10%', subjectName: 'lab' },
            { id: 5, dateId: 3, day: 'SUNDAY', subject: 'Criminal Law', weight: '10%', subjectName: 'crim' },
            { id: 6, dateId: 3, day: 'SUNDAY', subject: 'Remedial Law, Legal Ethics, & Legal Forms', weight: '25%', subjectName: 'rem' }
        ];

        function updateScheduleTable() {
            const tableBody = document.getElementById('schedule-table-body');
            if (!tableBody) return;

            let html = '';
            let lastDateId = null;
            
            // ðŸš¨ MODIFIED: Updated threshold from 3 to 4
            const DONE_THRESHOLD = 4;

            SCHEDULE_DATA.forEach((item, index) => {
                const countdownData = COUNTDOWN_DATA.find(d => d.id === item.dateId);
                const dateString = countdownData ? countdownData.targetDate : 'N/A';
                
                let dayOfWeek = item.day;
                let displayDate = dateString;
                if (dateString !== 'N/A') {
                    const dateObj = new Date(dateString + 'T00:00:00Z');
                    if (!isNaN(dateObj)) {
                        dayOfWeek = dateObj.toLocaleDateString('en-US', { weekday: 'long' }).toUpperCase();
                        displayDate = dateObj.toLocaleDateString('en-US', { month: 'long', day: 'numeric', year: 'numeric' });
                    }
                }
                
                const subjectLogic = SUBJECT_LOGIC_MAP[item.subjectName];
                
                let progressPercent = '0.0';
                let progressFraction = 0;
                
                if (subjectLogic) {
                    // CRITICAL: This pulls the Syllabus data from the EXTERNAL JS file via SUBJECT_LOGIC_MAP
                    const progress = subjectLogic.getProgress();
                    const syllabusData = subjectLogic.SYLLABUS_DATA;
                    const mainTopics = syllabusData.filter(t => t.depth === 2 && t.trackable);
                    const currentSubjectTrackable = mainTopics.length;
                    let currentSubjectDone = 0;

                    mainTopics.forEach(topic => {
                        const topicProgress = progress[topic.id] || {};
                        const boxesTicked = CHECKLIST_COLUMNS.filter(col => topicProgress[col] === true).length;
                        if (boxesTicked >= DONE_THRESHOLD) { // ðŸš¨ MODIFIED: Uses DONE_THRESHOLD
                            currentSubjectDone++;
                        }
                    });
                    progressFraction = currentSubjectTrackable > 0 ? (currentSubjectDone / currentSubjectTrackable) : 0;
                    progressPercent = (progressFraction * 100).toFixed(1);
                }
                
                let progressClass;
                if (progressFraction <= 0.25) { progressClass = 'bg-progress-red'; } 
                else if (progressFraction <= 0.5) { progressClass = 'bg-progress-orange'; } 
                else if (progressFraction <= 0.75) { progressClass = 'bg-progress-yellow'; } 
                else { progressClass = 'bg-progress-green'; }


                let dateCell = '';
                if (item.dateId !== lastDateId) {
                    dateCell = `<td rowspan="2" class="text-center font-bold text-sm border-r border-gray-300">
                                    ${displayDate.toUpperCase()}<br><span class="text-gray-400 font-normal text-xs">${dayOfWeek}</span>
                                </td>`;
                    lastDateId = item.dateId;
                }

                const rowClass = (index + 1) % 2 === 0 ? 'border-b-2 border-gray-300/50' : 'border-b border-gray-200';
                
                html += `
                    <tr class="${rowClass}">
                        ${dateCell}
                        <td class="border-r border-gray-300">
                            <div class="subject-cell bg-${item.subjectName}" data-subject="${item.subjectName}">
                                ${item.subject} <span class="font-normal">(${item.weight})</span>
                            </div>
                        </td>
                        <td>
                            <div class="text-center text-sm font-semibold mb-0.5">${progressPercent}%</div>
                            <div id="sparkline-${item.subjectName}" class="progress-bar-sparkline">
                                <div class="sparkline-fill ${progressClass}" style="width: ${progressPercent}%;"></div>
                            </div>
                        </td>
                    </tr>
                `;
            });

    // Aesthetic Quote Row
// Aesthetic Quote Row with Purple Dashed Lines and Styled Buttons
    html += `
        <tr>
            <td colspan="3" class="p-2 border-none">
                <div class="bg-yellow-50/30 border border-dashed border-[#B66D6D4D] rounded-xl p-3 relative flex flex-col justify-center items-center text-center italic mt-2">
                    <button onclick="window.changeQuote(-1)" 
                            class="absolute left-2 p-1 text-[#FECE1B] hover:bg-[#6D1B1B] hover:text-white rounded-full transition-all duration-200 z-30">
                        <i data-lucide="chevron-left" class="w-4 h-4"></i>
                    </button>
                    
<p id="quoteText" 
                       class="text-[12px] sm:text-sm text-[#6D1B1B] font-medium leading-relaxed px-10 italic" 
                       style="font-family: 'Cormorant Garamond', cursive; letter-spacing: 0.5px;">
                        "${MOTIVATIONAL_QUOTES[currentQuoteIndex]}"
                    </p>
                    
                    <button onclick="window.changeQuote(1)" 
                            class="absolute right-2 p-1 text-[#FECE1B] hover:bg-[#6D1B1B] hover:text-white rounded-full transition-all duration-200 z-30">
                        <i data-lucide="chevron-right" class="w-4 h-4"></i>
                    </button>
                </div>
            </td>
        </tr>`;
    tableBody.innerHTML = html;
    if (window.lucide) lucide.createIcons();
}
        // --- User Name Storage/Loading ---
        const USER_NAME_KEY = 'user_display_name';
        const EMOJI = 'âœ¨';

        function loadUserName() {
            const nameInput = document.getElementById('user-name-input');
            const savedName = localStorage.getItem(USER_NAME_KEY);
            if (nameInput) {
                nameInput.value = savedName ? `Welcome, ${savedName}! ${EMOJI}` : '';
                nameInput.placeholder = 'Input your name here...';
                
                nameInput.addEventListener('change', (event) => {
                    let name = event.target.value.replace(/^Welcome,\s?/, '').replace('!', '').replace(EMOJI, '').trim();
                    
                    if (name) {
                        localStorage.setItem(USER_NAME_KEY, name);
                        event.target.value = `Welcome, ${name}! ${EMOJI}`;
                    } else {
                        localStorage.removeItem(USER_NAME_KEY);
                        event.target.value = '';
                        event.target.placeholder = 'Input your name here...';
                    }
                });
            }
        }

        // Utility Functions
        function formatUniqueDate(dateString){
            if(!dateString)return'';
            const date=new Date(dateString+'T00:00:00');
            return date.toLocaleDateString('en-US',{year:'numeric',month:'long',day:'numeric'}).toUpperCase();
        }
        
        function getLocalDisplayDate() {
            const now = new Date();
            const dateOptions = { year: 'numeric', month: 'long', day: 'numeric' };
            const weekdayOptions = { weekday: 'long' };

            const datePart = now.toLocaleDateString('en-US', dateOptions).toUpperCase();
            const weekdayPart = now.toLocaleDateString('en-US', weekdayOptions).toUpperCase();
            const timeOptions = { hour: 'numeric', minute: '2-digit', hour12: true };
            const timeText = now.toLocaleTimeString('en-US', timeOptions).toUpperCase();
            
            return `TODAY IS ${datePart} | ${weekdayPart} | ${timeText}`;
        }

        function formatNumber(num){return num.toString().padStart(num>=100?3:2,'0');}
        function downloadFile(data,filename,type){const blob=new Blob([data],{type:type});const url=URL.createObjectURL(blob);const a=document.createElement('a');a.href=url;a.download=filename;document.body.appendChild(a);a.click();document.body.removeChild(a);URL.revokeObjectURL(url);}
        function showMessageModal(title,content){
            const modal=DOM_ELEMENTS.messageModal;
            const titleEl=DOM_ELEMENTS.messageModalTitle;
            const contentEl=DOM_ELEMENTS.messageModalContent;
            if(titleEl)titleEl.textContent=title;
            if(contentEl)contentEl.innerHTML=content;
            
            const actionsEl=document.getElementById('modal-actions');
            if(actionsEl){
                actionsEl.innerHTML=`\n<button id="message-modal-close-btn" class="px-3 py-1.5 text-sm font-semibold bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 transition duration-150">Close</button>\n`;
                document.getElementById('message-modal-close-btn')?.addEventListener('click', closeMessageModal);
            }
            if(modal){
                modal.classList.remove('hidden');
                modal.style.display='flex';
            }
        }
        function closeMessageModal(){DOM_ELEMENTS.messageModal.classList.add('hidden');DOM_ELEMENTS.messageModal.style.display='none';}
        
        // Countdown Logic
        function calculateCountdown(targetDateString,id){const now=new Date();const target=new Date(targetDateString+'T00:00:00Z');if(target<=now){const elements=[`days-${id}`,`hrs-${id}`,`mins-${id}`,`secs-${id}`];elements.forEach(elId=>{const el=document.getElementById(elId);if(el)el.textContent=elId===`days-${id}`?'000':'00';});return;}const diffInMilliseconds=target-now;const days=Math.floor(diffInMilliseconds/(1000*60*60*24));const hours=Math.floor(diffInMilliseconds%(1000*60*60*24)/(1000*60*60));const minutes=Math.floor(diffInMilliseconds%(1000*60*60)/(1000*60));const seconds=Math.floor(diffInMilliseconds%(1000*60)/1000);document.getElementById(`days-${id}`).textContent=formatNumber(days);document.getElementById(`hrs-${id}`).textContent=formatNumber(hours);document.getElementById(`mins-${id}`).textContent=formatNumber(minutes);document.getElementById(`secs-${id}`).textContent=formatNumber(seconds);}
        function updateAllCountdowns(){COUNTDOWN_DATA.forEach(data=>{calculateCountdown(data.targetDate,data.id);});}
        function openModal(id){currentEditingId=id;const data=COUNTDOWN_DATA.find(d=>d.id===id);document.getElementById('modal-title').textContent=`Edit Target Date - Day ${id}`;document.getElementById('new-target-date').value=data.targetDate;document.getElementById('modal-error').classList.add('hidden');document.getElementById('date-edit-modal').classList.remove('hidden');document.getElementById('date-edit-modal').style.display='flex';}
        function closeModal(){document.getElementById('date-edit-modal').classList.add('hidden');document.getElementById('date-edit-modal').style.display='none';currentEditingId=null;}
        
function saveModal(){
            const newDateString=document.getElementById('new-target-date').value;
            const newDate=new Date(newDateString);
            const now=new Date();
            if(newDate<=now||!newDateString){
                document.getElementById('modal-error').textContent="Please select a future date.";
                document.getElementById('modal-error').classList.remove('hidden');
                return;
            }
            const data=COUNTDOWN_DATA.find(d=>d.id===currentEditingId);
            if(data){
                data.targetDate=newDateString;
                document.querySelector(`#target-date-display-${currentEditingId} .date-text`).textContent = formatUniqueDate(newDateString);
                localStorage.setItem(`comp_exam_date_${currentEditingId}`,newDateString);
                
                // --- TRIGGER REFRESHES ---
                updateAllCountdowns();   // Updates the countdown numbers
                updateScheduleTable();   // Updates the Date/Subject table rows
                
                // Updates the "Exam Day" markers in the Calendar module
                if (window.CALENDAR_APP && typeof window.CALENDAR_APP.refreshCalendar === 'function') {
                    window.CALENDAR_APP.refreshCalendar();
                }
            }
            closeModal();
        }

        // Global File Upload Handler
        function handleFileUpload(event){
            const file = event.target.files[0];
            const targetSubject = event.target.dataset.targetSubject;
            
            if (file && targetSubject && SUBJECT_LOGIC_MAP[targetSubject]) {
                SUBJECT_LOGIC_MAP[targetSubject].processImport(file);
            } else if (!file) {
                showMessageModal("Upload Canceled", "No file was selected for upload.");
            } else {
                showMessageModal("Upload Error", "Could not determine the target subject for the upload.");
            }
            event.target.value = '';
        }

        // --- GLOBAL EXPORT/IMPORT FUNCTIONS (UPDATED) ---

        function exportAllData() {
            const data = {};
            
            // 1. Gather fixed data (Name, Countdown Dates)
            data.user_name = localStorage.getItem(USER_NAME_KEY) || null;
            
            data.dates = {};
            COUNTDOWN_DATA.forEach((d) => {
                data.dates[`comp_exam_date_${d.id}`] = localStorage.getItem(`comp_exam_date_${d.id}`);
            });

            // 2. Gather all subject data
            data.subjects = {};
            ALL_SUBJECT_STORAGE_KEYS.forEach(key => {
                 const progress = localStorage.getItem(key);
                 if (progress) {
                     try {
                         data.subjects[key] = JSON.parse(progress);
                     } catch(e) {
                         data.subjects[key] = {};
                     }
                 }
            });

            // 3. Gather Calendar and Notepad data
            if (window.CALENDAR_APP) {
                data.calendar_events = localStorage.getItem(window.CALENDAR_APP.CALENDAR_EVENTS_KEY);
                data.notepad_content = localStorage.getItem(window.CALENDAR_APP.NOTEPAD_CONTENT_KEY);
            }


            const jsonString = JSON.stringify(data, null, 2);
            downloadFile(jsonString, 'comprehensive-review-tracker-backup.json', 'application/json');
            showMessageModal("Export Complete", "<p class='text-green-600'>All data (progress, dates, name, calendar, and notes) has been downloaded as **comprehensive-review-tracker-backup.json**</p>");
        }
        
        function importAllData(event) {
            const file = event.target.files[0];
            event.target.value = '';

            if (!file || !file.name.endsWith('.json')) {
                showMessageModal("Import Error", "<p class='text-red-600'>Please select a valid .json file for import.</p>");
                return;
            }
            
            const reader = new FileReader();
            reader.onload = function(e) {
                const jsonString = e.target.result;
                try {
                    const importedData = JSON.parse(jsonString);
                    if (typeof importedData !== 'object' || importedData === null) {
                         throw new Error("Invalid file structure.");
                    }
                    
                    let subjectsImported = 0;
                    let calendarRefreshed = false;

                    // 1. Import Subject Data
                    if (importedData.subjects) {
                        Object.keys(importedData.subjects).forEach(key => {
                            if (ALL_SUBJECT_STORAGE_KEYS.includes(key)) {
                                localStorage.setItem(key, JSON.stringify(importedData.subjects[key]));
                                subjectsImported++;
                            }
                        });
                    }
                    
                    // 2. Import Calendar and Notepad data
                    if (window.CALENDAR_APP) {
                        if (importedData.calendar_events) {
                             localStorage.setItem(window.CALENDAR_APP.CALENDAR_EVENTS_KEY, importedData.calendar_events);
                             calendarRefreshed = true;
                        }
                        if (importedData.notepad_content) {
                             localStorage.setItem(window.CALENDAR_APP.NOTEPAD_CONTENT_KEY, importedData.notepad_content);
                             window.CALENDAR_APP.setNotes(importedData.notepad_content);
                        }
                    }

                    // 3. Import User Name
                    if (importedData.user_name) {
                        localStorage.setItem(USER_NAME_KEY, importedData.user_name);
                        loadUserName();
                    } else {
                        localStorage.removeItem(USER_NAME_KEY);
                        loadUserName();
                    }

                    // 4. Import Dates
                    if (importedData.dates) {
                        Object.keys(importedData.dates).forEach(key => {
                            if (key.startsWith('comp_exam_date_')) {
                                localStorage.setItem(key, importedData.dates[key]);
                            }
                        });
                    }

                    // 5. Update UI: Re-render everything
                    COUNTDOWN_DATA.forEach(data => {
                        const savedDate = localStorage.getItem(`comp_exam_date_${data.id}`);
                        data.targetDate = savedDate || data.targetDate;
                        document.querySelector(`#target-date-display-${data.id} .date-text`).textContent = formatUniqueDate(data.targetDate);
                    });
                    updateAllCountdowns();

                    // The logic maps might not be fully initialized here if external JS fails, but we try anyway.
                    Object.values(SUBJECT_LOGIC_MAP).forEach(logic => {
                        // This calls the render function defined in the external JS
                        logic.render();
                    });
                    window.updateOverallDashboard();

                    if (window.CALENDAR_APP && calendarRefreshed) {
                         window.CALENDAR_APP.refreshCalendar();
                    }

                    showMessageModal("Import Success", `<p class='text-green-600'>Successfully imported data for ${subjectsImported} subjects, dates, name, calendar, and notes. The tracker has been refreshed.</p>`);

                } catch (e) {
                    console.error("Global Import error:", e);
                    showMessageModal("Import Failed", `<p class='text-red-600'>Failed to import data. Please ensure the file is a valid JSON backup from this tracker. Error: ${e.message}</p>`);
                }
            };
            reader.onerror = function() { showMessageModal("Import Error", `<p class='text-red-600'>Error reading the file.</p>`); };
            reader.readAsText(file);
        }

        window.exportAllData = exportAllData;
        window.importAllData = importAllData;

        // --- END GLOBAL EXPORT/IMPORT FUNCTIONS ---


        // Subject Logic Loader - MODIFIED TO LOAD EXTERNAL JS
        function loadSubjectPanel(subjectName, filePath) {
            const script = document.createElement('script');
            script.src = filePath;
            script.type = 'text/javascript';
            script.onload = () => {
                // 1. Instantiate the logic object (The function is now defined in the external file)
                const logicCreator = window[`create${subjectName.toUpperCase()}_LOGIC`];
                if (logicCreator) {
                    const logic = logicCreator(); // This calls the creator function in the external script
                    SUBJECT_LOGIC_MAP[subjectName] = logic;
                    
                    // 2. Inject the panel structure 
                    const panelPlaceholder = document.getElementById(`subject-tracker-panel-${subjectName}`);
                    if (panelPlaceholder) {
                        const newPanelHtml = logic.getPanelHtmlWrapper(logic.SUBJECT_NAME, logic.SUBJECT_TITLE, logic.SUBJECT_ICON);
                        panelPlaceholder.outerHTML = newPanelHtml;
                    }
                    
                    // 3. Re-attach event listeners and render
                    const currentLogic = SUBJECT_LOGIC_MAP[subjectName];
                    
                    window.requestAnimationFrame(() => {
                        const collapseBtn = document.getElementById(`collapse-all-btn-${subjectName}`);
                        collapseBtn?.addEventListener('click', currentLogic.toggleAllSections);
                        currentLogic.render(); // This uses the full syllabus data loaded inside the external JS
                    });
                } else {
                    console.error(`Failed to find initialization function for ${subjectName}. Check external JS file.`);
                }
            };
            document.head.appendChild(script);
        }
        
        // --- GLOBAL DASHBOARD LOGIC (drawPieChart, updateScheduleTable, updateOverallDashboard remain unchanged) ---
        // ... (Functions omitted for brevity, they remain as they were in the previous step)
        
        // --- CALENDAR DATA SOURCE (SIMPLIFIED FOR CALENDAR ONLY) ---
        // This is the new, minimal data source for the Calendar's dropdowns.
        // It ONLY contains Depth 1 topics and the necessary metadata (id, topic, color, shortTitle)
        // Note: The topics here must match the topics in the external JS files!
        const CONSOLIDATED_SYLLABUS = {
            poli: { title: 'POLITICAL AND PUBLIC INTERNATIONAL LAW', shortTitle: 'POLI LAW', color: '#795548', 
                data: [
                    {id: 5001, topic: "I. BASIC CONCEPTS", depth: 1, trackable: true},
                    {id: 5007, topic: "II. NATIONAL TERRITORY", depth: 1, trackable: true},
                    {id: 5012, topic: "III. CITIZENSHIP", depth: 1, trackable: true},
                    {id: 5016, topic: "IV. LEGISLATIVE DEPARTMENT", depth: 1, trackable: true},
                    {id: 5022, topic: "V. EXECUTIVE DEPARTMENT", depth: 1, trackable: true},
                    {id: 5028, topic: "VI. JUDICIAL DEPARTMENT", depth: 1, trackable: true},
                    {id: 5033, topic: "VII. CONSTITUTIONAL COMMISSIONS", depth: 1, trackable: true},
                    {id: 5036, topic: "VIII. CONSTITUTIONAL RIGHTS", depth: 1, trackable: true},
                    {id: 5045, topic: "IX. NATIONAL ECONOMY AND PATRIMONY", depth: 1, trackable: true},
                    {id: 5048, topic: "X. ADMINISTRATIVE LAW", depth: 1, trackable: true},
                    {id: 5052, topic: "XI. LAW ON PUBLIC OFFICERS", depth: 1, trackable: true},
                    {id: 5056, topic: "XII. ELECTION LAW", depth: 1, trackable: true},
                    {id: 5060, topic: "XIII. LOCAL GOVERNMENTS", depth: 1, trackable: true},
                    {id: 5064, topic: "XIV. PUBLIC INTERNATIONAL LAW", depth: 1, trackable: true},
                ]
            },
            comm: { title: 'COMMERCIAL AND TAXATION LAWS', shortTitle: 'COMM & TAX', color: '#eab308', 
                data: [
                    {id: 4001, topic: 'I. BUSINESS ORGANIZATIONS', depth: 1, trackable: true},
                    {id: 4005, topic: 'II. INSURANCE (P.D. NO. 612, AS AMENDED BY R.A. NO. 10607)', depth: 1, trackable: true},
                    {id: 4010, topic: 'III. TRANSPORTATION', depth: 1, trackable: true},
                    {id: 4014, topic: 'IV. BANKING', depth: 1, trackable: true},
                    {id: 4019, topic: 'V. INTELLECTUAL PROPERTY â€“ R.A. NO. 8293, AS AMENDED', depth: 1, trackable: true},
                    {id: 4023, topic: 'VI. SPECIAL COMMERCIAL LAWS', depth: 1, trackable: true},
                    {id: 4027, topic: 'VII. TAXATION LAW', depth: 1, trackable: true},
                ]
            },
            civ: { title: 'CIVIL LAW AND LAND TITLES AND DEEDS', shortTitle: 'CIVIL LAW', color: '#1e3a8a', 
                data: [
                    {id:3001,topic:"I. EFFECT AND APPLICATION OF LAWS",depth:1, trackable:true},
                    {id:3011,topic:"II. PERSONS AND FAMILY RELATIONS",depth:1, trackable:true},
                    {id:3024,topic:"III. PROPERTY, OWNERSHIP, AND ITS MODIFICATIONS",depth:1, trackable:true},
                    {id:3035,topic:"IV. SUCCESSION",depth:1, trackable:true},
                    {id:3041,topic:"V. OBLIGATIONS AND CONTRACTS",depth:1, trackable:true},
                    {id:3046,topic:"VI. SPECIAL CONTRACTS",depth:1, trackable:true},
                    {id:3053,topic:"VII. TORTS AND QUASI-DELICTS",depth:1, trackable:true},
                ]
            },
            lab: { title: 'LABOR AND SOCIAL LEGISLATION', shortTitle: 'LABOR LAW', color: '#38761d', 
                data: [
                    {id:2001,topic:"I. BASIC PRINCIPLES AND CONCEPTS",depth:1, trackable:true},
                    {id:2008,topic:"II. RECRUITMENT AND PLACEMENT",depth:1, trackable:true},
                    {id:2014,topic:"III. EMPLOYMENT RELATIONSHIP",depth:1, trackable:true},
                    {id:2019,topic:"IV. LABOR STANDARDS",depth:1, trackable:true},
                    {id:2025,topic:"V. LABOR RELATIONS",depth:1, trackable:true},
                    {id:2031,topic:"VI. SUSPENSION AND TERMINATION OF EMPLOYMENT",depth:1, trackable:true},
                    {id:2037,topic:"VII. SOCIAL LEGISLATION",depth:1, trackable:true},
                    {id:2042,topic:"VIII. LABOR ADJUDICATION: JURISDICTION & REMEDIES",depth:1, trackable:true},
                ]
            },
            crim: { title: 'CRIMINAL LAW', shortTitle: 'CRIM LAW', color: '#b33a3a', 
                data: [
                    {id:1001,topic:"I. FUNDAMENTAL PRINCIPLES",depth:1, trackable: true},
                    {id:1013,topic:"II. FELONIES AND CRIMINAL LIABILITY (RPC BOOK 1 AND RELATED LAWS)",depth:1, trackable: true},
                    {id:1032,topic:"III. CRIMES AND THEIR PENALTIES (RPC BOOK 2 AND RELATED SPECIAL LAWS)",depth:1, trackable: true},
                ]
            },
            rem: { title: 'REMEDIAL LAW, LEGAL ETHICS, & LEGAL FORMS', shortTitle: 'REM LAW', color: '#674ea7', 
                data: [
                    {id:1,topic:"I. GENERAL PRINCIPLES",depth:1, trackable: true},
                    {id:9,topic:"II. JURISDICTION",depth:1, trackable: true},
                    {id:43,topic:"III. CIVIL PROCEDURE (Rules of Court, as amended by A.M. No. 19-10-20-SC)",depth:1, trackable: true},
                    {id:158,topic:"V. PROVISIONAL REMEDIES",depth:1, trackable: true},
                    {id:174,topic:"VI. SPECIAL CIVIL ACTIONS",depth:1, trackable: true},
                    {id:190,topic:"VII. SPECIAL PROCEEDINGS AND WRITS",depth:1, trackable: true},
                    {id:217,topic:"VIII. CRIMINAL PROCEDURE",depth:1, trackable: true},
                    {id:335,topic:"IX. EVIDENCE",depth:1, trackable: true},
                    {id:414,topic:"X. LEGAL AND JUDICIAL ETHICS",depth:1, trackable: true},
                    {id:583,topic:"XI. PRACTICAL EXERCISES",depth:1, trackable: true},
                ]
            },
        };
        const CALENDAR_EVENTS_KEY = 'review_calendar_events';
        const NOTEPAD_CONTENT_KEY = 'review_notepad_content'; 
        const CALENDAR_SUBJECT_KEYS = Object.keys(CONSOLIDATED_SYLLABUS);
        const history = { stack: [], current: 0 };
        const MAX_HISTORY = 30;
        
        let calendarInstance = null;

        function pushHistory(content) {
            if (history.current < history.stack.length - 1) {
                history.stack = history.stack.slice(0, history.current + 1);
            }
            history.stack.push(content);
            if (history.stack.length > MAX_HISTORY) {
                history.stack.shift(); 
            }
            history.current = history.stack.length - 1;
        }

        function loadNotes() {
            const notes = localStorage.getItem(NOTEPAD_CONTENT_KEY);
            $('#review-notes').val(notes || '');
            if (notes) {
                pushHistory(notes);
            } else {
                pushHistory('');
            }
            history.current = history.stack.length - 1;
        }

function saveNotes() {
    const notes = document.getElementById('review-notes').value;
    // Direct key usage prevents conflicts
    localStorage.setItem('review_notepad_content', notes);
    
    if (history.stack[history.current] !== notes) {
        pushHistory(notes);
    }
}

function applyNotesContent(content) {
            const noteArea = document.getElementById('review-notes');
            if (noteArea) noteArea.value = content;
            localStorage.setItem('review_notepad_content', content);
        }

        function undoNotes() {
            if (history.current > 0) {
                history.current--;
                applyNotesContent(history.stack[history.current]);
            } else {
                CALENDAR_APP.showCustomAlert("NO UNDO", "NO EARLIER HISTORY FOUND.");
            }
        }
        function redoNotes() {
            if (history.current < history.stack.length - 1) {
                history.current++;
                applyNotesContent(history.stack[history.current]);
            } else {
                CALENDAR_APP.showCustomAlert("NO REDO", "NO FUTURE HISTORY FOUND.");
            }
        }
        function clearNotes() {
            // FIX: Removed window.confirm() and replaced with CALENDAR_APP.showCustomAlert 
            // Note: Cannot use confirm() in this limited environment. Assuming user confirmation via a custom modal is required.
            // Since we can't implement complex custom confirmation flow here, we'll implement a simplified clear.
            if (confirm("ARE YOU SURE YOU WANT TO CLEAR ALL NOTES? THIS ACTION CAN BE UNDONE.")) {
                 applyNotesContent("");
                 pushHistory("");
             }
        }
        function copyNotes() {
            const notes = $('#review-notes').val();
            if (!notes) {
                CALENDAR_APP.showCustomAlert("COPY FAILED", "NO CONTENT TO COPY.");
                return;
            }
            const textarea = document.getElementById('review-notes');
            textarea.select();
            
            try {
                document.execCommand('copy');
                CALENDAR_APP.showCustomAlert("COPY COMPLETE", "NOTES COPIED TO CLIPBOARD.");
            } catch (err) {
                CALENDAR_APP.showCustomAlert("COPY FAILED", "UNABLE TO COPY NOTES TO CLIPBOARD.");
            }
        }

        function getExamDates() {
            // Accessing global COUNTDOWN_DATA defined in the main script
            return COUNTDOWN_DATA.map(examData => {
                const dateString = localStorage.getItem(`comp_exam_date_${examData.id}`) || examData.targetDate;
                const examTitle = `EXAM - DAY ${examData.id}`;
                return { 
                    id: `exam-${examData.id}`, 
                    title: examTitle.toUpperCase(), 
                    start: dateString, 
                    end: dateString, 
                    allDay: true,
                    backgroundColor: 'red', 
                    textColor: '#FFFFF',
                    borderColor: '#FECE1B',
                    className: 'exam-day-marker',
                    editable: false 
                };
            });
        }
        
        function showCustomAlert(title, message) {
            // Uses elements defined within the CALENDAR_MODULE_HTML template
            $('#custom-alert-modal #alertTitle').text(title.toUpperCase());
            const formattedMessage = message.toUpperCase().replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>');
            $('#custom-alert-modal #alertMessage').html(formattedMessage);
            $('#custom-alert-modal').removeClass('hidden').css('display', 'flex');
        }
        function closeCustomAlert() {
            $('#custom-alert-modal').addClass('hidden').css('display', 'none');
        }

        function getEventsFromLocalStorage() {
            try {
                const data = localStorage.getItem(CALENDAR_EVENTS_KEY);
                return data ? JSON.parse(data) : [];
            } catch (e) {
                console.error("ERROR READING CALENDAR FROM LOCAL STORAGE:", e);
                return [];
            }
        }
        function saveEventsToLocalStorage(events) {
            try {
                localStorage.setItem(CALENDAR_EVENTS_KEY, JSON.stringify(events));
            } catch (e) {
                console.error("ERROR SAVING CALENDAR TO LOCAL STORAGE:", e);
                CALENDAR_APP.showCustomAlert("STORAGE ERROR", "COULD NOT SAVE EVENTS. LOCAL STORAGE MIGHT BE FULL.");
            }
        }
        
        function generateUniqueId() {
            return 'event-' + Date.now() + Math.random().toString(36).substring(2, 9);
        }
        function populateSubjectSelect() {
            const select = $('#subjectSelect');
            select.empty();
            select.append('<option value="">-- SELECT A SUBJECT --</option>');
            CALENDAR_SUBJECT_KEYS.forEach(key => {
                select.append(`<option value="${key}">${CONSOLIDATED_SYLLABUS[key].title.toUpperCase()}</option>`);
            });
            populateTopics(); 
        }
        
        // CRITICAL: This function must fetch topic data from the loaded SUBJECT_LOGIC_MAP 
        // because CONSOLIDATED_SYLLABUS only holds Depth 1 topics now.
        function populateTopics(selectedTopicId = null) {
            const subjectKey = $('#subjectSelect').val();
            const select = $('#topicSelect');
            select.empty();
            $('#topic-error').attr('hidden', true);
            
            if (!subjectKey) {
                select.append('<option value="">-- SELECT A SUBJECT FIRST --</option>');
                select.prop('disabled', true);
                return;
            }
            select.prop('disabled', false);
            select.append('<option value="">-- SELECT A TOPIC --</option>');
            
            // *** FIX: Get the full syllabus data from the externally loaded logic map ***
            const subjectLogic = SUBJECT_LOGIC_MAP[subjectKey];
            if (!subjectLogic || !subjectLogic.SYLLABUS_DATA) {
                 select.append('<option value="">-- SYLLABUS DATA NOT YET LOADED --</option>');
                 return;
            }
            const data = subjectLogic.SYLLABUS_DATA;
            // Filter only the Depth 1 Topics (or the main trackable sections) for the calendar dropdown
            const topicsToSchedule = data.filter(item => item.depth === 1); // Filtering by Depth 1 seems safer based on your provided calendar list
            // *************************************************************************
            
            topicsToSchedule.forEach(item => {
                const topicText = item.topic.toUpperCase();
                const optionValue = `${item.id}|${topicText}`; 
                const isSelected = item.id == selectedTopicId ? 'selected' : '';
                
                select.append(`<option value="${optionValue}" data-topic-id="${item.id}" ${isSelected}>${topicText}</option>`);
            });
            
            if (selectedTopicId) {
                const correctValue = select.find(`option[data-topic-id="${selectedTopicId}"]`).val();
                if (correctValue) {
                   select.val(correctValue);
                }
            }
        }

        function openTopicModal(dateStr = null, event = null) {
            $('#topicEventId').val('');
            $('#topicStart').val(dateStr || moment().format('YYYY-MM-DD'));
            $('#topicEnd').val('');
            $('#subjectSelect').val('');
            $('#eventNameInput').val('');
            $('#deleteTopicBtn').addClass('hidden');
            $('#modalTitle').text('SCHEDULE NEW EVENT OR TOPIC');
            $('#saveTopicBtn').text('SCHEDULE TASK');
            $('#topic-error').attr('hidden', true);
            
            // This relies on CONSOLIDATED_SYLLABUS
            populateSubjectSelect(); 
            
            if (event) {
                $('#topicEventId').val(event.id);
                $('#topicStart').val(event.start.format('YYYY-MM-DD'));
                $('#topicEnd').val(event.end ? event.end.clone().subtract(1, 'days').format('YYYY-MM-DD') : '');
                
                if (event.subjectKey === 'CUSTOM') {
                    $('#eventNameInput').val(event.title); 
                    $('#subjectSelect').val(''); 
                    populateTopics();
                } else {
                    $('#subjectSelect').val(event.subjectKey);
                    // Pass the topicId for selection in the newly populated list
                    populateTopics(event.topicId); 
                }

                $('#modalTitle').text('EDIT SCHEDULED ITEM');
                $('#saveTopicBtn').text('UPDATE ITEM');
                $('#deleteTopicBtn').removeClass('hidden');
            }
            $('#topicModal').removeClass('hidden').css('display', 'flex');
        }

        function closeTopicModal() {
            $('#topicModal').addClass('hidden').css('display', 'none');
            if (calendarInstance) {
                calendarInstance.fullCalendar('refetchEvents');
            }
        }

        function saveTopicTask() {
            const eventId = $('#topicEventId').val();
            const eventName = $('#eventNameInput').val().trim();
const subjectKey = $('#subjectSelect').val();
            // ðŸš¨ DEFINITIVE FIX: Use the native DOM element to ensure we capture the 
            // value property reliably, as jQuery's :selected selector can fail in size>1 lists.
            const topicSelectElement = document.getElementById('topicSelect');
            const selectedTopicValue = topicSelectElement.value; // Gets the full "ID|TOPIC_TEXT" string
            const start = $('#topicStart').val();
            const end = $('#topicEnd').val();
            
            if (!start) {
                CALENDAR_APP.showCustomAlert('MISSING DATE', 'PLEASE SELECT A START DATE.');
                return;
            }
            
            if (end && end < start) {
                CALENDAR_APP.showCustomAlert('INVALID DATES', 'END DATE CANNOT BE BEFORE THE START DATE.');
                return;
            }
            
            let eventData;
            let isSyllabusTask = subjectKey && selectedTopicValue && selectedTopicValue !== "";

            if (!eventName && !isSyllabusTask) {
                CALENDAR_APP.showCustomAlert('MISSING DETAILS', 'PLEASE ENTER AN EVENT NAME OR SELECT BOTH A SUBJECT AND A TOPIC FOR SCHEDULING.');
                return;
            }

            if (eventName && !isSyllabusTask) {
                eventData = {
                    id: eventId || generateUniqueId(),
                    subjectKey: 'CUSTOM',
                    topicId: null,
                    title: eventName.toUpperCase(),
                    start: start,
                    end: end ? moment(end).add(1, 'days').format('YYYY-MM-DD') : null,
                    color: '#10b981',
                    borderColor: '#059669',
                    allDay: true
                };
            } 
else if (isSyllabusTask) {
        const [topicId, topicText] = selectedTopicValue.split('|');
        const subjectInfo = CONSOLIDATED_SYLLABUS[subjectKey];
        
        // ðŸš¨ FIX: Construct the full title directly using the topicText extracted
        // from the selection, ensuring it is accurate.
        const fullEventTitle = `${subjectInfo.shortTitle.toUpperCase()} - ${topicText}`;
        
        eventData = {
            id: eventId || generateUniqueId(),
            subjectKey: subjectKey,
            topicId: topicId,
            
            // ðŸŽ¯ FIXED: We store the fully constructed title directly.
            title: fullEventTitle,
            
            start: start,
            end: end ? moment(end).add(1, 'days').format('YYYY-MM-DD') : null,
            color: subjectInfo.color,
            borderColor: subjectInfo.color,
            allDay: true
        };
            } else {
                CALENDAR_APP.showCustomAlert('INVALID COMBINATION', 'PLEASE CHOOSE EITHER A CUSTOM EVENT NAME OR A SUBJECT/TOPIC, BUT NOT BOTH.');
                return;
            }
            
            let events = getEventsFromLocalStorage();
            
            if (eventId) {
                const index = events.findIndex(e => e.id === eventId);
                if (index !== -1) {
                    events[index] = eventData;
                }
            } else {
                events.push(eventData);
            }
            
            saveEventsToLocalStorage(events);
            closeTopicModal();
        }

        function deleteTopicTask() {
            const eventId = $('#topicEventId').val();
            if (!eventId) return;
            if (confirm("ARE YOU SURE YOU WANT TO DELETE THIS SCHEDULED TASK?")) {
                let events = getEventsFromLocalStorage();
                events = events.filter(e => e.id !== eventId);
                
                saveEventsToLocalStorage(events);
                closeTopicModal();
            }
        }
        
        function toggleDateJumpPicker() {
            const input = document.getElementById('dateJump');
            const button = document.getElementById('jumpToDateButton');
            if (input && button) {
                const rect = button.getBoundingClientRect();
                
                // Position the hidden input exactly over the button
                input.style.position = 'fixed';
                input.style.top = `${rect.top}px`;
                input.style.left = `${rect.left}px`;
                input.style.width = `${rect.width}px`;
                input.style.height = `${rect.height}px`;

                input.value = $('#calendar').fullCalendar('getDate').format('YYYY-MM-DD');
                
                // Add class to make it temporarily visible (opacity 0.01) and clickable
                input.classList.add('temp-visible');
                
                input.focus();
                
                input.onblur = function() {
                    input.classList.remove('temp-visible');
                    input.style.position = 'absolute'; 
                }
                
                if (typeof input.showPicker === 'function') {
                    setTimeout(() => {
                        input.showPicker();
                    }, 50);
                } else {
                    input.click();
                }
            }
        }
        
        function jumpToDate(dateString) {
            document.getElementById('dateJump').classList.remove('temp-visible');
            document.getElementById('dateJump').style.position = 'absolute';
            if (dateString && calendarInstance) {
                calendarInstance.fullCalendar('gotoDate', dateString);
            }
        }
        
        function setActiveButton(targetButton, viewName) {
            if (viewName !== 'today') {
                $('.fc-month-button, .fc-basicWeek-button, .fc-basicDay-button').removeClass('fc-state-active');
                $(targetButton).addClass('fc-state-active');
            }
        }

// --- CALENDAR PLACEHOLDER SAMPLES & COLOR FIX ---
function getEventsFromLocalStorage() {
    try {
        const data = localStorage.getItem('review_calendar_events');
        let events = data ? JSON.parse(data) : [];

        if (events.length === 0) {
            events = [
                {
                    id: 'sample-poli-1',
                    title: 'POLITICAL LAW â€“ FIRST TOPIC (SAMPLE)',
                    start: '2026-01-04',
                    end: '2026-01-10',
                    allDay: true,
                    subjectKey: 'poli',
                    topicId: null,
                    description: 'Sample multi-day Political Law topic â€“ will appear in brown!'
                },
                {
                    id: 'sample-rest-1',
                    title: 'REST DAY (SAMPLE)',
                    start: '2026-01-01',
                    end: '2026-01-03',
                    allDay: true,
                    subjectKey: null,
                    className: 'custom-rest-event',
                    backgroundColor: '#D4EDDA',
                    borderColor: '#C3E6CB',
                    textColor: '#155724',
                    description: 'Sample rest period â€“ light green!'
                }
            ];

            localStorage.setItem('review_calendar_events', JSON.stringify(events));
        }

        return events;
    } catch (e) {
        console.error("ERROR READING CALENDAR FROM LOCAL STORAGE:", e);
        return [];
    }
}

// Force green on custom rest event (overrides default blue)
const colorFixStyle = document.createElement('style');
colorFixStyle.innerHTML = `
`;
document.head.appendChild(colorFixStyle);
// --- END FIX ---


        function initializeCalendar() {
            calendarInstance = $('#calendar').fullCalendar({
                header: { left: '', center: '', right: '' },
                defaultView: 'month',
                defaultDate: moment().format('YYYY-MM-DD'),
                navLinks: true, editable: true, contentHeight: 450, timeFormat: 'H:mm', 
                
                viewRender: function(view, element) {
                    const titleText = view.title.toUpperCase();
                    $('#customMonthTitle').text(titleText);
                    $('.fc-button').removeClass('fc-state-active');
                    $(`.fc-${view.name}-button`).addClass('fc-state-active');
                    
                    const now = moment();
                    const isTodayVisible = view.intervalStart.isSameOrBefore(now, 'day') && view.intervalEnd.isSameOrAfter(now, 'day');
                    if (isTodayVisible) {
                        if (view.name === 'month' && view.intervalStart.isSame(now, 'month')) {
                            $('.fc-today-button').addClass('fc-state-active');
                        } else if (view.name === 'basicWeek' || view.name === 'basicDay') {
                            $('.fc-today-button').addClass('fc-state-active');
                        }
                    }
                    $('.fc-head th').addClass('fc-widget-header');
                    syncHeight();
                },
                
                dayClick: function(date, jsEvent, view) {
                    if ($(jsEvent.target).closest('.exam-day-marker').length) return;
                    openTopicModal(date.format('YYYY-MM-DD'));
                },
                eventClick: function(calEvent, jsEvent, view) {
                    jsEvent.preventDefault(); 
                    if (calEvent.className && calEvent.className.includes('exam-day-marker')) {
                        CALENDAR_APP.showCustomAlert("EXAM DAY", `THIS DATE IS MARKED AS **${calEvent.title}**. YOU CANNOT EDIT EXAM MARKERS.`);
                        return;
                    }
                    openTopicModal(null, calEvent); 
                },
                events: function(start, end, timezone, callback) {
                    const storedEvents = getEventsFromLocalStorage();
                    
                    const formattedEvents = storedEvents.map(e => ({
                        id: e.id, title: e.title, start: e.start, end: e.end, allDay: true,
                        backgroundColor: e.color, borderColor: e.borderColor,
                        subjectKey: e.subjectKey, topicId: e.topicId,
                    }));
                    
                    const examMarkers = getExamDates();
                    const allEvents = formattedEvents.concat(examMarkers);
                    callback(allEvents);
                },
                
                eventDrop: function(event, delta, revertFunc) {
                    if (event.editable === false || event.className.includes('exam-day-marker')) { revertFunc(); return; }
                    let events = getEventsFromLocalStorage();
                    const index = events.findIndex(e => e.id === event.id);
                    if (index !== -1) {
                        events[index].start = event.start.format('YYYY-MM-DD');
                        events[index].end = event.end ? event.end.format('YYYY-MM-DD') : null;
                        saveEventsToLocalStorage(events);
                        CALENDAR_APP.showCustomAlert("UPDATE SUCCESS", `TASK "**${event.title}**" MOVED TO ${event.start.format('MMM D, YYYY')}.`);
                    } else { revertFunc(); CALENDAR_APP.showCustomAlert("ERROR", "COULD NOT FIND EVENT TO UPDATE."); }
                },
                
                eventResize: function(event, delta, revertFunc) {
                    if (event.editable === false || event.className.includes('exam-day-marker')) { revertFunc(); }
                    let events = getEventsFromLocalStorage();
                    const index = events.findIndex(e => e.id === event.id);
                    if (index !== -1) {
                        events[index].end = event.end ? event.end.format('YYYY-MM-DD') : null;
                        saveEventsToLocalStorage(events);
                        const endDisplay = event.end ? event.end.clone().subtract(1, 'days').format('MMM D, YYYY') : event.start.format('MMM D, YYYY');
                        CALENDAR_APP.showCustomAlert("UPDATE SUCCESS", `TASK "**${event.title}**" RESIZED. NEW END DATE: ${endDisplay}.`);
                    } else { revertFunc(); CALENDAR_APP.showCustomAlert("ERROR", "COULD NOT FIND EVENT TO UPDATE."); }
                },
                
                eventRender: function(event, element) {
                    element.find('.fc-time').remove();
                    if (event.className && event.className.includes('exam-day-marker')) {
                        element.find('.fc-title').prepend(`<i class="fa-solid fa-graduation-cap mr-2"></i>`);
                        return;
                    }
                    let iconClass = event.subjectKey === 'CUSTOM' ? 'fa-calendar-check' : 'fa-book';
                    const iconHtml = `<span class="event-status-icon"><i class="fa-solid ${iconClass} event-icon-book"></i></span>`;
                    element.find('.fc-title').wrap('<div class="fc-event-title-wrap"></div>').before(iconHtml);
                },
            });
        }
        function syncHeight() {
            const calendarCard = document.getElementById('calendar-card');
            const detailsElement = document.getElementById('calendar-details');
            if (calendarCard && detailsElement) {
                const cardHeight = calendarCard.offsetHeight;
                detailsElement.style.setProperty('--calendar-height', `${cardHeight}px`);
                detailsElement.setAttribute('data-calendar-ready', 'true');
            }
        }
        function refreshCalendar() {
            if (calendarInstance) {
                calendarInstance.fullCalendar('refetchEvents');
            }
        }

        // Expose Calendar API globally for main tracker
        window.CALENDAR_APP = {
            CALENDAR_EVENTS_KEY: CALENDAR_EVENTS_KEY,
            NOTEPAD_CONTENT_KEY: NOTEPAD_CONTENT_KEY,
            refreshCalendar: refreshCalendar,
            setNotes: applyNotesContent,
            showCustomAlert: showCustomAlert,
            closeCustomAlert: closeCustomAlert,
            openTopicModal: openTopicModal,
            closeTopicModal: closeTopicModal,
            saveTopicTask: saveTopicTask,
            deleteTopicTask: deleteTopicTask,
            populateTopics: populateTopics,
            setActiveButton: setActiveButton,
            toggleDateJumpPicker: toggleDateJumpPicker,
            jumpToDate: jumpToDate,
            undoNotes: undoNotes,
            redoNotes: redoNotes,
            clearNotes: clearNotes,
            copyNotes: copyNotes,
            getExamDates: getExamDates,
            // FIX: EXPOSE necessary functions for the main script to call
            loadNotes: loadNotes,
            initializeCalendar: initializeCalendar,
            syncHeight: syncHeight
            // END FIX
        };
        
        // --- GLOBAL SYLLABUS LOGIC FACTORY (The "createSyllabusLogic" function) ---
        // (Function definition placed here to ensure it's available before initializeSubjectTrackers runs)
        window.createSyllabusLogic = function(subjectName, syllabusData, storageKey, themeIcon, title) {
            
            const self = {
                SUBJECT_NAME: subjectName,
                SUBJECT_TITLE: title,
                SUBJECT_ICON: themeIcon,
                SYLLABUS_DATA: syllabusData, 
                getProgress: getProgress,
                updateOverallProgress: updateOverallProgress,
                exportProgress: exportProgress,
                importProgress: triggerImport,
                processImport: processImport,
                toggleAllSections: toggleAllSections,
                getPanelHtmlWrapper: getPanelHtmlWrapper,
                render: renderSyllabusPanel
            };

            function getProgress() {
                try {
                    const saved = localStorage.getItem(storageKey);
                    return saved ? JSON.parse(saved) : {};
                } catch (e) {
                    console.error(`Error loading ${subjectName} progress:`, e);
                    return {};
                }
            }

            function saveProgress(progressData) {
                localStorage.setItem(storageKey, JSON.stringify(progressData));
                updateOverallProgress();
                window.updateOverallDashboard(); 
            }
            
            function getTopicStatus(topicId, progressData) {
                const topic = syllabusData.find(t => t.id === topicId);
                if (!topic) return 0;
                
                // ðŸš¨ MODIFIED: Updated threshold from 3 to 4
                const DONE_THRESHOLD = 4;
                
                if (topic.depth === 1) {
                    let sectionBoxesTotal = 0;
                    let sectionBoxesChecked = 0;
                    const startIndex = syllabusData.findIndex(t => t.id === topicId);
                    for (let i = startIndex; i < syllabusData.length; i++) {
                        const currentItem = syllabusData[i];
                        if (i > startIndex && currentItem.depth <= topic.depth) break;
                        if (currentItem.depth === 2 && currentItem.trackable) {
                            const prog = progressData[currentItem.id] || {};
                            const boxesTicked = CHECKLIST_COLUMNS.filter(col => prog[col] === true).length;
                            if (boxesTicked >= DONE_THRESHOLD) { // ðŸš¨ MODIFIED: Uses DONE_THRESHOLD
                                sectionBoxesChecked++;
                            }
                            sectionBoxesTotal++;
                        }
                    }
                    if (sectionBoxesTotal === 0) return 0;
                    if (sectionBoxesChecked === sectionBoxesTotal) return 2;
                    if (sectionBoxesChecked > 0) return 1;
                    return 0;
                } else if (topic.trackable) {
                    const topicProgress = progressData[topicId] || {};
                    const checkedCount = CHECKLIST_COLUMNS.filter(col => topicProgress[col] === true).length;
                    if (checkedCount === CHECKLIST_COLUMNS.length) return 2;
                    if (checkedCount >= DONE_THRESHOLD) return 2; // ðŸš¨ MODIFIED: Uses DONE_THRESHOLD
                    if (checkedCount > 0) return 1;
                    return 0;
                }
                return 0;
            }

            function updateOverallProgress() {
                const progressData = getProgress();
                const mainTopics = syllabusData.filter(t => t.depth === 2 && t.trackable);
                let topicsDoneCount = 0;
                let topicsToReadCount = 0;
                
                // ðŸš¨ MODIFIED: 6 columns
                const DONE_THRESHOLD = 4;
                const columnProgress = CHECKLIST_COLUMNS.map(() => 0);
                const totalMainTopics = mainTopics.length;

                mainTopics.forEach(topic => {
                    const topicProgress = progressData[topic.id] || {};
                    let boxesTicked = 0;
                    CHECKLIST_COLUMNS.forEach((col, index) => {
                        if (topicProgress[col] === true) {
                            boxesTicked++;
                            columnProgress[index]++;
                        }
                    });
                    
                    if (boxesTicked >= DONE_THRESHOLD) { // ðŸš¨ MODIFIED: Uses DONE_THRESHOLD
                        topicsDoneCount++;
                    } else {
                        topicsToReadCount++;
                    }
                });

                const overallProgressPercentage = totalMainTopics > 0 ? ((topicsDoneCount / totalMainTopics) * 100).toFixed(1) : 0.0;
                let barColor;
                if (overallProgressPercentage <= 25) { barColor = '#ef4444'; } 
                else if (overallProgressPercentage <= 50) { barColor = '#f97316'; } 
                else if (overallProgressPercentage <= 75) { barColor = '#facc15'; } 
                else { barColor = '#10b981'; }

                document.getElementById(`progress-done-${subjectName}`) && (document.getElementById(`progress-done-${subjectName}`).textContent = topicsDoneCount);
                document.getElementById(`progress-toread-${subjectName}`) && (document.getElementById(`progress-toread-${subjectName}`).textContent = topicsToReadCount);
                
                const progressElement = document.getElementById(`progress-${subjectName}`);
                if (progressElement) {
                    progressElement.textContent = `${overallProgressPercentage}%`;
                    progressElement.classList.remove('font-light');
                    progressElement.classList.add('progress-percent-bold');
                }
                
                const progressBar = document.getElementById(`progress-bar-${subjectName}`);
                if (progressBar) {
                    progressBar.style.width = `${overallProgressPercentage}%`;
                    progressBar.style.backgroundColor = barColor;
                }

                // ðŸš¨ MODIFIED: Updated column names for progress bars
                const columnHeaderNames = ['codal', 'first_reading', 'second_reading', 'pre_bar_notes', 'pre_week', 'lmts'];
                columnProgress.forEach((tickedCount, index) => {
                    const elementId = `col-progress-bar-${subjectName}-${columnHeaderNames[index]}`;
                    const percentElementId = `col-percent-${subjectName}-${columnHeaderNames[index]}`;
                    const barElement = document.getElementById(elementId);
                    const percentElement = document.getElementById(percentElementId);

                    if (barElement) {
                        const colPercentage = totalMainTopics > 0 ? ((tickedCount / totalMainTopics) * 100).toFixed(1) : 0.0;
                        barElement.style.width = `${colPercentage}%`;
                        if (percentElement) {
                            percentElement.textContent = `${colPercentage}%`;
                        }
                    }
                });
            }

            function renderSyllabusPanel() {
                 const syllabusContainer = document.getElementById(`syllabus-${subjectName}`);
                 if (!syllabusContainer) { setTimeout(renderSyllabusPanel, 10); return; }

                 const topicWithChildren = (function() {
                     const children = new Set();
                     syllabusData.forEach((item, index) => {
                         const nextItem = syllabusData[index + 1];
                         if (nextItem && nextItem.depth > item.depth) {
                             children.add(item.id);
                         }
                     });
                     return children;
                 })();

                 function hasChildren(topicId) { return topicWithChildren.has(topicId); }
                
                const openSections = {};
                document.querySelectorAll(`#subject-tracker-panel-${subjectName} details`).forEach(details => {
                    if (details.id) { openSections[details.id] = details.open; }
                });

                const progress = getProgress();
                let html = '';
                let currentSectionOpen = false;
                let isDepth2Open = false;
                const checkboxClass = `syllabus-checkbox-${subjectName}`;
                
                syllabusData.forEach((item, index) => {
                    const topicId = item.id;
                    const nextItem = syllabusData[index + 1];
                    const currentStatus = getTopicStatus(topicId, progress);

                    const iconName = currentStatus === 2 ? 'check-circle-2' : (currentStatus === 1 ? 'circle-half' : 'circle');
                    const iconColor = currentStatus === 2 ? 'checked' : (currentStatus === 1 ? 'partial' : 'empty');
                    const iconSize = item.depth === 1 ? 'w-5 h-5' : 'w-4 h-4';
                    const iconTitle = currentStatus === 2 ? 'Clear All' : (currentStatus === 1 ? 'Clear All' : 'Tick All');
                    const isTopLevelTopic = item.depth === 1;

                    if (isTopLevelTopic) {
                        if (isDepth2Open) { html += `</div></details></div>`; isDepth2Open = false; }
                        if (currentSectionOpen) { html += `</div></details></div>`; }
                        
                        const sectionId = `${subjectName}-section-${item.id}`;
                        const isOpen = openSections[sectionId] === true; 
                        const openAttr = isOpen ? 'open' : '';
                        
                        html += `\n<div class="syllabus-sub-section"><details id="${sectionId}" class="w-full" ${openAttr}><summary class="topic-header"><div class="topic-header-text"><i data-lucide="chevron-right" class="w-4 h-4 mr-2 chevron-icon"></i><span class="font-extrabold text-lg text-black/90">${item.topic}</span></div><i data-lucide="${iconName}" class="tick-all-icon ${iconColor} ${iconSize} flex-shrink-0" title="${iconTitle}" onclick="window.handleTickAll${subjectName.toUpperCase()}(${item.id}); event.stopPropagation(); event.preventDefault();"></i></summary><div class="p-2">\n`;
                        currentSectionOpen = true;
                    } else if (item.depth === 2 && item.trackable) {
                        const topicProgress = progress[topicId] || {};
                        const isCollapsible = hasChildren(topicId);

                        if (isDepth2Open && !isCollapsible) { html += `</div></details></div>`; isDepth2Open = false; }

                        const checklist = CHECKLIST_COLUMNS.map(col => {
                            // NEW CLASS: Use 'checkbox-' prefix plus the column name (codal, books, etc.)
                            const columnCheckboxClass = `checkbox-${col}`;
                            const checked = topicProgress[col] === true ? 'checked' : '';
                            
                            // Inject the columnCheckboxClass instead of the subject-specific one
                            return `\n<div class="flex justify-center"><input type="checkbox" data-id="${topicId}" data-column="${col}" ${checked} class="w-4 h-4 border-gray-300 rounded focus:ring-500 ${columnCheckboxClass}" onchange="window.handleCheckboxChange${subjectName.toUpperCase()}(event)"></div>\n`;
                        }).join('');

                        let rowContent = `\n
                            <div class="col-span-1 font-trackable-lg depth2-topic-row">
                                <div class="topic-content-wrapper" style="padding-left: 1.5rem;">
                                    ${isCollapsible ? `<i data-lucide="chevron-right" class="w-3 h-3 depth2-chevron"></i>` : `<span class="w-3 h-3 mr-2 inline-block"></span>`}${item.topic}
                                </div>
                            </div>
                            ${checklist}
                            <div class="flex items-center justify-center space-x-1 pl-2"><i data-lucide="${iconName}" class="tick-all-icon ${iconColor} ${iconSize} flex-shrink-0" title="${iconTitle}" onclick="window.handleTickAll${subjectName.toUpperCase()}(${item.id}); event.stopPropagation(); event.preventDefault();"></i></div>\n
                        `;

                        if (isCollapsible) {
                            const depth2Id = `${subjectName}-depth2-${item.id}`;
                            const isOpen = openSections[depth2Id] === true;
                            const openAttr = isOpen ? 'open' : '';
                            html += `<div class="depth2-details"><details id="${depth2Id}" class="w-full" ${openAttr}><summary class="checklist-grid hover:bg-gray-50/50 transition">${rowContent}</summary><div class="depth3-content-wrapper pt-1 pb-2">`;
                            isDepth2Open = true;
                        } else {
                            html += `<div class="checklist-grid hover:bg-gray-50/50 transition">${rowContent}</div>`;
                        }

                    } else if (item.depth >= 3) {
                        const dynamicPadding = (item.depth - 2) * 1.5 + 1.5;
                        const fontStyle = item.depth <= 4 ? 'font-medium' : 'font-normal';
                        
                        if (isDepth2Open) {
                             html += `<div class="p-1 border-b border-black/10 text-black/70 italic ${fontStyle} text-sm" style="padding-left: ${dynamicPadding}rem;">${item.topic}</div>`;
                        } else {
                            html += `<div class="checklist-grid hover:bg-gray-50/50 transition"><div>${item.topic}</div></div>`;
                        }
                    }

                    if (item.depth >= 3 && isDepth2Open && (!nextItem || nextItem.depth <= 2)) { html += `</div></details></div>`; isDepth2Open = false; }
                });

                if (currentSectionOpen) {
                    if (isDepth2Open) { html += `</div></details></div>`; }
                    html += `</div></details></div>`;
                }

                syllabusContainer.innerHTML = html;
                
                if (lucide && lucide.createIcons) { lucide.createIcons(); }
                updateOverallProgress();
                updateCollapseButtonText();
            }

            function handleCheckboxChange(event) {
                 const checkbox = event.target;
                 const id = checkbox.dataset.id;
                 const column = checkbox.dataset.column;
                 const isChecked = checkbox.checked;
                 const progressData = getProgress();
                 if (!progressData[id]) { progressData[id] = {}; }
                 progressData[id][column] = isChecked;
                 saveProgress(progressData);
                 renderSyllabusPanel(); 
            }
            
            function handleTickAll(topicId) {
                 const progressData = getProgress();
                 let topicsToUpdate = [];
                 const currentStatus = getTopicStatus(topicId, progressData);
                 const targetState = currentStatus === 2 ? false : true; 
                 const item = syllabusData.find(t => t.id === topicId);
                 if (!item) return;
                 
                 const startDepth = item.depth;
                 const startIndex = syllabusData.findIndex(t => t.id === topicId);
                 
                 if (startDepth === 2 && item.trackable) {
                     topicsToUpdate.push(item);
                 } else if (startDepth === 1) {
                     for (let i = startIndex; i < syllabusData.length; i++) { 
                         const currentItem = syllabusData[i];
                         if (i > startIndex && currentItem.depth <= startDepth) break;
                         if (currentItem.depth === 2 && currentItem.trackable) {
                             topicsToUpdate.push(currentItem);
                         }
                     }
                 }
                 
                 topicsToUpdate.forEach(topic => {
                     const id = topic.id;
                     if (!progressData[id]) { progressData[id] = {}; }
                     CHECKLIST_COLUMNS.forEach(col => {
                         progressData[id][col] = targetState;
                     });
                 });
                 saveProgress(progressData);
                 renderSyllabusPanel();
            }

            function exportProgress() {
                const progressData = localStorage.getItem(storageKey);
                if (!progressData || '{}' === progressData) {
                    showMessageModal("Download Failed", `<p class='text-red-600'>No ${title} progress data found to download.</p>`);
                    return;
                }
                downloadFile(progressData, `${subjectName}-progress.json`, 'application/json');
                showMessageModal("Download Complete", `<p class='text-green-600'>Your ${title} progress has been downloaded as **${subjectName}-progress.json**</p>`);
            }

            function triggerImport() {
                 DOM_ELEMENTS.globalFileInput.dataset.targetSubject = subjectName;
                 DOM_ELEMENTS.globalFileInput.click();
            }

            function processImport(file) {
                 if (!file) { showMessageModal("Upload Canceled", "No file was selected for upload."); return; }
                 if ('application/json' !== file.type && !file.name.endsWith('.json')) { showMessageModal("Upload Error", `<p class='text-red-600'>Invalid file type. Please upload a **.json** file.</p>`); return; }
                 
                 const reader = new FileReader();
                 reader.onload = function(e) {
                     const jsonString = e.target.result;
                     try {
                         const importedData = JSON.parse(jsonString);
                         if ('object' !== typeof importedData || null === importedData) { throw new Error("Invalid JSON structure."); }
                         saveProgress(importedData);
                         renderSyllabusPanel();
                         showMessageModal("Success!", `<p class='text-green-600'>${title} progress successfully uploaded and applied.</p>`);
                     } catch (e) {
                         console.error("Import error:", e);
                         showMessageModal("Upload Error", `<p class='text-red-600'>Failed to upload. The file content is not valid JSON. Error: ${e.message}</p>`);
                     }
                 };
                 reader.onerror = function() { showMessageModal("Import Error", `<p class='text-red-600'>Error reading the file.</p>`); };
                 reader.readAsText(file);
            }

            function toggleAllSections() {
                const allDetails = document.querySelectorAll(`#subject-tracker-panel-${subjectName} details`);
                let shouldOpen = false;
                for (const details of allDetails) {
                    if (!details.open) {
                        shouldOpen = true;
                        break;
                    }
                }
                allDetails.forEach(details => { details.open = shouldOpen; });
                if (lucide && lucide.createIcons) { lucide.createIcons(); }
                updateCollapseButtonText(shouldOpen);
            }

            function updateCollapseButtonText(isOpen) {
                const btn = document.getElementById(`collapse-all-btn-${subjectName}`);
                if (btn) {
                    if (typeof isOpen === 'undefined') {
                        const allDetails = document.querySelectorAll(`#subject-tracker-panel-${subjectName} details`);
                        let allOpen = true;
                        for (const details of allDetails) { if (!details.open) { allOpen = false; break; } }
                        isOpen = allOpen;
                    }
                    const iconName = isOpen ? 'chevrons-up' : 'chevrons-down';
                    btn.innerHTML = `<i data-lucide="${iconName}" class="w-4 h-4"></i>`; 
                    btn.classList.remove('w-8', 'h-8', 'w-7', 'h-7'); 
                    btn.classList.add('w-6', 'h-6', 'p-0', 'flex', 'items-center', 'justify-center', 'shadow-md'); 
                    if (lucide && lucide.createIcons) { lucide.createIcons(); }
                }
            }
            
            window[`handleTickAll${subjectName.toUpperCase()}`] = handleTickAll;
            window[`handleCheckboxChange${subjectName.toUpperCase()}`] = handleCheckboxChange;

            function getPanelHtmlWrapper(subjectName, title, icon) {
                const themeClass = `syllabus-panel-${subjectName}`;
                const bgButton = subjectName === 'rem' ? 'bg-purple-600' : (subjectName === 'crim' ? 'bg-red-600' : (subjectName === 'lab' ? 'bg-lab-button' : (subjectName === 'civ' ? 'bg-civ-button' : (subjectName === 'comm' ? 'bg-comm-button' : 'bg-poli-button'))));
                const hoverButton = subjectName === 'rem' ? 'hover:bg-purple-700' : (subjectName === 'crim' ? 'hover:bg-red-700' : (subjectName === 'lab' ? 'hover:bg-lab-button-dark' : (subjectName === 'civ' ? 'hover:bg-civ-button-dark' : (subjectName === 'comm' ? 'hover:bg-comm-button-dark' : 'hover:bg-poli-button-dark'))));
                
                const cleanTitle = title.replace(/\s*\([\d\s]*% of Total\)/, '');
                
                return `
                <div class="bg-white rounded-xl shadow-lg border border-gray-300 mt-4 syllabus-panel-container ${themeClass}" id="subject-tracker-panel-${subjectName}">
                    <details class="syllabus-panel">
                        <summary class="syllabus-summary" id="summary-${subjectName}">
                            <div class="syllabus-summary-title-row">
                                <div class="flex items-center">
                                    <i data-lucide="${icon}" class="w-6 h-6 mr-3"></i>${cleanTitle}
                                </div>
                                <div class="flex items-center text-xs">
                                    <span class="text-gray-300 mr-2 font-light hidden sm:inline">Press to Expand/Collapse</span>
                                    <i data-lucide="chevron-right" class="w-6 h-6 ml-2 main-summary-chevron"></i>
                                </div>
                            </div>
                            <div class="syllabus-progress-metrics text-xs">
                                <div class="progress-stats">
                                    <span class="flex items-center"><i data-lucide="check-circle-2" class="w-4 h-4 mr-1 text-gray-200"></i>DONE:&nbsp;<span id="progress-done-${subjectName}">0</span>&nbsp;TOPICS</span>
                                    <span class="flex items-center"><i data-lucide="book-open-text" class="w-4 h-4 mr-1 text-gray-200"></i>TO READ:&nbsp;<span id="progress-toread-${subjectName}">0</span>&nbsp;TOPICS</span>
                                </div>
                                <div class="flex items-center space-x-2 flex-grow min-w-[200px]">
                                    <span class="progress-overall-text flex items-center"><i data-lucide="bar-chart-3" class="w-4 h-4 mr-1"></i>OVERALL PROGRESS:</span>
                                    <div class="progress-bar-container">
                                        <div id="progress-bar-${subjectName}" class="progress-bar" style="width: 0%;"></div>
                                    </div>
                                    <span id="progress-${subjectName}" class="progress-percent-bold">0.0%</span>
                                </div>
                            </div>
                        </summary>
                        <div class="syllabus-content">
                            
                            <!-- 1. COLUMN HEADERS ðŸš¨ MODIFIED for 6 Columns & Multi-line Text -->
                            <div class="checklist-grid checklist-grid-header mt-1 font-bold text-xs text-center border-b-2 border-black/50">
                                <div class="text-left">SUBJECTS/TOPICS</div> 
                                <div class="flex items-center justify-center text-center leading-tight" style="color:#8b5cf6;"><span class="font-bold text-[0.65rem]">Codal</span></div>
                                <div class="flex items-center justify-center text-center leading-tight" style="color:#eab308;"><span class="font-bold text-[0.65rem]">First Reading (Textbook)</span></div>
                                <div class="flex items-center justify-center text-center leading-tight" style="color:#3b82f6;"><span class="font-bold text-[0.65rem]">Second Reading (Reviewer)</span></div>
                                <div class="flex items-center justify-center text-center leading-tight" style="color:#10b981;"><span class="font-bold text-[0.65rem]">Cases/Bar QAs</span></div>
                                <div class="flex items-center justify-center text-center leading-tight" style="color:#f97316;"><span class="font-bold text-[0.65rem]">Sample Exams</span></div>
                                <div class="flex items-center justify-center text-center leading-tight" style="color:#ef4444;"><span class="font-bold text-[0.65rem]">LMTs</span></div>
                                <div class="flex items-center justify-center pt-1">
                                    <button id="collapse-all-btn-${subjectName}" class="w-6 h-6 p-0 flex items-center justify-center text-white ${bgButton} rounded-lg shadow-md ${hoverButton} transition duration-150 whitespace-nowrap">
                                        <i data-lucide="chevrons-down" class="w-4 h-4"></i>
                                    </button>
                                </div>
                            </div>

                            <!-- Micro-progress Bars ðŸš¨ MODIFIED for 6 Columns & New Threshold -->
                            <div class="checklist-grid checklist-grid-micro-progress text-center">
<div class="text-left italic text-gray-500 col-span-1 pl-1 self-start pt-1" 
     style="font-size: 10px !important; line-height: 1 !important; display: block !important;">
    Overall progress counts only when at least 4 boxes per topic are checked.
</div> 
                                
                                <!-- Column 1: Codal (Purple) -->
                                <div class="px-1 flex flex-col items-center justify-start">
                                    <div class="col-progress-bar-container">
                                        <div id="col-progress-bar-${subjectName}-codal" class="col-progress-bar" style="background-color: #8b5cf6; width: 0%;"></div>
                                    </div>
                                    <span id="col-percent-${subjectName}-codal" class="text-xs font-semibold mt-1 text-violet-700">0.0%</span>
                                </div>
                                <!-- Column 2: 1st Reading (Yellow) -->
                                <div class="px-1 flex flex-col items-center justify-start">
                                    <div class="col-progress-bar-container">
                                        <div id="col-progress-bar-${subjectName}-first_reading" class="col-progress-bar" style="background-color: #eab308; width: 0%;"></div>
                                    </div>
                                    <span id="col-percent-${subjectName}-first_reading" class="text-xs font-semibold mt-1 text-yellow-700">0.0%</span>
                                </div>
                                <!-- Column 3: 2nd Reading (Blue) -->
                                <div class="px-1 flex flex-col items-center justify-start">
                                    <div class="col-progress-bar-container">
                                        <div id="col-progress-bar-${subjectName}-second_reading" class="col-progress-bar" style="background-color: #3b82f6; width: 0%;"></div>
                                    </div>
                                    <span id="col-percent-${subjectName}-second_reading" class="text-xs font-semibold mt-1 text-blue-700">0.0%</span>
                                </div>
                                <!-- Column 4: Pre-Bar Notes (Green) -->
                                <div class="px-1 flex flex-col items-center justify-start">
                                    <div class="col-progress-bar-container">
                                        <div id="col-progress-bar-${subjectName}-pre_bar_notes" class="col-progress-bar" style="background-color: #10b981; width: 0%;"></div>
                                    </div>
                                    <span id="col-percent-${subjectName}-pre_bar_notes" class="text-xs font-semibold mt-1 text-green-700">0.0%</span>
                                </div>
                                <!-- Column 5: Pre-Week (Orange) -->
                                <div class="px-1 flex flex-col items-center justify-start">
                                    <div class="col-progress-bar-container">
                                        <div id="col-progress-bar-${subjectName}-pre_week" class="col-progress-bar" style="background-color: #f97316; width: 0%;"></div>
                                    </div>
                                    <span id="col-percent-${subjectName}-pre_week" class="text-xs font-semibold mt-1 text-orange-700">0.0%</span>
                                </div>
                                <!-- Column 6: LMTs (Red) -->
                                <div class="px-1 flex flex-col items-center justify-start">
                                    <div class="col-progress-bar-container">
                                        <div id="col-progress-bar-${subjectName}-lmts" class="col-progress-bar" style="background-color: #ef4444; width: 0%;"></div>
                                    </div>
                                    <span id="col-percent-${subjectName}-lmts" class="text-xs font-semibold mt-1 text-red-700">0.0%</span>
                                </div>
                                <div></div>
                            </div>
                            
                            <div id="syllabus-${subjectName}" class="text-xs"></div>
                        </div>
                    </details>
                </div>
                `;
            }

            return self;
        };


        // --- GLOBAL SUBJECT SYLLABUS DATA (Declarations for loading) ---
        
        // This is the CRITICAL change: The load function now uses the file path to load the external JS.
        function initializeSubjectTrackers() {
            // REMEDIAL LAW
            loadSubjectPanel('rem', 'Syllabus/rem_logic.js');
            
            // CRIMINAL LAW
            loadSubjectPanel('crim', 'Syllabus/crim_logic.js');
            
            // LABOR LAW
            loadSubjectPanel('lab', 'Syllabus/lab_logic.js');

            // CIVIL LAW
            loadSubjectPanel('civ', 'Syllabus/civ_logic.js');
            
            // COMMERCIAL LAW
            loadSubjectPanel('comm', 'Syllabus/comm_logic.js');
            
            // POLITICAL LAW
            loadSubjectPanel('poli', 'Syllabus/poli_logic.js');
        }

        // --- GLOBAL DASHBOARD LOGIC ---
        function drawPieChart(donePercent) {
            const chartEl = document.getElementById('global-pie-chart');
            if (!chartEl) return;

            let fillColor;
            if (donePercent <= 25) { fillColor = '#ef4444'; } 
            else if (donePercent <= 50) { fillColor = '#f97316'; } 
            else if (donePercent <= 75) { fillColor = '#facc15'; } 
            else { fillColor = '#10b981'; }
            
            const backgroundRingColor = (donePercent < 100) ? '#ef4444' : '#e5e7eb';
            const centerTextColor = fillColor; 
            const centerFontSize = '2.5rem'; 
            const centerFontFamily = 'Bebas Neue, sans-serif'; 

            let totalTopics = 0;
            Object.values(SUBJECT_LOGIC_MAP).forEach(logic => {
                const mainTopics = logic.SYLLABUS_DATA.filter(t => t.depth === 2 && t.trackable);
                totalTopics += mainTopics.length;
            });
            const totalTopicsText = `Total Topics: ${totalTopics}`;

            const size = 160; 
            const radius = size / 2;
            const strokeWidth = 35; 
            const center = size / 2;
            
            const circumference = 2 * Math.PI * (radius - strokeWidth / 2);
            const doneOffset = circumference * (1 - (donePercent / 100));

            chartEl.style.width = `${size}px`;
            chartEl.style.height = `${size}px`;

            chartEl.innerHTML = `
                <svg width="${size}" height="${size}" viewBox="0 0 ${size} ${size}">
                    <circle cx="${center}" cy="${center}" r="${radius - strokeWidth / 2}" fill="none" stroke="${backgroundRingColor}" stroke-width="${strokeWidth}"/>
                    <circle
                        class="ring-done" cx="${center}" cy="${center}" r="${radius - strokeWidth / 2}"
                        fill="none" stroke="#38761d" stroke-width="${strokeWidth}" stroke-dasharray="${circumference}"
                        stroke-dashoffset="${doneOffset}" transform="rotate(-90 ${center} ${center})" stroke-linecap="round"
                    />
                    <circle cx="${center}" cy="${center}" r="${radius - strokeWidth}" fill="white"/>
                    <text x="${center}" y="${center - 10}" text-anchor="middle" alignment-baseline="central" font-size="${centerFontSize}"
                        font-weight="900" fill="${centerTextColor}" font-family="${centerFontFamily}" 
                        style="text-shadow: 1px 1px 0 #cccccc; letter-spacing: 1px;">
                        ${(donePercent).toFixed(0)}%
                    </text>
                     <text x="${center}" y="${center + 20}" text-anchor="middle" alignment-baseline="central" font-size="0.4rem"
                        font-weight="bold" fill="#4a5568" font-family="Inter, sans-serif" style="text-shadow: none;">
                        ${totalTopicsText}
                    </text>
                </svg>
            `;
        }

        function updateOverallDashboard() {
            document.getElementById('today-date-display').textContent = getLocalDisplayDate();

            let totalTrackableTopics = 0;
            let totalDoneTopics = 0;
            let totalToReadTopics = 0;
            
            // ðŸš¨ MODIFIED: Updated threshold from 3 to 4
            const DONE_THRESHOLD = 4;

            Object.values(SUBJECT_LOGIC_MAP).forEach(logic => {
                const progress = logic.getProgress();
                const syllabusData = logic.SYLLABUS_DATA;
                
                const mainTopics = syllabusData.filter(t => t.depth === 2 && t.trackable);
                const currentSubjectTrackable = mainTopics.length;
                let currentSubjectDone = 0;

                mainTopics.forEach(topic => {
                    const topicProgress = progress[topic.id] || {};
                    const boxesTicked = CHECKLIST_COLUMNS.filter(col => topicProgress[col] === true).length;
                    
                    if (boxesTicked >= DONE_THRESHOLD) { // ðŸš¨ MODIFIED: Uses DONE_THRESHOLD
                        currentSubjectDone++;
                    }
                });

                totalTrackableTopics += currentSubjectTrackable;
                totalDoneTopics += currentSubjectDone;
            });

            totalToReadTopics = totalTrackableTopics - totalDoneTopics;

            const donePercent = totalTrackableTopics > 0 ? (totalDoneTopics / totalTrackableTopics) * 100 : 0;
            const toReadPercent = 100 - donePercent;

            drawPieChart(donePercent);
            updateScheduleTable();

            document.getElementById('global-progress-done').textContent = `${donePercent.toFixed(1)}%`;
            document.getElementById('global-total-done-count').textContent = totalDoneTopics;
            
            document.getElementById('global-progress-toread').textContent = `${toReadPercent.toFixed(1)}%`;
            document.getElementById('global-total-toread-count').textContent = totalToReadTopics;
        }

        window.updateOverallDashboard = updateOverallDashboard;


        // --- INITIALIZATION ---
        window.onload = () => {
            // 1. Initialize Countdown Dates
            COUNTDOWN_DATA.forEach(data => {
                const savedDate = localStorage.getItem(`comp_exam_date_${data.id}`);
                const finalDate = savedDate || data.targetDate;
                if (finalDate) {
                    data.targetDate = finalDate;
                    document.querySelector(`#target-date-display-${data.id} .date-text`).textContent = formatUniqueDate(finalDate);
                }
            });

            // Display today's date
            document.getElementById('today-date-display').textContent = getLocalDisplayDate();
            setInterval(() => {
                document.getElementById('today-date-display').textContent = getLocalDisplayDate();
            }, 60000); 
            
            // 2. Load Calendar Module HTML and initialize its logic (now inline)
            document.getElementById('calendar-module-placeholder').innerHTML = CALENDAR_MODULE_HTML;
            
            // 3. Initialize Calendar and Notepad Logic (window.CALENDAR_APP is now fully defined above)
            window.CALENDAR_APP.loadNotes();
            window.CALENDAR_APP.initializeCalendar();
            
            // Initial sync/toggle check for calendar panel (needed to set notepad height)
            const detailsElement = document.getElementById('calendar-details');
            if(detailsElement) {
                $(detailsElement).on('toggle', function() {
                    const indicator = $('.toggle-indicator i');
                    if ($(this).prop('open')) {
                        indicator.removeClass('fa-chevron-right').addClass('fa-chevron-down');
                        window.CALENDAR_APP.syncHeight();
                    } else {
                        indicator.removeClass('fa-chevron-down').addClass('fa-chevron-right');
                    }
                }).trigger('toggle');
            }


            // 4. Load Subject Panels (This is ASYNCHRONOUS)
            initializeSubjectTrackers();
            
            // 5. Initialize Lucide Icons for static content
            if (lucide && lucide.createIcons) {
                lucide.createIcons();
            }

// 6. Attach General Event Listeners and load user name
// 6. Attach General Event Listeners and load user name
            updateAllCountdowns();
            setInterval(updateAllCountdowns, 1000);
            
            loadUserName();

            // RESTORE CLICKABLE DATES (Explicit mapping)
            const d1 = document.getElementById('target-date-display-1');
            const d2 = document.getElementById('target-date-display-2');
            const d3 = document.getElementById('target-date-display-3');
            
            if(d1) d1.onclick = () => openModal(1);
            if(d2) d2.onclick = () => openModal(2);
            if(d3) d3.onclick = () => openModal(3);

            // The dashboard update MUST wait for external subjects to load (1.5 seconds delay to be safe)
            setTimeout(window.updateOverallDashboard, 1500);
            
            // Monkey patch saveModal to update schedule table AFTER countdown is saved
            if (typeof saveModal === 'function' && typeof updateScheduleTable === 'function') {
                const originalSaveModal = saveModal;
                saveModal = function() {
                    originalSaveModal();
                    updateScheduleTable();
                };
            }
            
            document.getElementById('modal-save-btn').addEventListener('click', saveModal);
            document.getElementById('modal-cancel-btn').addEventListener('click', closeModal);
            
            document.getElementById('message-modal-close-btn')?.addEventListener('click', closeMessageModal);
        };

        // APPENDED: Case Tracker Script from case_tracker.html (at the end of the main script block)
        // MINIFIED CSV DATA
       const csvData = `No.,Full Text,Division,Promulgation Date,Type
001,"=HYPERLINK(""https://docs.google.com/document/d/1Yuci6rUA_2FMRADapPgLMqEsEt8tfQtxFbCQE_RsAgk/export?format=pdf"", ""City Government of Pasay v. Arellano University"")",3RD DIVISION,07 May 2025,DECISION
002,"=HYPERLINK(""https://docs.google.com/document/d/1zmE9F8NVKWZ8NlBtTpl5AYPsKpV2B6gHwiUpEtCBfoc/export?format=pdf"", ""Antonino v. Banco De Oro"")",3RD DIVISION,23 Apr 2025,DECISION
003,"=HYPERLINK(""https://docs.google.com/document/d/1LOPMJrd_1ZzekXcmIr4EbE9uFuYrqxelo58WRLKDsOc/export?format=pdf"", ""Mangudadatu v. Comelec"")",EN BANC,22 Apr 2025,DECISION
004,"=HYPERLINK(""https://docs.google.com/document/d/1JW5qlqt6xINLRETnKRR5D5vGSsL3-gpMMNVssLTvrts/export?format=pdf"", ""Hisanza v. Bright Maritime"")",3RD DIVISION,07 Apr 2025,DECISION
005,"=HYPERLINK(""https://docs.google.com/document/d/1Sr75lghndZI5vL6TOGbpOHRZojbDs49PuuBKN_VrrbM/export?format=pdf"", ""People v. Akil"")",3RD DIVISION,07 Apr 2025,DECISION
006,"=HYPERLINK(""https://docs.google.com/document/d/19dQC3DfyhrcIx9uG-9wIdS91Kw7bd5mUcv87I9OwjyA/export?format=pdf"", ""San Pedro v. Spouses Trinidad"")",3RD DIVISION,07 Apr 2025,DECISION
007,"=HYPERLINK(""https://docs.google.com/document/d/1Xl_Y43P55i2Nn9iv3XKIs7z5Gn66E6kF/export?format=pdf"", ""Rural Bank of San Mateo Isabela v. Ramales"")",3RD DIVISION,02 Apr 2025,DECISION
008,"=HYPERLINK(""https://docs.google.com/document/d/1V3u6B0JvY79yTyR3q_V0d-yXjGk-kZ_F/export?format=pdf"", ""Zamora v. Atty. Mahinay"")",3RD DIVISION,02 Apr 2025,DECISION
009,"=HYPERLINK(""https://docs.google.com/document/d/1T8uE0-Z4Y5oF8x7W_J6pL4vD5m9cQ3q/export?format=pdf"", ""Ocampo v. Batara-Sapad"")",3RD DIVISION,02 Apr 2025,DECISION
010,"=HYPERLINK(""https://docs.google.com/document/d/1R6oG7-H2Z5xL8tW9_K4vM3nQ2pL1rO5/export?format=pdf"", ""Grand Exploit Builder Development v. Hoegaarden Development Realty"")",3RD DIVISION,02 Apr 2025,DECISION
011,"=HYPERLINK(""https://docs.google.com/document/d/1Q4pE5-F0Z3yK6uW7_L2tN1mP0qR4sV6/export?format=pdf"", ""Vera Law v. Atty. Hechanova"")",3RD DIVISION,26 Feb 2025,DECISION
012,"=HYPERLINK(""https://docs.google.com/document/d/1O2nC3-D8X1zI4wU5_J0kM9nQ8oP2rT7/export?format=pdf"", ""Lo v. People"")",3RD DIVISION,26 Feb 2025,DECISION
013,"=HYPERLINK(""https://docs.google.com/document/d/1M0lA1-B6Y9xG2vS3_H8iK7lO6pQ0tU8/export?format=pdf"", ""Spouses Palaganas v. Atty. Panganiban"")",3RD DIVISION,24 Feb 2025,DECISION
014,"=HYPERLINK(""https://docs.google.com/document/d/1K8j9-Z4W7vE0tQ1_F6mO4nL2pR8sT9/export?format=pdf"", ""Bonbon v. People"")",3RD DIVISION,24 Feb 2025,DECISION
015,"=HYPERLINK(""https://docs.google.com/document/d/1I6h7-X2U5tC8rO9_D4kM2nJ0pP6qV7/export?format=pdf"", ""Sillano v. JGC Philippines"")",3RD DIVISION,24 Feb 2025,DECISION
016,"=HYPERLINK(""https://docs.google.com/document/d/1G4f5-V0S3rA6pM7_B2iK0nL8pQ4sT5/export?format=pdf"", ""Aguiling v. People"")",3RD DIVISION,17 Feb 2025,DECISION
017,"=HYPERLINK(""https://docs.google.com/document/d/1E2d3-T8Q1pY4nO5_A0jI8nK6pR2qS3/export?format=pdf"", ""People v. Sandiganbayan, Tumang"")",3RD DIVISION,17 Feb 2025,DECISION
018,"=HYPERLINK(""https://docs.google.com/document/d/1C0b1-R6O9nZ2mL3_y8hG6nI4pP0qQ1/export?format=pdf"", ""Bagbagen v. Perez"")",3RD DIVISION,17 Feb 2025,DECISION
019,"=HYPERLINK(""https://docs.google.com/document/d/1A8Z9-P4M7lX0kK1_w6fE4nJ2pR8qO9/export?format=pdf"", ""Labastida v. Quires"")",3RD DIVISION,27 Jan 2025,DECISION
020,"=HYPERLINK(""https://docs.google.com/document/d/186X7-N2K5jV8iI9_u4dC2nJ0pP6qQ7/export?format=pdf"", ""Baguinon, Sr. v. People"")",3RD DIVISION,27 Jan 2025,DECISION
021,"=HYPERLINK(""https://docs.google.com/document/d/164V5-L0I3hT6gG7_s2bA0nJ8pP4qO5/export?format=pdf"", ""Maitim v. Teknika Skills and Trade Services"")",3RD DIVISION,15 Jan 2025,DECISION
022,"=HYPERLINK(""https://docs.google.com/document/d/142T3-J8G1fR4eE5_q0zY8nJ6pR2qM3/export?format=pdf"", ""Del Monte Land Transport Bus Company v. Jaranilla"")",3RD DIVISION,27 Nov 2024,DECISION
023,"=HYPERLINK(""https://docs.google.com/document/d/120R1-H6E9dP2cC3_o8xW6nJ4pQ0qK1/export?format=pdf"", ""People v. Lupoyon"")",3RD DIVISION,11 Nov 2024,DECISION
024,"=HYPERLINK(""https://docs.google.com/document/d/108P9-F4C7bN0aA1_m6vU4nJ2pQ8qI9/export?format=pdf"", ""Fajardo v. San Miguel Foods"")",3RD DIVISION,11 Nov 2024,DECISION
025,"=HYPERLINK(""https://docs.google.com/document/d/1y6N7-D2A5_M8_I9_k4tS2nJ0pQ6qG7/export?format=pdf"", ""Noveras v. Comelec"")",EN BANC,22 Oct 2024,DECISION
026,"=HYPERLINK(""https://docs.google.com/document/d/1w4L5-B0Y3_K6_G7_i2rQ0nJ8pQ4qE5/export?format=pdf"", ""Puguon, Jr. v. People"")",3RD DIVISION,21 Oct 2024,DECISION
027,"=HYPERLINK(""https://docs.google.com/document/d/1u2J3-Z8W1_I4_E5_g0tO8nJ6pR2qC3/export?format=pdf"", ""Malapit v. Atty. Watin"")",EN BANC,01 Oct 2024,RESOLUTION
028,"=HYPERLINK(""https://docs.google.com/document/d/1s0H1-X6U9_G2_C3_e8rM6nJ4pQ0qA1/export?format=pdf"", ""Pequero v. People"")",3RD DIVISION,07 Aug 2024,DECISION
029,"=HYPERLINK(""https://docs.google.com/document/d/1q8F9-V4S7_E0_A1_c6pK4nJ2pR8qY9/export?format=pdf"", ""People v. Batomalaque"")",3RD DIVISION,07 Aug 2024,DECISION
030,"=HYPERLINK(""https://docs.google.com/document/d/1o6D7-T2Q5_C8_Y9_a4nI2nJ6pR2qW7/export?format=pdf"", ""Davantes v. C.F. Sharp Crew Management"")",3RD DIVISION,07 Aug 2024,DECISION
031,"=HYPERLINK(""https://docs.google.com/document/d/1m4B5-R0O3_A6_W7_Y2lG0nJ4pQ0qU5/export?format=pdf"", ""Legaspi v. Comelec"")",EN BANC,30 Jul 2024,DECISION
032,"=HYPERLINK(""https://docs.google.com/document/d/1k2Z3-P8M1_Y4_U5_W0jE8nJ2pR2qS3/export?format=pdf"", ""Re Atty. Divina"")",EN BANC,30 Jul 2024,DECISION
033,"=HYPERLINK(""https://docs.google.com/document/d/1i0X1-N6K9_W2_S3_U8hC6nJ4pQ0qQ1/export?format=pdf"", ""Gonzales v. Geronimo"")",EN BANC,30 Jul 2024,DECISION
034,"=HYPERLINK(""https://docs.google.com/document/d/1g8V9-L4I7_U0_Q1_S6fA4nJ4pQ0qO9/export?format=pdf"", ""Stewart v. Atty. Rioflorido"")",3RD DIVISION,17 Jul 2024,DECISION
035,"=HYPERLINK(""https://docs.google.com/document/d/1e6T7-J2G5_S8_O9_Q4dY2nJ4pQ0qM7/export?format=pdf"", ""OCA v. Judge Villavicencio-Olan"")",EN BANC,25 Jun 2024,DECISION
036,"=HYPERLINK(""https://docs.google.com/document/d/1c4R5-H0E3_Q6_M7_O2bW0nJ4pQ0qK5/export?format=pdf"", ""People v. Talaue"")",SPECIAL 1ST DIVISION,19 Jun 2024,RESOLUTION
037,"=HYPERLINK(""https://docs.google.com/document/d/1a2P3-F8C1_O4_K5_M0zU8nJ4pQ0qI3/export?format=pdf"", ""People v. Oh"")",3RD DIVISION,05 Jun 2024,DECISION
038,"=HYPERLINK(""https://docs.google.com/document/d/1Y0N1-D6A9_M2_I3_K8xS6nJ4pQ0qG1/export?format=pdf"", ""Ampolitod v. Top Ever Marine Management Phils."")",3RD DIVISION,22 May 2024,DECISION
039,"=HYPERLINK(""https://docs.google.com/document/d/1W8L9-B4Y7_K0_G1_I6vQ4nJ4pQ0qE9/export?format=pdf"", ""Zoleta v. Ombudsman"")",3RD DIVISION,08 Apr 2024,DECISION
040,"=HYPERLINK(""https://docs.google.com/document/d/1U6J7-Z2W5_I8_E9_G4tO2nJ4pQ0qC7/export?format=pdf"", ""Besmonte v. Napolcom-NCR"")",3RD DIVISION,03 Apr 2024,DECISION
041,"=HYPERLINK(""https://docs.google.com/document/d/1S4H5-X0U3_G6_C7_E2rM0nJ4pQ0qA5/export?format=pdf"", ""Bayron v. COA"")",EN BANC,27 Feb 2024,RESOLUTION
042,"=HYPERLINK(""https://docs.google.com/document/d/1Q2F3-V8S1_E4_A5_C0pS8nJ4pQ0qY3/export?format=pdf"", ""Pacheco v. Reyes"")",3RD DIVISION,26 Feb 2024,DECISION
043,"=HYPERLINK(""https://docs.google.com/document/d/1O0D1-T6Q9_C2_Y3_A8nI6nJ4pQ0qW1/export?format=pdf"", ""Galorio v. People"")",3RD DIVISION,19 Feb 2024,DECISION
044,"=HYPERLINK(""https://docs.google.com/document/d/1M8B9-R4O7_A0_W1_Y6lG4nJ4pQ0qU9/export?format=pdf"", ""Pagtakhan v. People"")",3RD DIVISION,07 Feb 2024,DECISION
045,"=HYPERLINK(""https://docs.google.com/document/d/1K6Z7-P2M5_Y8_U9_W4jE2nJ4pQ0qS7/export?format=pdf"", ""DBP v. COA"")",EN BANC,06 Feb 2024,RESOLUTION
046,"=HYPERLINK(""https://docs.google.com/document/d/1I4X5-N0K3_W6_S7_U2hC0nJ4pQ0qQ5/export?format=pdf"", ""Denusta v. Migrant Workers Manpower Agency"")",3RD DIVISION,31 Jan 2024,DECISION
047,"=HYPERLINK(""https://docs.google.com/document/d/1G2V3-L8I1_U4_Q5_S0fA8nJ4pQ0qO3/export?format=pdf"", ""Villafuerte v. Atty. Tajanlangit"")",3RD DIVISION,06 Dec 2023,DECISION
048,"=HYPERLINK(""https://docs.google.com/document/d/1E0T1-J6G9_S2_O3_Q8dY6nJ4pQ0qM1/export?format=pdf"", ""Trinidad v. Trinidad"")",3RD DIVISION,06 Dec 2023,DECISION
049,"=HYPERLINK(""https://docs.google.com/document/d/1C8R9-H4E7_Q0_M1_O6bW4nJ4pQ0qK9/export?format=pdf"", ""People v. Flores"")",3RD DIVISION,11 Oct 2023,DECISION
050,"=HYPERLINK(""https://docs.google.com/document/d/1A6P7-F2C5_O8_K9_M4zU2nJ4pQ0qI7/export?format=pdf"", ""People v. Lala"")",3RD DIVISION,11 Oct 2023,DECISION
051,"=HYPERLINK(""https://docs.google.com/document/d/184N5-D0A3_M6_I7_K2xS0nJ4pQ0qG5/export?format=pdf"", ""People v. Pajarilla"")",3RD DIVISION,30 Aug 2023,DECISION
052,"=HYPERLINK(""https://docs.google.com/document/d/162L3-B8Y1_K4_G5_I0vQ8nJ4pQ0qE3/export?format=pdf"", ""People v. XXX220145"")",3RD DIVISION,30 Aug 2023,DECISION
053,"=HYPERLINK(""https://docs.google.com/document/d/140J1-Z6W9_I2_E3_G8tO6nJ4pQ0qC1/export?format=pdf"", ""Republic v. Spouses Tan"")",3RD DIVISION,23 Aug 2023,DECISION
054,"=HYPERLINK(""https://docs.google.com/document/d/128H9-X4U7_G0_C1_E6rM4nJ4pQ0qA9/export?format=pdf"", ""Bacar v. People"")",3RD DIVISION,23 Aug 2023,DECISION
055,"=HYPERLINK(""https://docs.google.com/document/d/106F7-V2S5_E8_A9_C4pS2nJ4pQ0qY7/export?format=pdf"", ""Palo v. Spouses Baquirquir"")",3RD DIVISION,23 Aug 2023,RESOLUTION
056,"=HYPERLINK(""https://docs.google.com/document/d/1y4D5-T0Q3_C6_Y7_A2nI0nJ4pQ0qW5/export?format=pdf"", ""Aguilar v. People"")",3RD DIVISION,09 Aug 2023,DECISION
057,"=HYPERLINK(""https://docs.google.com/document/d/1w2B3-R8O1_A4_W5_Y0lG8nJ4pQ0qU3/export?format=pdf"", ""Grandspan Development v. Franklin Baker, Inc."")",3RD DIVISION,02 Aug 2023,DECISION
058,"=HYPERLINK(""https://docs.google.com/document/d/1u0Z1-P6M9_Y2_U3_W8jE6nJ4pQ0qS1/export?format=pdf"", ""Cojuangco-Suntay v. Suntay III"")",3RD DIVISION,02 Aug 2023,DECISION
059,"=HYPERLINK(""https://docs.google.com/document/d/1s8X9-N4K7_W0_S1_U6hC4nJ4pQ0qQ9/export?format=pdf"", ""DBP v. COA"")",EN BANC,11 Jul 2023,DECISION
060,"=HYPERLINK(""https://docs.google.com/document/d/1q6V7-L2I5_U8_Q9_S4fA2nJ4pQ0qO7/export?format=pdf"", ""Villanueva v. Comelec"")",EN BANC,11 Jul 2023,DECISION
061,"=HYPERLINK(""https://docs.google.com/document/d/1o4T5-J0G3_S6_O7_Q2dY0nJ4pQ0qM5/export?format=pdf"", ""Arguilles v. Wilhelmsen Smith Bell Manning, Inc."")",3RD DIVISION,10 Jul 2023,DECISION
062,"=HYPERLINK(""https://docs.google.com/document/d/1m2R3-H8E1_Q4_M5_O0bW8nJ4pQ0qK3/export?format=pdf"", ""Tijam v. People"")",3RD DIVISION,10 Jul 2023,DECISION
063,"=HYPERLINK(""https://docs.google.com/document/d/1k0P1-F6C9_O2_K3_M8zU6nJ4pQ0qI1/export?format=pdf"", ""Ocampo v. Macapagal-Arroyo"")",EN BANC,27 Jun 2023,RESOLUTION
064,"=HYPERLINK(""https://docs.google.com/document/d/1i8N9-D4A7_M0_I1_K6xS4nJ4pQ0qG9/export?format=pdf"", ""Mendoza v. Atty. Santiago, Jr."")",3RD DIVISION,14 Jun 2023,DECISION
065,"=HYPERLINK(""https://docs.google.com/document/d/1g6L7-B2Y5_K8_G9_I4vQ2nJ4pQ0qE7/export?format=pdf"", ""Gonzaga v. Garcia, Jr."")",3RD DIVISION,26 Apr 2023,DECISION
066,"=HYPERLINK(""https://docs.google.com/document/d/1e4J5-Z0W3_I6_E7_G2tO0nJ4pQ0qC5/export?format=pdf"", ""Republic v. Espejo"")",3RD DIVISION,26 Apr 2023,DECISION
067,"=HYPERLINK(""https://docs.google.com/document/d/1c2H3-X8U1_G4_C5_E0rM8nJ4pQ0qA3/export?format=pdf"", ""Bunayog v. Foscon Shipmanagement, Inc."")",EN BANC,25 Apr 2023,DECISION
068,"=HYPERLINK(""https://docs.google.com/document/d/1a0F1-V6S9_E2_A3_C8pS6nJ4pQ0qY1/export?format=pdf"", ""Yau v. Judge Veloso"")",3RD DIVISION,19 Apr 2023,DECISION
069,"=HYPERLINK(""https://docs.google.com/document/d/1Y8D9-T4Q7_C0_Y1_A6nI4nJ4pQ0qW9/export?format=pdf"", ""Manuel v. People"")",3RD DIVISION,12 Apr 2023,DECISION
070,"=HYPERLINK(""https://docs.google.com/document/d/1W6B7-R2O5_A8_W9_Y4lG2nJ4pQ0qU7/export?format=pdf"", ""XXX255877 v. People"")",3RD DIVISION,29 Mar 2023,DECISION
071,"=HYPERLINK(""https://docs.google.com/document/d/1U4Z5-P0M3_Y6_U7_W2jE0nJ4pQ0qS5/export?format=pdf"", ""Asignado v. Ombudsman"")",3RD DIVISION,29 Mar 2023,DECISION
072,"=HYPERLINK(""https://docs.google.com/document/d/1S2X3-N8K1_W4_S5_U0hC8nJ4pQ0qQ3/export?format=pdf"", ""Municipality of Sta. Maria, Bulacan v. Buenaventura"")",3RD DIVISION,29 Mar 2023,DECISION
073,"=HYPERLINK(""https://docs.google.com/document/d/1Q0V1-L6I9_U2_Q3_S8fA6nJ4pQ0qO1/export?format=pdf"", ""Citibank Savings, Inc. v. Rogan"")",3RD DIVISION,29 Mar 2023,DECISION
074,"=HYPERLINK(""https://docs.google.com/document/d/1O8T9-J4G7_S0_O1_Q6dY4nJ4pQ0qM9/export?format=pdf"", ""De Guzman v. Spouses Santos"")",3RD DIVISION,29 Mar 2023,DECISION
075,"=HYPERLINK(""https://docs.google.com/document/d/1M6R7-H2E5_Q8_M9_O4bW2nJ4pQ0qK7/export?format=pdf"", ""Solis v. Solis-Laynes"")",3RD DIVISION,29 Mar 2023,DECISION
076,"=HYPERLINK(""https://docs.google.com/document/d/1I8P5-F0C3_O6_K7_M2zU0nJ4pQ0qI5/export?format=pdf"", ""Diversified Plastic Film System, Inc. v. Philippine Investment One (SPV-AMC), Inc."")",3RD DIVISION,29 Mar 2023,DECISION
077,"=HYPERLINK(""https://docs.google.com/document/d/1G6N3-D8A1_M4_I5_K0xS8nJ4pQ0qG3/export?format=pdf"", ""Republic v. Pascual"")",3RD DIVISION,29 Mar 2023,DECISION
078,"=HYPERLINK(""https://docs.google.com/document/d/1E4L1-B6Y9_K2_G3_I8vQ6nJ4pQ0qE1/export?format=pdf"", ""Chevron Philippines v. Looyuko"")",3RD DIVISION,29 Mar 2023,DECISION
079,"=HYPERLINK(""https://docs.google.com/document/d/1C2J9-Z4W7_I0_E1_G6tO4nJ4pQ0qC9/export?format=pdf"", ""Land Bank v. Tayko"")",3RD DIVISION,29 Mar 2023,RESOLUTION
080,"=HYPERLINK(""https://docs.google.com/document/d/1A0H7-X2U5_G8_C9_E4rM2nJ4pQ0qA7/export?format=pdf"", ""Zamora v. Bagatsing, Jr."")",3RD DIVISION,29 Mar 2023,DECISION
081,"=HYPERLINK(""https://docs.google.com/document/d/188F5-V0S3_E6_A7_C2pS0nJ4pQ0qY5/export?format=pdf"", ""Reyes v. Ombudsman"")",3RD DIVISION,15 Mar 2023,DECISION
082,"=HYPERLINK(""https://docs.google.com/document/d/166D3-T8Q1_C4_Y5_A0nI8nJ4pQ0qW3/export?format=pdf"", ""Heirs of Dimao v. NGCP"")",3RD DIVISION,01 Mar 2023,DECISION
083,"=HYPERLINK(""https://docs.google.com/document/d/144B1-R6O9_A2_W3_Y8lG6nJ4pQ0qU1/export?format=pdf"", ""Conche v. People"")",3RD DIVISION,01 Mar 2023,DECISION
084,"=HYPERLINK(""https://docs.google.com/document/d/122Z9-P4M7_Y0_U1_W6jE4nJ4pQ0qS9/export?format=pdf"", ""Singgit v. People"")",3RD DIVISION,27 Feb 2023,DECISION
085,"=HYPERLINK(""https://docs.google.com/document/d/100X7-N2K5_W8_S9_U4hC2nJ4pQ0qQ7/export?format=pdf"", ""Heirs of Manzano v. Kinsonic Philippines, Inc."")",3RD DIVISION,27 Feb 2023,DECISION
086,"=HYPERLINK(""https://docs.google.com/document/d/1y8V5-L0I3_T6gG7_s2bA0nJ8pP4qO5/export?format=pdf"", ""Land Bank v. Miranda"")",3RD DIVISION,22 Feb 2023,DECISION
087,"=HYPERLINK(""https://docs.google.com/document/d/1w6T3-J8G1_R4eE5_q0zY8nJ6pR2qM3/export?format=pdf"", ""Pabalan v. Sabnani"")",EN BANC,21 Feb 2023,DECISION
088,"=HYPERLINK(""https://docs.google.com/document/d/1u4R1-H6E9_P2cC3_o8xW6nJ4pQ0qK1/export?format=pdf"", ""Gotesco Properties v. Cua"")",3RD DIVISION,15 Feb 2023,DECISION
089,"=HYPERLINK(""https://docs.google.com/document/d/1s2P9-F4C7_N0aA1_m6vU4nJ2pQ8qI9/export?format=pdf"", ""Caballes v. CA"")",3RD DIVISION,08 Feb 2023,DECISION
090,"=HYPERLINK(""https://docs.google.com/document/d/1q0N7-D2A5_M8_I9_k4tS2nJ0pQ6qG7/export?format=pdf"", ""Quiambao v. Sumbilla"")",3RD DIVISION,01 Feb 2023,DECISION
091,"=HYPERLINK(""https://docs.google.com/document/d/1o8L5-B0Y3_K6_G7_i2rQ0nJ8pQ0qE5/export?format=pdf"", ""Bariata v. Carpio-Morales"")",3RD DIVISION,01 Feb 2023,DECISION
092,"=HYPERLINK(""https://docs.google.com/document/d/1m6J3-Z8W1_I4_E5_g0tO8nJ6pR2qC3/export?format=pdf"", ""Land Bank v. Spouses Latog"")",3RD DIVISION,01 Feb 2023,DECISION
093,"=HYPERLINK(""https://docs.google.com/document/d/1k4H1-X6U9_G2_C3_e8rM6nJ4pQ0qA1/export?format=pdf"", ""Aquino v. Agua Tierra Oro Mina Development Corporation"")",3RD DIVISION,25 Jan 2023,DECISION
094,"=HYPERLINK(""https://docs.google.com/document/d/1i2F9-V4S7_E0_A1_c6pK4nJ2pR8qY9/export?format=pdf"", ""Provincial Prosecutor of Albay v. Lobiano"")",3RD DIVISION,25 Jan 2023,DECISION
095,"=HYPERLINK(""https://docs.google.com/document/d/1g0D7-T2Q5_C8_Y9_a4nI2nJ6pR2qW7/export?format=pdf"", ""Suyat v. CA"")",EN BANC,24 Jan 2023,DECISION
096,"=HYPERLINK(""https://docs.google.com/document/d/1e8B5-R0O3_A6_W7_Y2lG0nJ4pQ0qU5/export?format=pdf"", ""DENR-PENRO of Virac, Catanduanes v. Eastern Island Shipping Lines"")",3RD DIVISION,16 Jan 2023,DECISION
097,"=HYPERLINK(""https://docs.google.com/document/d/1c6Z3-P8M1_Y4_U5_W0jE8nJ2pR2qS3/export?format=pdf"", ""Vizcarra v. Vizcarra-Nocillado"")",3RD DIVISION,11 Jan 2023,DECISION
098,"=HYPERLINK(""https://docs.google.com/document/d/1a4X1-N6K9_W2_S3_U8hC6nJ4pQ0qQ1/export?format=pdf"", ""Ocampo v. Macapagal-Arroyo"")",EN BANC,10 Jan 2023,DECISION
099,"=HYPERLINK(""https://docs.google.com/document/d/1Y2V9-L4I7_U0_Q1_S6fA4nJ2pR8qO9/export?format=pdf"", ""Bounsit-Torralba v. Torralba"")",3RD DIVISION,07 Dec 2022,DECISION
100,"=HYPERLINK(""https://docs.google.com/document/d/1W0T7-J2G5_S8_O9_Q4dY2nJ4pQ0qM7/export?format=pdf"", ""Fort Bonifacio Development Corporation v. Domingo"")",3RD DIVISION,07 Dec 2022,DECISION
101,"=HYPERLINK(""https://docs.google.com/document/d/1U8R5-H0E3_Q6_M7_O2bW0nJ4pQ0qK5/export?format=pdf"", ""Bayron v. COA"")",EN BANC,29 Nov 2022,DECISION
102,"=HYPERLINK(""https://docs.google.com/document/d/1S6P3-F8C1_O4_K5_M0zU8nJ4pQ0qI3/export?format=pdf"", ""Manguerra v. Manguerra-Aberasturi"")",EN BANC,29 Nov 2022,DECISION
103,"=HYPERLINK(""https://docs.google.com/document/d/1Q4N1-D6A9_M2_I3_K8xS6nJ4pQ0qG1/export?format=pdf"", ""Nolasco v. Purence Realty Corporation"")",3RD DIVISION,12 Oct 2022,DECISION
104,"=HYPERLINK(""https://docs.google.com/document/d/1O2L9-B4Y7_K0_G1_I6vQ4nJ4pQ0qE9/export?format=pdf"", ""Cabrales v. Ombudsman"")",3RD DIVISION,12 Oct 2022,DECISION
105,"=HYPERLINK(""https://docs.google.com/document/d/1M0J7-Z2W5_I8_E9_G4tO2nJ4pQ0qC7/export?format=pdf"", ""POrto v. Grant Institute of Trade & Technology, Inc."")",3RD DIVISION,12 Oct 2022,DECISION
106,"=HYPERLINK(""https://docs.google.com/document/d/1K8H5-X0U3_G6_C7_E2rM0nJ4pQ0qA5/export?format=pdf"", ""Rivera v. Velasco"")",3RD DIVISION,05 Oct 2022,DECISION
107,"=HYPERLINK(""https://docs.google.com/document/d/1I6F3-V8S1_E4_A5_C0pS8nJ4pQ0qY3/export?format=pdf"", ""People v. XXX252230"")",3RD DIVISION,05 Oct 2022,DECISION
108,"=HYPERLINK(""https://docs.google.com/document/d/1G4D1-T6Q9_C2_Y3_A8nI6nJ4pQ0qW1/export?format=pdf"", ""Superior General of the Religious of the Virgin Mary (R.V.M.) v. Republic"")",3RD DIVISION,05 Oct 2022,DECISION
109,"=HYPERLINK(""https://docs.google.com/document/d/1E2B9-R4O7_A0_W1_Y6lG4nJ4pQ0qU9/export?format=pdf"", ""Republic v. Robiegie Corporation"")",3RD DIVISION,03 Oct 2022,DECISION
110,"=HYPERLINK(""https://docs.google.com/document/d/1C0Z7-P2M5_Y8_U9_W4jE2nJ4pQ0qS7/export?format=pdf"", ""Galindez v. Salamanca-Guzman"")",3RD DIVISION,28 Sep 2022,DECISION
111,"=HYPERLINK(""https://docs.google.com/document/d/1A8X5-N0K3_W6_S7_U2hC0nJ4pQ0qQ5/export?format=pdf"", ""Galbinez, Jr. v. McGerry's Restaurant"")",3RD DIVISION,28 Sep 2022,DECISION
112,"=HYPERLINK(""https://docs.google.com/document/d/186V3-L8I1_U4_Q5_S0fA8nJ4pQ0qO3/export?format=pdf"", ""Systems Energizer Corporation v. Bellville Development"")",3RD DIVISION,21 Sep 2022,DECISION
113,"=HYPERLINK(""https://docs.google.com/document/d/164T1-J6G9_S2_O3_Q8dY6nJ4pQ0qM1/export?format=pdf"", ""People v. Sernadilla"")",3RD DIVISION,21 Sep 2022,DECISION
114,"=HYPERLINK(""https://docs.google.com/document/d/142R9-H4E7_Q0_M1_O6bW4nJ4pQ0qK9/export?format=pdf"", ""Heirs of Spouses Binay v. Banaag"")",3RD DIVISION,07 Sep 2022,DECISION
115,"=HYPERLINK(""https://docs.google.com/document/d/120P7-F2C5_O8_K9_M4zU2nJ4pQ0qI7/export?format=pdf"", ""PNB v. Tad-y"")",3RD DIVISION,07 Sep 2022,DECISION
116,"=HYPERLINK(""https://docs.google.com/document/d/108N5-D0A3_M6_I7_K2xS0nJ4pQ0qG5/export?format=pdf"", ""Land Bank v. Spouses Cortez"")",3RD DIVISION,07 Sep 2022,DECISION
117,"=HYPERLINK(""https://docs.google.com/document/d/1y6L3-B8Y1_K4_G5_I0vQ8nJ4pQ0qE3/export?format=pdf"", ""Estate of Williams v. Percy"")",3RD DIVISION,31 Aug 2022,DECISION
118,"=HYPERLINK(""https://docs.google.com/document/d/1w4J1-Z6W9_I2_E3_G8tO6nJ4pQ0qC1/export?format=pdf"", ""Estomo v. CSC-X"")",3RD DIVISION,31 Aug 2022,DECISION
119,"=HYPERLINK(""https://docs.google.com/document/d/1u2H9-X4U7_G0_C1_E6rM4nJ4pQ0qA9/export?format=pdf"", ""Alarilla v. Lorenzo"")",3RD DIVISION,31 Aug 2022,DECISION
120,"=HYPERLINK(""https://docs.google.com/document/d/1s0F7-V2S5_E8_A9_C4pS2nJ4pQ0qY7/export?format=pdf"", ""Calisay v. Atty. Esplana"")",3RD DIVISION,23 Aug 2022,DECISION
121,"=HYPERLINK(""https://docs.google.com/document/d/1q8D5-T0Q3_C6_Y7_A2nI0nJ4pQ0qW5/export?format=pdf"", ""Sarion v. People"")",SPECIAL 1ST DIVISION,22 Aug 2022,RESOLUTION
122,"=HYPERLINK(""https://docs.google.com/document/d/1o6B3-R8O1_A4_W5_Y0lG8nJ4pQ0qU3/export?format=pdf"", ""NGCP v. Gaite"")",3RD DIVISION,17 Aug 2022,DECISION
123,"=HYPERLINK(""https://docs.google.com/document/d/1m4Z1-P6M9_Y2_U3_W8jE6nJ4pQ0qS1/export?format=pdf"", ""Cymar International, Inc. v. Farling Industrial"")",3RD DIVISION,17 Aug 2022,DECISION
124,"=HYPERLINK(""https://docs.google.com/document/d/1k2X9-N4K7_W0_S1_U6hC4nJ4pQ0qQ9/export?format=pdf"", ""Southstar Construction and Development v. Philippine Estates Corporation"")",3RD DIVISION,01 Aug 2022,DECISION
125,"=HYPERLINK(""https://docs.google.com/document/d/1i0V7-L2I5_U8_Q9_S4fA2nJ4pQ0qO7/export?format=pdf"", ""Spouses Vargas v. Sta. Lucia Realty and Development"")",3RD DIVISION,27 Jul 2022,DECISION
126,"=HYPERLINK(""https://docs.google.com/document/d/1g8T5-J0G3_S6_O7_Q2dY0nJ4pQ0qM5/export?format=pdf"", ""Hamid v. Gervasio Security and Investigation Agency"")",3RD DIVISION,27 Jul 2022,DECISION
127,"=HYPERLINK(""https://docs.google.com/document/d/1e6R3-H8E1_Q4_M5_O0bW8nJ4pQ0qK3/export?format=pdf"", ""Malones v. People"")",3RD DIVISION,20 Jul 2022,DECISION
128,"=HYPERLINK(""https://docs.google.com/document/d/1c4P1-F6C9_O2_K3_M8zU6nJ4pQ0qI1/export?format=pdf"", ""Amad v. Comelec"")",EN BANC,05 Jul 2022,DECISION
129,"=HYPERLINK(""https://docs.google.com/document/d/1a2N9-D4A7_M0_I1_K6xS4nJ4pQ0qG9/export?format=pdf"", ""People v. Pimentel"")",3RD DIVISION,15 Jun 2022,DECISION
130,"=HYPERLINK(""https://docs.google.com/document/d/1Y0L7-B2Y5_K8_G9_I4vQ2nJ4pQ0qE7/export?format=pdf"", ""People v. BBB252214"")",EN BANC,14 Jun 2022,DECISION
131,"=HYPERLINK(""https://docs.google.com/document/d/1W8J5-Z0W3_I6_E7_G2tO0nJ4pQ0qC5/export?format=pdf"", ""Republic v. Buenaventura"")",1ST DIVISION,05 Apr 2022,DECISION
132,"=HYPERLINK(""https://docs.google.com/document/d/1U6H3-X8U1_G4_C5_E0rM8nJ4pQ0qA3/export?format=pdf"", ""Mangayan v. Atty. Robielos III"")",EN BANC,05 Apr 2022,DECISION
133,"=HYPERLINK(""https://docs.google.com/document/d/1S4F1-V6S9_E2_A3_C8pS6nJ4pQ0qY1/export?format=pdf"", ""Bollozos v. Heirs of Vda. de Aguilar"")",1ST DIVISION,29 Mar 2022,DECISION
134,"=HYPERLINK(""https://docs.google.com/document/d/1Q2D9-T4Q7_C0_Y1_A6nI4nJ4pQ0qW9/export?format=pdf"", ""ABS-CBN v. Magno"")",1ST DIVISION,29 Mar 2022,DECISION
135,"=HYPERLINK(""https://docs.google.com/document/d/1O0B7-R2O5_A8_W9_Y4lG2nJ4pQ0qU7/export?format=pdf"", ""Cheng v. People"")",1ST DIVISION,23 Mar 2022,DECISION
136,"=HYPERLINK(""https://docs.google.com/document/d/1M8Z5-P0M3_Y6_U7_W2jE0nJ4pQ0qS5/export?format=pdf"", ""Rural Bank of Candelaria (Zambales) v. Banluta"")",1ST DIVISION,23 Mar 2022,DECISION
137,"=HYPERLINK(""https://docs.google.com/document/d/1K6X3-N8K1_W4_S5_U0hC8nJ4pQ0qQ3/export?format=pdf"", ""Ombudsman v. Rodas"")",1ST DIVISION,23 Mar 2022,DECISION
138,"=HYPERLINK(""https://docs.google.com/document/d/1I4V1-L6I9_U2_Q3_S8fA6nJ4pQ0qO1/export?format=pdf"", ""People v. Cerezo"")",1ST DIVISION,15 Mar 2022,DECISION
139,"=HYPERLINK(""https://docs.google.com/document/d/1G2T9-J4G7_S0_O1_Q6dY4nJ4pQ0qM9/export?format=pdf"", ""Metrobank v. Salazar Realty Corporation"")",1ST DIVISION,09 Mar 2022,DECISION
140,"=HYPERLINK(""https://docs.google.com/document/d/1E0R7-H2E5_Q8_M9_O4bW2nJ4pQ0qK7/export?format=pdf"", ""People v. Ramoy"")",1ST DIVISION,09 Mar 2022,DECISION
141,"=HYPERLINK(""https://docs.google.com/document/d/1C8P5-F0C3_O6_K7_M2zU0nJ4pQ0qI5/export?format=pdf"", ""Valderas v. Sulse"")",1ST DIVISION,09 Mar 2022,DECISION
142,"=HYPERLINK(""https://docs.google.com/document/d/1A6N3-D8A1_M4_I5_K0xS8nJ4pQ0qG3/export?format=pdf"", ""De Leon v. Asombrado-Llacuna"")",1ST DIVISION,02 Mar 2022,DECISION
143,"=HYPERLINK(""https://docs.google.com/document/d/184L1-B6Y9_K2_G3_I8vQ6nJ4pQ0qE1/export?format=pdf"", ""Ombudsman v. Hermosura"")",2ND DIVISION,16 Feb 2022,DECISION
144,"=HYPERLINK(""https://docs.google.com/document/d/162J9-Z4W7_I0_E1_G6tO4nJ4pQ0qC9/export?format=pdf"", ""People v. XXX254254"")",2ND DIVISION,16 Feb 2022,DECISION
145,"=HYPERLINK(""https://docs.google.com/document/d/140H7-X2U5_G8_C9_E4rM2nJ4pQ0qA7/export?format=pdf"", ""Malate Construction Development v. Extraordinary Realty Agents & Brokers Cooperative"")",2ND DIVISION,05 Jan 2022,DECISION
146,"=HYPERLINK(""https://docs.google.com/document/d/128F5-V0S3_E6_A7_C2pS0nJ4pQ0qY5/export?format=pdf"", ""Saint Wealth Ltd. v. BIR"")",EN BANC,07 Dec 2021,DECISION
147,"=HYPERLINK(""https://docs.google.com/document/d/106D3-T8Q1_C4_Y5_A0nI8nJ4pQ0qW3/export?format=pdf"", ""Limcoma Labor Organization (LLO)-PLAC v. Limcoma Multi-purpose Coop. (Limcoma)"")",2ND DIVISION,29 Nov 2021,DECISION
148,"=HYPERLINK(""https://docs.google.com/document/d/1y4B1-R6O9_A2_W3_Y8lG6nJ4pQ0qU1/export?format=pdf"", ""Acosta v. People"")",2ND DIVISION,24 Nov 2021,DECISION
149,"=HYPERLINK(""https://docs.google.com/document/d/1w2Z9-P4M7_Y0_U1_W6jE4nJ4pQ0qS9/export?format=pdf"", ""Corpuz v. COA"")",EN BANC,23 Nov 2021,DECISION
150,"=HYPERLINK(""https://docs.google.com/document/d/1u0X7-N2K5_W8_S9_U4hC2nJ4pQ0qQ7/export?format=pdf"", ""People v. Montilla"")",2ND DIVISION,22 Nov 2021,DECISION
151,"=HYPERLINK(""https://docs.google.com/document/d/1s8V5-L0I3_T6gG7_s2bA0nJ8pP4qO5/export?format=pdf"", ""BW Shipping Philippines v. Ong"")",2ND DIVISION,17 Nov 2021,DECISION
152,"=HYPERLINK(""https://docs.google.com/document/d/1q6T3-J8G1_R4eE5_q0zY8nJ6pR2qM3/export?format=pdf"", ""Spouses Domasian v. Demdam"")",2ND DIVISION,17 Nov 2021,DECISION
153,"=HYPERLINK(""https://docs.google.com/document/d/1o4R1-H6E9_P2cC3_o8xW6nJ4pQ0qK1/export?format=pdf"", ""Bawasanta v. People"")",2ND DIVISION,17 Nov 2021,DECISION
154,"=HYPERLINK(""https://docs.google.com/document/d/1m2P9-F4C7_N0aA1_m6vU4nJ2pQ8qI9/export?format=pdf"", ""Coca-Cola FEMSA Philippines, Inc. v. Coca-Cola FEMSA Phils."")",2ND DIVISION,17 Nov 2021,DECISION
155,"=HYPERLINK(""https://docs.google.com/document/d/1k0N7-D2A5_M8_I9_k4tS2nJ0pQ6qG7/export?format=pdf"", ""Poeple v. Palabrica III"")",2ND DIVISION,17 Nov 2021,DECISION
156,"=HYPERLINK(""https://docs.google.com/document/d/1i8L5-B0Y3_K6_G7_i2rQ0nJ8pQ0qE5/export?format=pdf"", ""Bernardo v. Dimaya"")",2ND DIVISION,10 Nov 2021,DECISION
157,"=HYPERLINK(""https://docs.google.com/document/d/1g6J3-Z8W1_I4_E5_g0tO8nJ6pR2qC3/export?format=pdf"", ""McConell Dowell Phil., Inc. v. Bernal"")",2ND DIVISION,10 Nov 2021,DECISION
158,"=HYPERLINK(""https://docs.google.com/document/d/1e4H1-X6U9_G2_C3_e8rM6nJ4pQ0qA1/export?format=pdf"", ""SBMA v. Subic Bay Marine Exploratorium"")",2ND DIVISION,10 Nov 2021,DECISION
159,"=HYPERLINK(""https://docs.google.com/document/d/1c2F9-V4S7_E0_A1_c6pK4nJ2pR8qY9/export?format=pdf"", ""Padojinog v. Ombudsman"")",2ND DIVISION,13 Oct 2021,DECISION
160,"=HYPERLINK(""https://docs.google.com/document/d/1a0D7-T2Q5_C8_Y9_a4nI2nJ6pR2qW7/export?format=pdf"", ""People v. Amara"")",2ND DIVISION,13 Oct 2021,DECISION
161,"=HYPERLINK(""https://docs.google.com/document/d/1Y8B5-R0O3_A6_W7_Y2lG0nJ4pQ0qU5/export?format=pdf"", ""Gutierrez v. People"")",2ND DIVISION,13 Oct 2021,DECISION
162,"=HYPERLINK(""https://docs.google.com/document/d/1W6Z3-P8M1_Y4_U5_W0jE8nJ2pR2qS3/export?format=pdf"", ""Atty. Kayaban, Jr. v. Atty. Palicte, III"")",EN BANC,05 Oct 2021,DECISION
163,"=HYPERLINK(""https://docs.google.com/document/d/1U4X1-N6K9_W2_S3_U8hC6nJ4pQ0qQ1/export?format=pdf"", ""Lucero v. Delfino"")",2ND DIVISION,29 Sep 2021,DECISION
164,"=HYPERLINK(""https://docs.google.com/document/d/1S2V9-L4I7_U0_Q1_S6fA4nJ2pR8qO9/export?format=pdf"", ""People v. Peralta"")",2ND DIVISION,29 Sep 2021,DECISION
165,"=HYPERLINK(""https://docs.google.com/document/d/1Q0T7-J2G5_S8_O9_Q4dY2nJ4pQ0qM7/export?format=pdf"", ""Berces v. CSC"")",2ND DIVISION,29 Sep 2021,DECISION
166,"=HYPERLINK(""https://docs.google.com/document/d/1O8R5-H0E3_Q6_M7_O2bW0nJ4pQ0qK5/export?format=pdf"", ""The Salvation Army v. SSS"")",2ND DIVISION,15 Sep 2021,DECISION
167,"=HYPERLINK(""https://docs.google.com/document/d/1M6P3-F8C1_O4_K5_M0zU8nJ4pQ0qI3/export?format=pdf"", ""Lagao v. People"")",2ND DIVISION,15 Sep 2021,DECISION
168,"=HYPERLINK(""https://docs.google.com/document/d/1I8N1-D6A9_M2_I3_K8xS6nJ4pQ0qG1/export?format=pdf"", ""Joven v. Spouses Tulio"")",2ND DIVISION,04 Aug 2021,DECISION
169,"=HYPERLINK(""https://docs.google.com/document/d/1G6L9-B4Y7_K0_G1_I6vQ4nJ4pQ0qE9/export?format=pdf"", ""Quitalig v. Quitalig"")",2ND DIVISION,04 Aug 2021,DECISION
170,"=HYPERLINK(""https://docs.google.com/document/d/1E4J7-Z2W5_I8_E9_G4tO2nJ4pQ0qC7/export?format=pdf"", ""CF Sharp Crew Management v. Cunanan"")",2ND DIVISION,04 Aug 2021,DECISION
171,"=HYPERLINK(""https://docs.google.com/document/d/1C2H5-X0U3_G6_C7_E2rM0nJ4pQ0qA5/export?format=pdf"", ""Anacay v. Atty. Alberto"")",2ND DIVISION,04 Aug 2021,DECISION
172,"=HYPERLINK(""https://docs.google.com/document/d/1A0F3-V8S1_E4_A5_C0pS8nJ4pQ0qY3/export?format=pdf"", ""Moreno v. Chateau Royale Sports and Country Club"")",2ND DIVISION,04 Aug 2021,DECISION
173,"=HYPERLINK(""https://docs.google.com/document/d/188D1-T6Q9_C2_Y3_A8nI6nJ4pQ0qW1/export?format=pdf"", ""Ebancuel v. Acierto"")",2ND DIVISION,28 Jul 2021,DECISION
174,"=HYPERLINK(""https://docs.google.com/document/d/166B9-R4O7_A0_W1_Y6lG4nJ4pQ0qU9/export?format=pdf"", ""Secretary of DAR v. Mendoza"")",1ST DIVISION,14 Jul 2021,DECISION
175,"=HYPERLINK(""https://docs.google.com/document/d/144Z7-P2M5_Y8_U9_W4jE2nJ4pQ0qS7/export?format=pdf"", ""People v. San Pedro"")",1ST DIVISION,14 Jul 2021,DECISION
176,"=HYPERLINK(""https://docs.google.com/document/d/122X5-N0K3_W6_S7_U2hC0nJ4pQ0qQ5/export?format=pdf"", ""Waterfront Philippines v. SSS"")",1ST DIVISION,06 Jul 2021,DECISION
177,"=HYPERLINK(""https://docs.google.com/document/d/100V3-L8I1_U4_Q5_S0fA8nJ4pQ0qO3/export?format=pdf"", ""People v. XXX218087"")",1ST DIVISION,06 Jul 2021,DECISION
178,"=HYPERLINK(""https://docs.google.com/document/d/1y8T1-J6G9_S2_O3_Q8dY6nJ4pQ0qM1/export?format=pdf"", ""BSM Crew Service Centre Phils., Inc. v. Llanita"")",1ST DIVISION,06 Jul 2021,DECISION
179,"=HYPERLINK(""https://docs.google.com/document/d/1w6R9-H4E7_Q0_M1_O6bW4nJ4pQ0qK9/export?format=pdf"", ""Crown Shipping Services v. Cervas"")",1ST DIVISION,06 Jul 2021,DECISION
180,"=HYPERLINK(""https://docs.google.com/document/d/1u4P7-F2C5_O8_K9_M4zU2nJ4pQ0qI7/export?format=pdf"", ""Imperial v. People"")",1ST DIVISION,30 Jun 2021,DECISION
181,"=HYPERLINK(""https://docs.google.com/document/d/1s2N5-D0A3_M6_I7_K2xS0nJ4pQ0qG5/export?format=pdf"", ""PLDT v. Domingo"")",1ST DIVISION,30 Jun 2021,DECISION
182,"=HYPERLINK(""https://docs.google.com/document/d/1q0L3-B8Y1_K4_G5_I0vQ8nJ4pQ0qE3/export?format=pdf"", ""Ambrose v. Suque-Ambrose"")",1ST DIVISION,23 Jun 2021,DECISION
183,"=HYPERLINK(""https://docs.google.com/document/d/1o8J1-Z6W9_I2_E3_G8tO6nJ4pQ0qC1/export?format=pdf"", ""Atienza v. TKC Heavy Industries Corporation"")",1ST DIVISION,23 Jun 2021,DECISION
184,"=HYPERLINK(""https://docs.google.com/document/d/1m6H9-X4U7_G0_C1_E6rM4nJ4pQ0qA9/export?format=pdf"", ""Almazan v. Bacolod"")",1ST DIVISION,16 Jun 2021,DECISION
185,"=HYPERLINK(""https://docs.google.com/document/d/1k4F7-V2S5_E8_A9_C4pS2nJ4pQ0qY7/export?format=pdf"", ""BSP v. Ombudsman"")",1ST DIVISION,16 Jun 2021,DECISION
186,"=HYPERLINK(""https://docs.google.com/document/d/1i2D5-T0Q3_C6_Y7_A2nI0nJ4pQ0qW5/export?format=pdf"", ""Authority of the Freeport Area of Bataan v. F.F. Cruz & Co., Inc."")",1ST DIVISION,14 May 2021,DECISION
187,"=HYPERLINK(""https://docs.google.com/document/d/1g0B3-R8O1_A4_W5_Y0lG8nJ4pQ0qU3/export?format=pdf"", ""Paga v. Judge Paderanga"")",1ST DIVISION,05 May 2021,RESOLUTION
188,"=HYPERLINK(""https://docs.google.com/document/d/1e8Z1-P6M9_Y2_U3_W8jE6nJ4pQ0qS1/export?format=pdf"", ""De Joya v. Madlangbayan"")",1ST DIVISION,28 Apr 2021,DECISION
189,"=HYPERLINK(""https://docs.google.com/document/d/1c6X9-N4K7_W0_S1_U6hC4nJ4pQ0qQ9/export?format=pdf"", ""Figueroa v. COA"")",EN BANC,27 Apr 2021,DECISION
190,"=HYPERLINK(""https://docs.google.com/document/d/1a4V7-L2I5_U8_Q9_S4fA2nJ4pQ0qO7/export?format=pdf"", ""Cagayan de Oro Water District v. COA"")",EN BANC,27 Apr 2021,DECISION
191,"=HYPERLINK(""https://docs.google.com/document/d/1Y2T5-J0G3_S6_O7_Q2dY0nJ4pQ0qM5/export?format=pdf"", ""People v. Toledo"")",1ST DIVISION,24 Mar 2021,DECISION
192,"=HYPERLINK(""https://docs.google.com/document/d/1W0R3-H8E1_Q4_M5_O0bW8nJ4pQ0qK3/export?format=pdf"", ""Feliciano v. People"")",1ST DIVISION,18 Mar 2021,DECISION
193,"=HYPERLINK(""https://docs.google.com/document/d/1U8P1-F6C9_O2_K3_M8zU6nJ4pQ0qI1/export?format=pdf"", ""Philippine Transmarine Carriers v. Manzano"")",1ST DIVISION,18 Mar 2021,DECISION
194,"=HYPERLINK(""https://docs.google.com/document/d/1S6N9-D4A7_M0_I1_K6xS4nJ4pQ0qG9/export?format=pdf"", ""Sarion v. People"")",1ST DIVISION,18 Mar 2021,DECISION
195,"=HYPERLINK(""https://docs.google.com/document/d/1Q4L7-B2Y5_K8_G9_I4vQ2nJ4pQ0qE7/export?format=pdf"", ""Toston v. People"")",1ST DIVISION,03 Mar 2021,DECISION
196,"=HYPERLINK(""https://docs.google.com/document/d/1O2J5-Z0W3_I6_E7_G2tO0nJ4pQ0qC5/export?format=pdf"", ""People v. Coritana"")",1ST DIVISION,03 Mar 2021,DECISION
197,"=HYPERLINK(""https://docs.google.com/document/d/1M0H3-X8U1_G4_C5_E0rM8nJ4pQ0qA3/export?format=pdf"", ""Quisumbing v. Ochoa"")",1ST DIVISION,03 Mar 2021,DECISION
198,"=HYPERLINK(""https://docs.google.com/document/d/1K8F1-V6S9_E2_A3_C8pS6nJ4pQ0qY1/export?format=pdf"", ""Toyo Seat Philippines v. Velasco"")",1ST DIVISION,03 Mar 2021,DECISION
199,"=HYPERLINK(""https://docs.google.com/document/d/1I6D9-T4Q7_C0_Y1_A6nI4nJ4pQ0qW9/export?format=pdf"", ""Emzee Foods, Inc. v. Elarfoods, Inc."")",1ST DIVISION,17 Feb 2021,DECISION
200,"=HYPERLINK(""https://docs.google.com/document/d/1G4B7-R2O5_A8_W9_Y4lG2nJ4pQ0qU7/export?format=pdf"", ""PNB v. Oaminal"")",1ST DIVISION,17 Feb 2021,DECISION
201,"=HYPERLINK(""https://docs.google.com/document/d/1E2Z5-P0M3_Y6_U7_W2jE0nJ4pQ0qS5/export?format=pdf"", ""Republic v. Asuncion"")",1ST DIVISION,17 Feb 2021,DECISION
202,"=HYPERLINK(""https://docs.google.com/document/d/1C0X3-N8K1_W4_S5_U0hC8nJ4pQ0qQ3/export?format=pdf"", ""Quijano v. People"")",1ST DIVISION,10 Feb 2021,DECISION
203,"=HYPERLINK(""https://docs.google.com/document/d/1A8V1-L6I9_U2_Q3_S8fA6nJ4pQ0qO1/export?format=pdf"", ""Banta v. Equitable Bank, Inc."")",1ST DIVISION,10 Feb 2021,DECISION
204,"=HYPERLINK(""https://docs.google.com/document/d/186T9-J4G7_S0_O1_Q6dY4nJ4pQ0qM9/export?format=pdf"", ""Torm Shipping Philippines, Inc. v. Alacre"")",1ST DIVISION,26 Jan 2021,DECISION
205,"=HYPERLINK(""https://docs.google.com/document/d/164R7-H2E5_Q8_M9_O4bW2nJ4pQ0qK7/export?format=pdf"", ""Yambao v. Republic"")",1ST DIVISION,26 Jan 2021,DECISION
206,"=HYPERLINK(""https://docs.google.com/document/d/142P5-F0C3_O6_K7_M2zU0nJ4pQ0qI5/export?format=pdf"", ""Bernasconi v. Atty. Demaisip"")",EN BANC,19 Jan 2021,DECISION
207,"=HYPERLINK(""https://docs.google.com/document/d/120N3-D8A1_M4_I5_K0xS8nJ4pQ0qG3/export?format=pdf"", ""Metrobank v. Cruz"")",1ST DIVISION,19 Jan 2021,DECISION
208,"=HYPERLINK(""https://docs.google.com/document/d/108L1-B6Y9_K2_G3_I8vQ6nJ4pQ0qE1/export?format=pdf"", ""Balina v. People"")",1ST DIVISION,12 Jan 2021,DECISION
209,"=HYPERLINK(""https://docs.google.com/document/d/1y6J9-Z4W7_I0_E1_G6tO4nJ4pQ0qC9/export?format=pdf"", ""Philippine Phosphate Fertilizer Corporation v. Mayol"")",1ST DIVISION,09 Dec 2020,DECISION
210,"=HYPERLINK(""https://docs.google.com/document/d/1w4H7-X2U5_G8_C9_E4rM2nJ4pQ0qA7/export?format=pdf"", ""International Container Terminal Services, Inc. v. Ang"")",1ST DIVISION,09 Dec 2020,DECISION
211,"=HYPERLINK(""https://docs.google.com/document/d/1u2F5-V0S3_E6_A7_C2pS0nJ4pQ0qY5/export?format=pdf"", ""Municipality of Isabel, Leyte v. Municipality of Merida, Leyte"")",1ST DIVISION,09 Dec 2020,DECISION
212,"=HYPERLINK(""https://docs.google.com/document/d/1s0D3-T8Q1_C4_Y5_A0nI8nJ4pQ0qW3/export?format=pdf"", ""Menzon v. COA"")",EN BANC,09 Dec 2020,DECISION
213,"=HYPERLINK(""https://docs.google.com/document/d/1q8B1-R6O9_A2_W3_Y8lG6nJ4pQ0qU1/export?format=pdf"", ""OCA v. Judge Atienza-Turla"")",EN BANC,09 Dec 2020,DECISION
214,"=HYPERLINK(""https://docs.google.com/document/d/1o6Z9-P4M7_Y0_U1_W6jE4nJ4pQ0qS9/export?format=pdf"", ""Paez v. Marinduque Electric Cooperative, Inc."")",1ST DIVISION,09 Dec 2020,DECISION
215,"=HYPERLINK(""https://docs.google.com/document/d/1m4X7-N2K5_W8_S9_U4hC2nJ4pQ0qQ7/export?format=pdf"", ""Crisologo v. Hao"")",1ST DIVISION,02 Dec 2020,DECISION
216,"=HYPERLINK(""https://docs.google.com/document/d/1k2V5-L0I3_T6gG7_s2bA0nJ8pP4qO5/export?format=pdf"", ""People v. Barrera"")",EN BANC,01 Dec 2020,DECISION
217,"=HYPERLINK(""https://docs.google.com/document/d/1i0T3-J8G1_R4eE5_q0zY8nJ4pQ0qM3/export?format=pdf"", ""OSG Shipmanagement Manila, Inc. v. De Jesus"")",1ST DIVISION,18 Nov 2020,DECISION
218,"=HYPERLINK(""https://docs.google.com/document/d/1g8R1-H6E9_P2cC3_o8xW6nJ4pQ0qK1/export?format=pdf"", ""POEA v. COA"")",EN BANC,17 Nov 2020,DECISION
219,"=HYPERLINK(""https://docs.google.com/document/d/1e6P9-F4C7_N0aA1_m6vU4nJ2pQ8qI9/export?format=pdf"", ""Ombudsman v. Rondon"")",1ST DIVISION,10 Nov 2020,DECISION
220,"=HYPERLINK(""https://docs.google.com/document/d/1c4N7-D2A5_M8_I9_k4tS2nJ0pQ6qG7/export?format=pdf"", ""Torreta v. COA"")",EN BANC,10 Nov 2020,DECISION
221,"=HYPERLINK(""https://docs.google.com/document/d/1a2L5-B0Y3_K6_G7_i2rQ0nJ8pQ0qE5/export?format=pdf"", ""AFP v. Amogod"")",IST DIVISION,10 Nov 2020,DECISION
222,"=HYPERLINK(""https://docs.google.com/document/d/1Y0J3-Z8W1_I4_E5_g0tO8nJ6pR2qC3/export?format=pdf"", ""UEM Mara Philippines v. Wee"")",3RD DIVISION,14 Oct 2020,DECISION
223,"=HYPERLINK(""https://docs.google.com/document/d/1W8H1-X6U9_G2_C3_e8rM6nJ4pQ0qA1/export?format=pdf"", ""Philconstruct Resources, Inc. v. Aquino"")",3RD DIVISION,07 Oct 2020,DECISION
224,"=HYPERLINK(""https://docs.google.com/document/d/1U6F9-V4S7_E0_A1_c6pK4nJ2pR8qY9/export?format=pdf"", ""People v. Loma"")",3RD DIVISION,05 Oct 2020,DECISION
225,"=HYPERLINK(""https://docs.google.com/document/d/1S4D7-T2Q5_C8_Y9_a4nI2nJ6pR2qW7/export?format=pdf"", ""Salas v. Bunyi-Medina"")",3RD DIVISION,28 Sep 2020,DECISION
226,"=HYPERLINK(""https://docs.google.com/document/d/1Q2B5-R0O3_A6_W7_Y2lG0nJ4pQ0qU5/export?format=pdf"", ""Land Bank v. Hilado"")",3RD DIVISION,23 Sep 2020,DECISION
227,"=HYPERLINK(""https://docs.google.com/document/d/1O0Z3-P8M1_Y4_U5_W0jE8nJ2pR2qS3/export?format=pdf"", ""Land Bank v. Esteban"")",3RD DIVISION,23 Sep 2020,DECISION
228,"=HYPERLINK(""https://docs.google.com/document/d/1M8X1-N6K9_W2_S3_U8hC6nJ4pQ0qQ1/export?format=pdf"", ""De Castro v. COA"")",EN BANC,22 Sep 2020,DECISION
229,"=HYPERLINK(""https://docs.google.com/document/d/1K6V9-L4I7_U0_Q1_S6fA4nJ2pR8qO9/export?format=pdf"", ""People v. Archivido"")",3RD DIVISION,21 Sep 2020,DECISION
230,"=HYPERLINK(""https://docs.google.com/document/d/1I4T7-J2G5_S8_O9_Q4dY2nJ4pQ0qM7/export?format=pdf"", ""Balbarino v. Pacific Ocean Manning, Inc."")",3RD DIVISION,21 Sep 2020,DECISION
231,"=HYPERLINK(""https://docs.google.com/document/d/1G2R5-H0E3_Q6_M7_O2bW0nJ4pQ0qK5/export?format=pdf"", ""Ingram v. Atty. Lorica IV"")",3RD DIVISION,16 Sep 2020,DECISION
232,"=HYPERLINK(""https://docs.google.com/document/d/1E0P3-F8C1_O4_K5_M0zU8nJ4pQ0qI3/export?format=pdf"", ""Judge Ramos v. Atty. Lazo"")",3RD DIVISION,14 Sep 2020,DECISION
233,"=HYPERLINK(""https://docs.google.com/document/d/1C8N1-D6A9_M2_I3_K8xS6nJ4pQ0qG1/export?format=pdf"", ""Santos v. V.C. Development Corporation"")",3RD DIVISION,09 Sep 2020,DECISION
234,"=HYPERLINK(""https://docs.google.com/document/d/1A6L9-B4Y7_K0_G1_I6vQ4nJ4pQ0qE9/export?format=pdf"", ""Sismaet v. Atty. Cruzabra"")",3RD DIVISION,07 Sep 2020,DECISION
235,"=HYPERLINK(""https://docs.google.com/document/d/184J7-Z2W5_I8_E9_G4tO2nJ4pQ0qC7/export?format=pdf"", ""IP E-Game Ventures, Inc. v. Beijing Perfect World Software Co., Ltd."")",3RD DIVISION,07 Sep 2020,DECISION
236,"=HYPERLINK(""https://docs.google.com/document/d/162H5-X0U3_G6_C7_E2rM0nJ4pQ0qA5/export?format=pdf"", ""Unirock Corporation v. CA"")",3RD DIVISION,07 Sep 2020,DECISION
237,"=HYPERLINK(""https://docs.google.com/document/d/140F3-V8S1_E4_A5_C0pS8nJ4pQ0qY3/export?format=pdf"", ""DBP v. Ronquillo"")",3RD DIVISION,07 Sep 2020,DECISION
238,"=HYPERLINK(""https://docs.google.com/document/d/128D1-T6Q9_C2_Y3_A8nI6nJ4pQ0qW1/export?format=pdf"", ""Sierra Grande Realty Corporation v. Ragasa"")",3RD DIVISION,02 Sep 2020,DECISION
239,"=HYPERLINK(""https://docs.google.com/document/d/106B9-R4O7_A0_W1_Y6lG4nJ4pQ0qU9/export?format=pdf"", ""Reyes v. Elquiero"")",3RD DIVISION,02 Sep 2020,DECISION
240,"=HYPERLINK(""https://docs.google.com/document/d/1y4Z7-P2M5_Y8_U9_W4jE2nJ4pQ0qS7/export?format=pdf"", ""Bahia Shipping Services, Inc. v. Castillo"")",3RD DIVISION,02 Sep 2020,DECISION
241,"=HYPERLINK(""https://docs.google.com/document/d/1w2X5-N0K3_W6_S7_U2hC0nJ4pQ0qQ5/export?format=pdf"", ""Realiza v. People"")",3RD DIVISION,26 Aug 2020,DECISION
242,"=HYPERLINK(""https://docs.google.com/document/d/1u0V3-L8I1_U4_Q5_S0fA8nJ4pQ0qO3/export?format=pdf"", ""People v. Lopez"")",3RD DIVISION,15 Jul 2020,DECISION
243,"=HYPERLINK(""https://docs.google.com/document/d/1s8T1-J6G9_S2_O3_Q8dY6nJ4pQ0qM1/export?format=pdf"", ""Dayandayan v. Spouses Rojas"")",3RD DIVISION,15 Jul 2020,DECISION
244,"=HYPERLINK(""https://docs.google.com/document/d/1q6R9-H4E7_Q0_M1_O6bW4nJ4pQ0qK9/export?format=pdf"", ""People v. Tamano"")",3RD DIVISION,08 Jul 2020,DECISION
245,"=HYPERLINK(""https://docs.google.com/document/d/1o4P7-F2C5_O8_K9_M4zU2nJ4pQ0qI7/export?format=pdf"", ""Basagan v. Atty. Espina"")",3RD DIVISION,08 Jul 2020,DECISION
246,"=HYPERLINK(""https://docs.google.com/document/d/1m2N5-D0A3_M6_I7_K2xS0nJ4pQ0qG5/export?format=pdf"", ""Heirs of Torrices v. Atty. Galano"")",EN BANC,07 Jul 2020,RESOLUTION
247,"=HYPERLINK(""https://docs.google.com/document/d/1k0L3-B8Y1_K4_G5_I0vQ8nJ4pQ0qE3/export?format=pdf"", ""Dela Cruz v. Parumog"")",3RD DIVISION,17 Jun 2020,DECISION
248,"=HYPERLINK(""https://docs.google.com/document/d/1T9saNLr2DpKFdZM4FzxrcWPd6KWb9hf7g7479Nu2_tk/export?format=pdf"", ""Land Bank v. Catadman"")",3RD DIVISION,17 Jun 2020,DECISION
249,"=HYPERLINK(""https://docs.google.com/document/d/1aRBzpK_ISVV4hVnqbOQJMU9yVvlM7NFvurmTk3MZhmU/export?format=pdf"", ""BPI Family Savings Bank, Inc. v. Spouses Soriano"")",3RD DIVISION,08 Jun 2020,DECISION
250,"=HYPERLINK(""https://docs.google.com/document/d/16xDe60MhrSqSsaCaylO8fs5pWGLUwrMDZyjXuHZVOac/export?format=pdf"", ""People v. Manzanilla"")",3RD DIVISION,08 Jun 2020,DECISION
251,"=HYPERLINK(""https://docs.google.com/document/d/1sGMuJ08pTJRNwod9wgTDtoCo_YKHaowU2UHlEAL1nwk/export?format=pdf"", ""Nacarion v. People"")",3RD DIVISION,08 Jun 2020,DECISION
252,"=HYPERLINK(""https://docs.google.com/document/d/1wlIDG0oZZSR1V1kaSRmSx4qdflKioLv4-qd8JhFzyRo/export?format=pdf"", ""Violago v. Atty. Aranjuez, Jr."")",3RD DIVISION,09 Mar 2020,RESOLUTION`;
 
       // APP STATE
       let allCases = [];
       let sortConfig = { column: 0, direction: 'asc' }; // default sort by No.
       const STORAGE_KEY = 'gaerlan_tracker_v1';
 
       // Load Data from Storage
       function getStorageData() {
           return JSON.parse(localStorage.getItem(STORAGE_KEY)) || {};
       }
 
       // Save Data to Storage
       function updateStorage(caseId, field, value) {
           const data = getStorageData();
           if (!data[caseId]) data[caseId] = {};
           data[caseId][field] = value;
           localStorage.setItem(STORAGE_KEY, JSON.stringify(data));
           updateStats();
       }
 
       // Initial Data Parse
// Initial Data Parse
       async function init() { // Added 'async'
           const lines = csvData.trim().split('\n');
           let savedData = getStorageData();
           allCases = [];

           // --- NEW: PRELOAD FROM GITHUB ---
           // Only preload if the user's local storage is empty to avoid overwriting their edits
           if (Object.keys(savedData).length === 0) {
               try {
const response = await fetch('https://raw.githubusercontent.com/ariiannemay/2026-Bar-Exam-Tracker/main/data.json');
                   if (response.ok) {
                       const preloadedData = await response.json();
                       localStorage.setItem(STORAGE_KEY, JSON.stringify(preloadedData));
                       savedData = preloadedData;
                       console.log("Digests preloaded from GitHub.");
                   }
               } catch (err) {
                   console.error("Could not load preload file:", err);
               }
           }
 
           for (let i = 1; i < lines.length; i++) {
               const row = lines[i];
               const firstComma = row.indexOf(',');
               const lastComma = row.lastIndexOf(',');
               const secondLastComma = row.lastIndexOf(',', lastComma - 1);
               const thirdLastComma = row.lastIndexOf(',', secondLastComma - 1);
 
               if (firstComma === -1 || lastComma === -1) continue;
 
               const no = row.substring(0, firstComma).trim();
               const division = row.substring(thirdLastComma + 1, secondLastComma).trim();
               const date = row.substring(secondLastComma + 1, lastComma).trim();
               const type = row.substring(lastComma + 1).trim();
               
               let rawLink = row.substring(firstComma + 1, thirdLastComma).trim();
               if (rawLink.startsWith('"') && rawLink.endsWith('"')) rawLink = rawLink.slice(1, -1);
               
               let url = "#", title = rawLink;
               const match = rawLink.match(/=HYPERLINK\(""([^"]+)""\s*,\s*""([^"]+)""\)/i);
               if (match) { url = match[1]; title = match[2]; }
               else { title = rawLink.replace(/^=HYPERLINK\("/, '').replace(/"\)$/, ''); }
 
               allCases.push({no, title, division, date, type, url});
           }
           
           lucide.createIcons();
           renderTable();
           updateStats();
       }
 
// NOTEPAD PERSISTENCE (ADD THIS BLOCK) 
const NOTEPAD_KEY = '2026_bar_review_notes';

// Function to wait for an element to appear in the DOM (polls every 100ms, up to 10 seconds)
function waitForElement(selector, callback, timeout = 10000, interval = 100) {
    const startTime = Date.now();
    const checkExist = setInterval(() => {
        const element = document.querySelector(selector);
        if (element) {
            clearInterval(checkExist);
            callback(element);
        } else if (Date.now() - startTime > timeout) {
            clearInterval(checkExist);
            console.warn(`Element ${selector} not found after ${timeout}ms`);
        }
    }, interval);
}

// Use the waiter to load and attach listeners once #review-notes exists
waitForElement('#review-notes', (reviewNotes) => {
    // 1. Load saved note
    const saved = localStorage.getItem(NOTEPAD_KEY);
    if (saved !== null) {
        reviewNotes.value = saved;
    }

    // 2. Save automatically while typing (debounced)
    let notepadTimeout;
    reviewNotes.addEventListener('input', (e) => {
        clearTimeout(notepadTimeout);
        notepadTimeout = setTimeout(() => {
            localStorage.setItem(NOTEPAD_KEY, e.target.value);
        }, 400); // Saves 400ms after typing stops
    });

    // 3. Save on blur (extra safety, e.g., when clicking away)
    reviewNotes.addEventListener('blur', (e) => {
        localStorage.setItem(NOTEPAD_KEY, e.target.value);
    });
});

       // RENDER TABLE
       function renderTable() {
           const tbody = document.getElementById('caseTableBody');
           const savedData = getStorageData();
           const searchTerm = document.getElementById('searchInput').value.toLowerCase();
           const filterDiv = document.getElementById('filterDivision').value;
           const filterType = document.getElementById('filterType').value;
 
           // 1. Filter
           let filteredCases = allCases.filter(c => {
               const matchesSearch = c.title.toLowerCase().includes(searchTerm) ||
                                     c.no.includes(searchTerm) ||
                                     c.date.toLowerCase().includes(searchTerm);
               const matchesDiv = filterDiv === "" || c.division === filterDiv;
               const matchesType = filterType === "" || c.type === filterType;
               
               return matchesSearch && matchesDiv && matchesType;
           });
 
           document.getElementById('visibleCount').innerText = filteredCases.length;
 
           // 2. Sort
           filteredCases.sort((a, b) => {
               let valA, valB;
               
               if (sortConfig.column === 0) { // No.
                   valA = parseInt(a.no); valB = parseInt(b.no);
               } else if (sortConfig.column === 1) { // Title
                   valA = a.title.toLowerCase(); valB = b.title.toLowerCase();
               } else if (sortConfig.column === 2) { // Division
                   valA = a.division.toLowerCase(); valB = b.division.toLowerCase();
               } else if (sortConfig.column === 3) { // Date
                   valA = new Date(a.date); valB = new Date(b.date);
               } else if (sortConfig.column === 4) { // Type
                   valA = a.type.toLowerCase(); valB = b.type.toLowerCase();
               }
 
               if (valA < valB) return sortConfig.direction === 'asc' ? -1 : 1;
               if (valA > valB) return sortConfig.direction === 'asc' ? 1 : -1;
               return 0;
           });
 
           // 3. Render HTML
           let html = '';
           filteredCases.forEach(c => {
               const caseState = savedData[c.no] || {};
               const digestExists = caseState.digest && (caseState.digest.doctrine || caseState.digest.facts || caseState.digest.issue || caseState.digest.ruling);
               
               // Division Color Logic
               let divBadgeClass = "bg-gray-100 text-gray-600";
               if (c.division.includes("EN BANC")) divBadgeClass = "bg-red-100 text-red-800 border border-red-200";
               else if (c.division.includes("1ST")) divBadgeClass = "bg-blue-100 text-blue-800 border border-blue-200";
               else if (c.division.includes("2ND")) divBadgeClass = "bg-teal-100 text-teal-800 border border-teal-200";
               else if (c.division.includes("3RD")) divBadgeClass = "bg-orange-100 text-orange-800 border border-orange-200";
 
               // Type Color Logic
               const isDecision = c.type.toUpperCase().includes('DECISION');
               const typeBadgeClass = isDecision ? 'bg-green-100 text-green-700' : 'bg-yellow-100 text-yellow-700';
               
               // Digest Button Logic
               const digestBtnClass = digestExists ? 'bg-emerald-500 text-white shadow-md hover:bg-emerald-600' : 'bg-white text-gray-500 border border-gray-200 hover:border-[#FECE1B] hover:text-[#6D1B1B]';
               const digestIcon = digestExists ? 'check' : 'plus';
               const digestText = digestExists ? 'View' : 'Add';
 
html += `
<tr class="hover:bg-gray-200 transition-colors group border-b border-gray-50 last:border-b-0">
    <td class="px-2 py-0.5 font-medium text-gray-400 text-[9px]">${c.no}</td>
    <td class="px-3 py-0.5">
        <a href="${c.url}" target="_blank" class="text-blue-700 hover:text-black font-bold text-sm block leading-tight group-hover:underline">
            ${c.title}
        </a>
    </td>
    <td class="px-3 py-0.5 text-center">
        <span class="px-2 py-0.5 inline-flex text-[10px] font-bold uppercase rounded-md tracking-wider ${divBadgeClass}">${c.division}</span>
    </td>
    <td class="px-3 py-0.5 text-center text-xs text-gray-500 whitespace-nowrap font-medium">${c.date}</td>
    <td class="px-3 py-0.5 text-center">
        <span class="px-2 py-0.5 inline-flex text-[10px] font-bold uppercase rounded-md tracking-wider ${typeBadgeClass}">${c.type}</span>
    </td>
    <td class="px-3 py-0.5 text-center">
        <button onclick="openDigestModal('${c.no}', '${c.title.replace(/'/g, "\\'")}')"
                id="btn-digest-${c.no}"
                class="inline-flex items-center gap-1.5 px-2 py-0.5 rounded-md text-[10px] font-bold uppercase tracking-wide transition-all ${digestBtnClass}">
            <i data-lucide="${digestIcon}" class="w-3 h-3"></i> ${digestText}
        </button>
    </td>
    <td class="px-3 py-0.5 text-center">
        <div class="flex justify-center">
            <input type="checkbox" class="custom-checkbox w-4 h-4"
                   onchange="updateStorage('${c.no}', 'done', this.checked)"
                   ${caseState.done ? 'checked' : ''}>
        </div>
    </td>
</tr>`;
           });
           

           tbody.innerHTML = html;
           lucide.createIcons();
       }
 
       // --- SORTING ---
       function sortTable(columnIndex, type) {
           // Toggle direction if clicking same column
           if (sortConfig.column === columnIndex) {
               sortConfig.direction = sortConfig.direction === 'asc' ? 'desc' : 'asc';
           } else {
               sortConfig.column = columnIndex;
               sortConfig.direction = 'asc';
           }
           renderTable();
       }
 
       // --- FILTER ---
function filterTable() {
    renderTable();
    // Reset the "Check All" box when filtering
    document.getElementById('checkAll').checked = false;
}

// --- TOGGLE ALL ---
function toggleAll(masterCheckbox) {
    const isChecked = masterCheckbox.checked;
    const searchTerm = document.getElementById('searchInput').value.toLowerCase();
    const filterDiv = document.getElementById('filterDivision').value;
    const filterType = document.getElementById('filterType').value;

    // Filter allCases using the same logic as renderTable to get currently visible IDs
    allCases.forEach(c => {
        const matchesSearch = c.title.toLowerCase().includes(searchTerm) ||
                              c.no.includes(searchTerm) ||
                              c.date.toLowerCase().includes(searchTerm);
        const matchesDiv = filterDiv === "" || c.division === filterDiv;
        const matchesType = filterType === "" || c.type === filterType;

        if (matchesSearch && matchesDiv && matchesType) {
            updateStorage(c.no, 'done', isChecked);
        }
    });

    renderTable(); // Refresh the UI
} 
// START EDITING HERE: CLEAN UP updateStats
function updateStats() {
    const data = getStorageData();
    const total = allCases.length;
    let done = 0;
    Object.values(data).forEach(c => { if(c.done) done++; });
    const remaining = total - done;
    const donePercent = total > 0 ? (done / total) * 100 : 0;

    // 1. Update the sidebar/mini bar (if it exists)
    const caseBar = document.getElementById('caseProgressBar');
    if (caseBar) {
        caseBar.style.width = `${donePercent}%`;
        // Reset classes first
        caseBar.classList.remove('bg-black', 'bg-red-500', 'bg-orange-500', 'bg-yellow-400', 'bg-green-500');
        
        // Apply progressive colors
        if (donePercent <= 25) caseBar.classList.add('bg-red-500');
        else if (donePercent <= 50) caseBar.classList.add('bg-orange-500');
        else if (donePercent <= 75) caseBar.classList.add('bg-yellow-400');
        else caseBar.classList.add('bg-green-500');
    }

    // 2. Update the Large Header Progress Bar (inside the Gaerlan section)
    const headerBar = document.getElementById('headerProgressBar');
    if (headerBar) {
        headerBar.style.width = `${donePercent}%`;
        headerBar.classList.remove('bg-white', 'bg-red-500', 'bg-orange-500', 'bg-yellow-400', 'bg-green-500');
        
        if (donePercent <= 25) headerBar.classList.add('bg-red-500');
        else if (donePercent <= 50) headerBar.classList.add('bg-orange-500');
        else if (donePercent <= 75) headerBar.classList.add('bg-yellow-400');
        else headerBar.classList.add('bg-green-500');
    }

// 3. Update Text Labels
    if (document.getElementById('caseCountText')) {
        // Calculate the "To Read" stats first
        const toReadPercent = (100 - donePercent).toFixed(1);
        const toReadCount = total - done;

        // Apply the new creative layout
        document.getElementById('caseCountText').innerText = 
            `${donePercent.toFixed(1)}% â€¢ ${done} CASES DONE | ${toReadPercent}% â€¢ ${toReadCount} CASES TO READ`;
    }

    if (document.getElementById('casePercentText')) document.getElementById('casePercentText').innerText = `${donePercent.toFixed(1)}%`;
    if (document.getElementById('headerDone')) document.getElementById('headerDone').innerText = done;
    if (document.getElementById('headerRemaining')) document.getElementById('headerRemaining').innerText = remaining;
    if (document.getElementById('headerPercent')) document.getElementById('headerPercent').innerText = `${donePercent.toFixed(1)}%`;
}
       // --- MODAL LOGIC ---
function openDigestModal(id, title) {
    const data = getStorageData();
    const caseState = data[id] || {}; 
    const caseData = caseState.digest || {}; 
    
    document.getElementById('currentCaseId').value = id;
    document.getElementById('modalCaseTitle').innerText = title;

    // Mapping the new IDs to the stored data
    document.getElementById('noteGRNo').value = caseData.grNo || '';
    document.getElementById('noteCaseDate').value = caseData.dateText || '';
    document.getElementById('noteDoctrine').value = caseData.doctrine || '';
    document.getElementById('noteFacts').value = caseData.facts || '';
    document.getElementById('noteIssue').value = caseData.issue || '';
    document.getElementById('noteRuling').value = caseData.ruling || '';
    document.getElementById('noteDispositive').value = caseData.dispositive || '';
    
    const modal = document.getElementById('digestModal');
           modal.classList.remove('hidden');
           modal.classList.add('flex');
           // Animation
           setTimeout(() => {
               modal.firstElementChild.classList.remove('scale-95');
               modal.firstElementChild.classList.add('scale-100');
           }, 10);
       }
 
       function closeModal() {
           const modal = document.getElementById('digestModal');
           modal.firstElementChild.classList.remove('scale-100');
           modal.firstElementChild.classList.add('scale-95');
           setTimeout(() => {
               modal.classList.add('hidden');
               modal.classList.remove('flex');
           }, 300);
       }
 
function saveDigest() {
    const id = document.getElementById('currentCaseId').value;
    if (!id) return;

    const digest = {
        grNo: document.getElementById('noteGRNo').value,
        dateText: document.getElementById('noteCaseDate').value,
        doctrine: document.getElementById('noteDoctrine').value,
        facts: document.getElementById('noteFacts').value,
        issue: document.getElementById('noteIssue').value,
        ruling: document.getElementById('noteRuling').value,
        dispositive: document.getElementById('noteDispositive').value
    };
    
    updateStorage(id, 'digest', digest);
    renderTable(); 
    closeModal();
}
 
       // Start
// --- EXPORT TO WORD LOGIC ---
// Start editing here
async function generateDocx(casesToExport, fileName) {
    const { Document, Packer, Paragraph, TextRun, AlignmentType, HeadingLevel, PageBreak } = docx;
    const children = [];
    const storageData = getStorageData();

    casesToExport.forEach((c, index) => {
        const data = storageData[c.no]?.digest || null;

        // 1. UPDATED HEADER: Includes G.R. No. and separates the Date
        children.push(new Paragraph({ text: c.title.toUpperCase(), heading: HeadingLevel.HEADING_1, alignment: AlignmentType.CENTER }));
        children.push(new Paragraph({ 
            text: `G.R. No. ${data?.grNo || 'N/A'} | Date: ${data?.dateText || c.date}`, 
            alignment: AlignmentType.CENTER, 
            spacing: { after: 400 } 
        }));

        // 2. UPDATED SECTIONS: Added DISPOSITIVE PORTION
        const sections = [
            { label: "DOCTRINE / SYLLABUS", text: data?.doctrine },
            { label: "FACTS", text: data?.facts },
            { label: "ISSUE/S", text: data?.issue },
            { label: "RULING", text: data?.ruling },
            { label: "DISPOSITIVE PORTION", text: data?.dispositive, isFallo: true }
        ];

        sections.forEach(s => {
            children.push(new Paragraph({ 
                children: [new TextRun({ text: s.label, bold: true, underline: {} })], 
                spacing: { before: 200 } 
            }));

            // Logic to prevent "double content" error and format Fallo
            const contentText = s.text ? (s.isFallo ? s.text.toUpperCase() : s.text) : "No digest content provided.";
            
            children.push(new Paragraph({ 
                children: [
                    new TextRun({ 
                        text: s.isFallo ? contentText : `- ${contentText}`, 
                        bold: s.isFallo 
                    })
                ],
                alignment: AlignmentType.JUSTIFIED,
                spacing: { after: 200 }
            }));
        });

        if (index < casesToExport.length - 1) {
            children.push(new Paragraph({ children: [new PageBreak()] }));
        }
    });

    const doc = new Document({ sections: [{ properties: {}, children: children }] });
    Packer.toBlob(doc).then(blob => saveAs(blob, fileName));
}

function exportSingleDigest() {
    const id = document.getElementById('currentCaseId').value;
    const caseObj = allCases.find(c => c.no === id);
    // Format: CaseTitle_Date.docx (removing special characters for safety)
    const safeTitle = caseObj.title.replace(/[^a-z0-9]/gi, '_').substring(0, 50);
    const safeDate = caseObj.date.replace(/[^a-z0-9]/gi, '_');
    generateDocx([caseObj], `${safeTitle}_${safeDate}.docx`);
}

function exportAllDigests() {
    // Fixed name for the bulk export
    generateDocx(allCases, "2026_Gaerlan_Cases.docx");
}
// --- IMPORT LOGIC (JSON Backup) ---
function triggerImport() { document.getElementById('importInput').click(); }

// Start editing here
function importDigests(event) {
    const file = event.target.files[0];
    if (!file) return;
    const reader = new FileReader();
    reader.onload = function(e) {
        try {
            const importedData = JSON.parse(e.target.result);
            const currentData = getStorageData();
            
            // Merge logic: This combines your current work with the imported file
            const mergedData = { ...currentData, ...importedData };
            localStorage.setItem(STORAGE_KEY, JSON.stringify(mergedData));
            
            alert("Digests imported successfully!");
            
            // Re-sync the modal if it's currently being viewed
            const openId = document.getElementById('currentCaseId').value;
            if(openId) {
                const updatedCase = mergedData[openId]?.digest || {};
                document.getElementById('noteGRNo').value = updatedCase.grNo || '';
                document.getElementById('noteCaseDate').value = updatedCase.dateText || '';
                document.getElementById('noteDoctrine').value = updatedCase.doctrine || '';
                document.getElementById('noteFacts').value = updatedCase.facts || '';
                document.getElementById('noteIssue').value = updatedCase.issue || '';
                document.getElementById('noteRuling').value = updatedCase.ruling || '';
                document.getElementById('noteDispositive').value = updatedCase.dispositive || '';
            }
            renderTable();
            updateStats();
        } catch (err) { 
            alert("Invalid file format. Please use a .json backup file."); 
        }
    };
    reader.readAsText(file);
}

// End editing here

async function preloadLatestDigests() {
    if (!confirm("This will overwrite your current digests with the latest version from the repo (your personal notes and 'done' marks will be lost unless you exported them first). Continue?")) {
        return;
    }

    try {
        const response = await fetch('https://raw.githubusercontent.com/ariiannemay/2026-Bar-Exam-Tracker/main/data.json');
        if (!response.ok) {
            throw new Error(`Failed to fetch: ${response.status}`);
        }
        const preloadedData = await response.json();
        
        // Overwrite local storage with fresh data from repo
        localStorage.setItem(STORAGE_KEY, JSON.stringify(preloadedData));
        
        alert("âœ… Latest digests successfully loaded from repo!");
        
        // Refresh the table
        renderTable();
        updateStats();
        
    } catch (err) {
        console.error("Preload failed:", err);
        alert("âŒ Failed to load latest digests. Check your internet connection or try again later.");
    }
}

// Quick clickable date picker - pops up right on the card!
document.querySelectorAll('.date-display-wrapper').forEach(wrapper => {
    const id = wrapper.id.split('-').pop(); // gets 1, 2, or 3
    const picker = wrapper.querySelector('input[type="date"]');
    const text = wrapper.querySelector('.date-text');

    // Load saved date and display it
    const saved = localStorage.getItem(`comp_exam_date_${id}`) || COUNTDOWN_DATA.find(d => d.id == id).targetDate;
    text.textContent = formatUniqueDate(saved);
    picker.value = saved;

    // Click anywhere on the card â†’ open picker right there
    wrapper.addEventListener('click', () => {
        picker.showPicker ? picker.showPicker() : picker.focus();
    });

    // When user picks a date â†’ save + update everything
    picker.addEventListener('change', () => {
        const newDate = picker.value;
        if (!newDate) return;

        const today = new Date();
        today.setHours(0,0,0,0);
        if (new Date(newDate) < today) {
            alert("Please select a future date.");
            picker.value = saved; // revert
            return;
        }

        // Save
        localStorage.setItem(`comp_exam_date_${id}`, newDate);
        COUNTDOWN_DATA.find(d => d.id == id).targetDate = newDate;

        // Update display
        text.textContent = formatUniqueDate(newDate);

        // Refresh everything
        updateAllCountdowns();
        updateScheduleTable();
        if (window.CALENDAR_APP && window.CALENDAR_APP.refreshCalendar) {
            window.CALENDAR_APP.refreshCalendar();
        }
    });
});

// START EDITING HERE: QUOTE LOGIC
const MOTIVATIONAL_QUOTES = [
    "Trust that your hard work will never betray you. You did not come this far to only come this far.",
    "Faith. Grit. Determination.",
    "Do what you could and you have done what you should.",
"One page at a time, one case at a time. The mountain is climbed one step at a time.",
    "Success is the sum of small efforts, repeated day in and day out.",
"Believe you can and you're halfway there. Keep the faith, Future Atty!",
"The struggle youâ€™re in today is developing the strength you need for tomorrow. Padayon!",
    "You are capable of more than you know. Keep reading, keep grinding.",
    "The difference between a successful person and others is not a lack of strength, but a lack of will.",
    "It always seems impossible until it's done.",
    "Padayon Atty! Your future self is already proud of the work you are doing today.",
"One page at a time, one case at a time. The mountain is climbed one step at a time."
];
let currentQuoteIndex = parseInt(localStorage.getItem('selected_quote_index')) || 0;

window.changeQuote = function(direction) {
    currentQuoteIndex += direction;
    if (currentQuoteIndex >= MOTIVATIONAL_QUOTES.length) currentQuoteIndex = 0;
    if (currentQuoteIndex < 0) currentQuoteIndex = MOTIVATIONAL_QUOTES.length - 1;
    
    // Save the choice to Local Storage
    localStorage.setItem('selected_quote_index', currentQuoteIndex);
    
    const quoteEl = document.getElementById('quoteText');
    if (quoteEl) {
        quoteEl.style.opacity = 0;
        setTimeout(() => {
            quoteEl.innerText = `"${MOTIVATIONAL_QUOTES[currentQuoteIndex]}"`;
            quoteEl.style.opacity = 1;
        }, 150);
    }
};
const qStyle = document.createElement('style');
qStyle.innerHTML = "#quoteText { transition: opacity 0.2s ease-in-out; }";
document.head.appendChild(qStyle);
// END EDITING HERE
init();

    </script>
</body>
</html>
