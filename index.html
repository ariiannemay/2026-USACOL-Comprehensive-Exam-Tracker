<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>2026 Review Tracker</title>
    <!-- FIX: Updated favicon link -->
    <link rel="icon" href="https://raw.githubusercontent.com/ariiannemay/2026-USACOL-Comprehensive-Exam-Tracker/main/usacol%20logo.png">
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    
    <!-- ADDED: Calendar Dependencies -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.29.1/moment.min.js"></script>
    <link href='https://cdnjs.cloudflare.com/ajax/libs/fullcalendar/3.10.2/fullcalendar.min.css' rel='stylesheet' />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/fullcalendar/3.10.2/fullcalendar.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <!-- END: Calendar Dependencies -->
    
    <style>
        /* Attempt to import a decorative font for the quote */
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;700;900&family=Bebas+Neue&family=Cormorant+Garamond:ital,wght@1,600&display=swap');
        
        /* Calendar Specific Styles (Copied from module to ensure they are available globally) */
        /* --- CORE AESTHETIC VARIABLES (FIXED MAROON) --- */
        :root {
            --color-primary-dark: #6D1B1B; 
            --color-secondary-gold: #FECE1B; 
            --color-light-bg: #F4F7F9;
        }
        /* Calendar Stylesheet START */
        .calendar-wrapper { max-width: 1280px; margin: 0 auto; padding: 0 1rem; margin-top: 0; padding-bottom: 1.9rem; overflow-x: hidden; }
        #calendar-grid-container { display: grid; grid-template-columns: 3fr 1fr; gap: 1.5rem; align-items: start; padding: 0.25rem 0.5rem 0.5rem 0.5rem; }
        #calendar-details { border-radius: 0.75rem; overflow: hidden; }
        #calendar-details summary { background-color: var(--color-primary-dark); color: white; border-bottom: 3px solid var(--color-secondary-gold); padding: 0.75rem 1.5rem; font-size: 1.125rem; font-weight: 700; }
        .toggle-indicator { transition: transform 0.2s; }
        #notepad-sidebar { background-color: #FFF; border-radius: 0.75rem; box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1); padding: 1.5rem; display: flex; flex-direction: column; border: 1px solid #e5e7eb; grid-column: 2; }
        #calendar-details[data-calendar-ready="true"] #notepad-sidebar { min-height: var(--calendar-height, 450px); }
        #notepad-sidebar h3 { background-color: var(--color-primary-dark); color: white; border-radius: 0.375rem 0.375rem 0 0; padding: 0.4rem 0.75rem; margin: calc(-1.5rem - 1px) -1.5rem 0.75rem -1.5rem; text-transform: uppercase; font-weight: 800; font-size: 0.9rem; border-bottom: 3px solid var(--color-secondary-gold); }
        #review-notes { width: 100%; flex-grow: 1; padding: 1.5rem 1.0rem 1.0rem 1.0rem; font-size: 0.95rem; border: none; border-radius: 0.5rem; box-shadow: inset 0 1px 4px rgba(0, 0, 0, 0.1); resize: none; font-family: 'Dancing Script', cursive; font-weight: 600; line-height: 1.95; color: #333; overflow-y: auto; background-color: #f7f7f7; background-image: url('https://img.freepik.com/free-vector/blank-cream-notepaper-design_53876-97377.jpg?semt=ais_hybrid&w=740&q=80'); background-size: cover; background-position: center; background-repeat: no-repeat; }
        #review-notes::placeholder { font-family: 'Dancing Script', cursive; font-weight: 700; color: #b33a3a; opacity: 0.8; transform: translateY(-5px); display: block; }
        #calendar-content { grid-column: 1; padding: 0; }
        #calendar-card { background-color: white; border-radius: 0.75rem; box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1); padding: 0; }
        .fc-toolbar { padding: 0.1rem 0.75rem; background-color: var(--color-primary-dark); margin-bottom: 0; border: 0px solid var(--color-secondary-gold); color: white; border-radius: 0.5rem; display: flex; align-items: center; font-size: 0.85rem; }
        #customMonthTitle { color: white; font-weight: 800; text-transform: uppercase; font-size: 1.4em; padding: 0.3em 0.6em; margin-right: 0.5rem; font-family: inherit; }
        .fc-widget-header { background-color: var(--color-primary-dark) !important; color: white !important; text-transform: uppercase !important; font-weight: 700 !important; padding: 0.05rem 0; height: 100%; }
        .fc-view-container .fc-view > table { border-top: none !important; }
        .fc-toolbar + div { border-top: none !important; }
        .fc-head { border-top: none !important; border-bottom: 3px solid var(--color-secondary-gold) !important; }
        #calendar { padding: 0 !important; }
        .fc-view-container { border-top: none !important; }
        .fc-unthemed, .fc-unthemed table { border-top: none !important; border-color: transparent !important; }
        .fc-unthemed td, .fc-unthemed th { border-color: #e5e7eb; }
        #dateJump { display: none !important; visibility: hidden !important; position: absolute; top: 0; left: 0; }
        #dateJump.temp-visible { display: block !important; visibility: visible !important; position: fixed !important; z-index: 9999; width: 200px; height: 40px; opacity: 0.01; pointer-events: auto; }
        .fc-toolbar .fc-right { flex-grow: 1; display: flex; justify-content: flex-end; margin: 0 !important; width: auto !important; }
        .fc-toolbar .fc-button-group:last-child { margin-left: 0.5rem; }
        .fc-toolbar .fc-button, #jumpToDateButton { padding: 0.3em 0.6em !important; line-height: 1.2 !important; font-size: 0.75rem !important; background-color: white !important; color: var(--color-primary-dark) !important; border-color: var(--color-primary-dark) !important; box-shadow: none; text-transform: uppercase; font-weight: 700; border-radius: 0.25rem; margin-left: 0.5rem; }
        #jumpToDateButton { background-color: var(--color-secondary-gold) !important; color: var(--color-primary-dark) !important; border-color: var(--color-primary-dark) !important; }
        .fc-toolbar .fc-button:hover:not(.fc-state-active), #jumpToDateButton:hover { background-color: #f0f0f0 !important; color: var(--color-primary-dark) !important; }
        #jumpToDateButton:hover { filter: brightness(0.9); }
        .fc-toolbar .fc-state-active, .fc-toolbar .fc-state-active:hover { background-color: var(--color-secondary-gold) !important; color: var(--color-primary-dark) !important; border-color: var(--color-primary-dark) !important; }
        .fc-toolbar .fc-today-button.fc-state-active { background-color: var(--color-secondary-gold) !important; color: var(--color-primary-dark) !important; }
        .fc-day-number { display: inline-block; background-color: transparent; color: #4b5563; font-weight: 700; padding: 2px 4px; margin-right: 0; float: right; line-height: 1.2; font-size: 0.9rem; }
        .fc-other-month .fc-day-number { color: #9ca3af; background-color: transparent; }
        .fc-event { border-radius: 0.25rem !important; border: 1px solid rgba(0,0,0,0.1); font-size: 0.7rem; font-weight: 600; padding: 2px 5px; white-space: normal; text-transform: uppercase; }
        .fc-event-title-wrap { display: flex; align-items: center; }
        .event-status-icon { font-size: 0.8rem; margin-right: 0.5rem; width: 1.25rem; text-align: center; }
        .event-icon-book { color: white; } 
        .modal { z-index: 1000; background-color: rgba(0, 0, 0, 0.75); }
        .modal-content { background-color: white !important; padding: 1.5rem; border-radius: 0.75rem; box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.5); min-width: 300px; width: 90%; max-width: 500px; }
        .syllabus-select-wrapper select { min-height: 200px; }
        /* Calendar Stylesheet END */

        /* -------------------------------------------------------------------------- */
        /* 1. CORE LAYOUT & TYPOGRAPHY STYLES */
        /* -------------------------------------------------------------------------- */
        
        /* Global & Countdown Styles */
        body {
            font-family: 'Inter', sans-serif;
            /* Ensure the body expands to push the footer down */
            display: flex; 
            flex-direction: column;
        }
        
        /* Main content wrapper flex-grow pushes footer to bottom */
        .main-content-wrapper {
             flex-grow: 1;
        }

        .header-font {
            font-family: 'Bebas Neue', sans-serif;
            letter-spacing: .1em;
        }

        .header-bg {
            background-color: #6d1b1b;
            /* Deep Maroon (Unified Color) */
            border-bottom: 5px solid #fece1b;
        }

        .card-header-bg {
            background-color: #6d1b1b;
            /* Deep Maroon (Unified Color) */
        }

        .time-value {
            font-size: 1.75rem;
            font-weight: 900;
            line-height: 1;
            color: #1a202c;
        }

        .time-label {
            font-size: .875rem;
            font-weight: 700;
            color: #4a5568;
            text-transform: uppercase;
        }

        .date-display-wrapper {
            display: inline-block;
            padding-bottom: 0;
            cursor: pointer;
            transition: color .2s;
        }

        .date-display-wrapper:hover .date-text {
            color: #1d4ed8;
        }

        .date-text {
            font-family: 'Bebas Neue', sans-serif;
            font-size: 2.25rem;
            font-weight: 800;
            color: #000000;
            text-transform: uppercase;
            letter-spacing: .15em;
            line-height: 1;
        }
        
        /* Today Is Text Styles */
        .today-date-text {
            /* Force to one line, reduce font */
            font-size: 0.9rem; 
            white-space: nowrap; 
            font-weight: 700;
            line-height: 1;
        }
        
        /* Footer Text */
        .dashboard-footer-text {
             font-size: 0.65rem; /* Smaller font size */
             /* Adjusted to reduce space above the footer globally */
             margin-top: 0.5rem; 
        }
        /* New custom coloring classes */
        .text-miss { color: #000000; }
        .text-atty { color: #674ea7; } /* Purple */
        .text-cpa { color: #f472b6; } /* Pink */
        
        /* Global Footer Styling */
        .global-app-footer {
            text-align: center;
            padding: 1rem 0;
            /* Reduced margin-top for the footer itself */
            margin-top: 0.5rem; 
        }
        /* Font styling for the quote and date (using Cormorant Garamond) */
        .global-app-footer .quote, .global-app-footer .signature .date-text-signature {
            font-family: 'Cormorant Garamond', 'Times New Roman', serif; 
            font-style: italic;
            font-weight: 600;
            font-size: 1rem;
            color: #4a5568;
        }
        /* Signature font style remains Inter italic/semibold, EXCEPT for date */
        .global-app-footer .signature {
            font-family: 'Inter', sans-serif;
            font-style: italic;
            font-weight: 600;
            font-size: 0.75rem;
            color: #4a5568;
        }


        /* -------------------------------------------------------------------------- */
        /* 2. DASHBOARD & SCHEDULE STYLES (Existing) */
        /* -------------------------------------------------------------------------- */

        .border-custom-yellow {
            border-color: #fece1b;
        }
        .text-custom-yellow {
            color: #fece1b;
        }
        .bg-chart-done {
            background-color: #38761d;
            /* Dark Green */
        }
        .text-chart-done {
            color: #38761d;
        }
        .bg-chart-toread {
            background-color: #ef4444; /* Red */
        }
        .text-chart-toread {
             color: #ef4444; /* Red */
        }
        .text-chart-title {
            color: #6d1b1b;
            /* Deep Maroon */
            font-size: 1.5rem; /* Reduced for compactness */
            margin-top: 0.5rem;
            margin-bottom: 0.5rem;
        }
        
        #overall-dashboard {
            background-color: transparent; /* Make background transparent */
            box-shadow: none; /* Remove shadow */
            border: none; /* Remove border */
            padding: 0;
        }

        .dashboard-container {
            display: flex;
            flex-wrap: wrap;
            padding: 0; 
        }
        .chart-panel {
            width: 100%;
            padding: 0.5rem 0.3rem;
            border-bottom: 1px solid #e5e7eb;
            background-color: #fff; /* Individual panel background */
            border-radius: 0.75rem;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
        }
        .schedule-panel {
            width: 100%;
            padding: 0.5rem 0.3rem;
            background-color: #fff; /* Individual panel background */
            border-radius: 0.75rem;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
        }
        
        @media (min-width: 1024px) {
            #overall-dashboard {
                padding: 0; 
            }

            .dashboard-container {
                display: grid;
                grid-template-columns: 1fr 1.5rem 1fr 1.5rem 1fr;
                padding: 0;
            }
            
            .chart-panel {
                grid-column: 1 / span 1; 
                padding: 0.5rem 1rem;
                border-bottom: none;
            }
            
            .schedule-panel {
                grid-column: 3 / span 3;
                padding: 0.5rem 1rem;
                border-left: none; 
            }
            
            .dashboard-container > div:nth-child(2) {
                 grid-column: 2 / span 1;
                 border-right: none;
            }
            
            .chart-panel .flex-col, .chart-panel .text-center {
                 align-items: center; 
                 text-align: center;
                 justify-content: center;
            }

        }

        .pie-chart-wrapper {
            position: relative;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0.5rem auto 0.1rem; 
            width: 100%;
        }

        .metric-pie-side {
            position: absolute;
            font-family: 'Inter', sans-serif;
            font-weight: 700;
            font-size: 0.7rem; 
            text-align: center;
            line-height: 1.2;
        }

        .metric-pie-side.left {
            right: 50%;
            margin-right: 105px; 
            transform: translateY(-50%);
            top: 50%;
        }
        .metric-pie-side.right {
            left: 50%;
            margin-left: 105px; 
            transform: translateY(-50%);
            top: 50%;
        }
        .metric-pie-side .metric-value {
             font-size: 1rem;
             font-weight: 900;
        }
        
        /* Schedule Table */
        .schedule-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 0.8rem;
            border: 2px solid #e5e7eb; 
            border-radius: 0.5rem; 
            overflow: hidden;
        }
        .schedule-table th,
        .schedule-table td {
            padding: 0.3rem 0.5rem;
            vertical-align: middle;
        }
        .schedule-header th {
            background-color: #6d1b1b;
            color: #FFFFFF;
            font-weight: 700;
            text-transform: uppercase;
            border: 2px solid #fece1b;
            font-size: 0.75rem;
        }
        .subject-cell {
            font-weight: 600;
            color: white;
            padding: 0.4rem; 
            text-align: center;
            border-radius: 0.5rem;
            box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
            font-size: 0.7rem; 
            text-transform: uppercase; 
        }
        .progress-bar-sparkline {
            width: 100%;
            height: 0.8rem;
            background-color: #e5e7eb;
            border-radius: 9999px;
            overflow: hidden;
            box-shadow: inset 0 1px 3px 0 rgba(0, 0, 0, 0.1);
            padding: 2px;
        }
        .bg-progress-red { background-color: #ef4444; }
        .bg-progress-orange { background-color: #f97316; }
        .bg-progress-yellow { background-color: #facc15; }
        .bg-progress-green { background-color: #10b981; }

        .sparkline-fill {
            height: 100%;
            transition: width 0.5s ease-in-out;
            border-radius: 9999px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
            border: 2px solid white;
            max-width: 100%;
        }

        /* Subject Colors for Schedule (used by subject-cell and sparkline-fill) */
        .bg-poli { background-color: #795548; }
        .bg-comm { background-color: #eab308; }
        .bg-civ { background-color: #1e3a8a; }
        .bg-lab { background-color: #38761d; }
        .bg-crim { background-color: #b33a3a; }
        .bg-rem { background-color: #674ea7; }
        
        /* -------------------------------------------------------------------------- */
        /* 3. SUBJECT TRACKER STYLES (Checklist Fix Applied) */
        /* -------------------------------------------------------------------------- */

        /* Syllabus Panel Common Styles */
        .syllabus-panel-container { border-radius: .75rem; overflow: hidden; }

        .syllabus-summary { 
            /* This is the base summary style, colors are overridden below */
            padding: 1rem; font-size: 1.25rem; font-weight: 700; color: white; cursor: pointer; 
            list-style: none; display: flex; flex-direction: column; align-items: flex-start; 
            justify-content: space-between; gap: .5rem; 
            border-top-left-radius: .75rem; 
            border-top-right-radius: .75rem;
        }
        
        .topic-header { padding: .75rem; font-weight: 600; color: #1f2937; display: flex; align-items: center; justify-content: space-between; cursor: pointer; list-style: none; }
        
        /* Checklist Grid */
        .checklist-grid { 
            display: grid; 
            grid-template-columns: 2fr repeat(5, 70px) minmax(40px, 50px); 
            gap: .2rem; 
            padding: .3rem 0; 
            align-items: center; 
            border-bottom: 1px dashed #e5e7eb; 
        }
        
        /* CRITICAL CHECKBOX STYLING OVERRIDE */
        .checklist-grid input[type="checkbox"] {
            /* Reset default appearance - CRITICAL */
            -webkit-appearance: none;
            -moz-appearance: none;
            appearance: none;
            /* Explicit size to match w-4 h-4 (1rem) */
            width: 1rem; 
            height: 1rem;
            border: 1px solid #d1d5db; /* border-gray-300 */
            border-radius: 0.25rem; /* rounded */
            cursor: pointer;
            transition: background-color 0.2s, border-color 0.2s;
            background-color: #ffffff;
            align-self: center;
            position: relative; /* Needed for ::before checkmark */
        }

        /* Default checked state style */
        .checklist-grid input[type="checkbox"]:checked {
             border-color: transparent !important; /* Force border to disappear */
        }

        /* THEME-SPECIFIC CHECKED BACKGROUND COLOR (with !important override) */
        .syllabus-checkbox-rem:checked { background-color: #8b5cf6 !important; } 
        .syllabus-checkbox-crim:checked { background-color: #ef4444 !important; }
        .syllabus-checkbox-lab:checked { background-color: #38761d !important; }
        .syllabus-checkbox-civ:checked { background-color: #2563eb !important; }
        .syllabus-checkbox-comm:checked { background-color: #eab308 !important; }
        .syllabus-checkbox-poli:checked { background-color: #795548 !important; }


        /* CUSTOM CHECKMARK DRAWING (Always white) */
        .checklist-grid input[type="checkbox"]:checked::before {
        content: '';
        position: absolute;
        width: 0.25rem;
        height: 0.5rem;
        border: solid white;
        border-width: 0 2px 2px 0;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -55%) rotate(45deg);
        }


        /* End Checkbox Fixes */
        
        .checklist-grid>div:first-child { padding-left: 1.0rem; font-size: .875rem; color: #374151; display: flex; flex-direction: column; align-items: flex-start; justify-content: center; }
        .font-trackable-lg { font-size: 1rem; font-weight: 600; }
        .progress-percent-bold { font-weight: 700; font-size: .8rem; }
        .syllabus-summary-title-row { display: flex; align-items: center; justify-content: space-between; width: 100%; }
        .syllabus-progress-metrics { display: flex; flex-wrap: wrap; gap: 1.5rem; align-items: center; width: 100%; font-size: .75rem; }
        .progress-stats { display: flex; gap: .5rem; white-space: nowrap; }
        .progress-overall-text { white-space: nowrap; font-weight: 700; margin-right: .5rem; }
        .progress-bar-container { height: .75rem; background: #e5e7eb; border-radius: 9999px; overflow: hidden; width: 100%; flex-grow: 1; max-width: none; }
        .progress-bar { height: 100%; transition: width .5s ease-in-out; }
        .main-summary-chevron { transition: transform .2s; }
        .syllabus-panel[open]>.syllabus-summary .main-summary-chevron { transform: rotate(90deg); }
        .syllabus-summary::-webkit-details-marker, .topic-header::-webkit-details-marker { display: none; }
        .syllabus-content { padding: .5rem 1rem 1rem 1rem; background: white; border: 1px solid #e5e7eb; border-top: none; border-bottom-left-radius: .75rem; border-bottom-right-radius: .75rem; }
        .syllabus-sub-section { border-bottom: 1px solid #e5e7eb; margin-bottom: .5rem; }
        .chevron-icon { transition: transform .2s; display: inline-block; margin-right: .5rem; }
        .syllabus-sub-section[open]>details>.topic-header .chevron-icon { transform: rotate(90deg); }
        .depth2-details { list-style: none; margin-bottom: .25rem; border: 1px solid #f3f4f6; border-radius: .375rem; overflow: hidden; background-color: #fafafa; }
        .depth2-details>summary { list-style: none; cursor: pointer; padding: 0; background-color: #ffffff; }
        .depth2-details>summary::-webkit-details-marker { display: none; }
        .depth2-chevron { transition: transform .2s; transform: rotate(0deg); flex-shrink: 0; margin-right: .5rem; }
        .depth2-details[open] .depth2-chevron { transform: rotate(90deg); }
        .topic-content-wrapper { display: flex; align-items: flex-start; padding-left: .5rem; }
        .checklist-grid.checklist-grid-header>div:first-child { 
            /* MODIFIED: Ensure column 1 is wide enough to push capsules right */
            grid-column: 1 / span 1; 
            padding-left: 0; 
            align-items: center; 
            text-align: center; 
        }

        .checklist-grid.checklist-grid-header {
            /* MODIFIED: Add grid column for the new button position (column 7) */
            grid-template-columns: 2fr repeat(5, 70px) minmax(40px, 50px);
        }
        /* NEW: Style for the micro-progress bars div */
        .checklist-grid-micro-progress {
            /* Now defined in JS wrapper block to ensure correct grid columns */
            border-bottom: 1px solid #e5e7eb; 
        }


        .depth3-content-wrapper>div { display: block; padding: .25rem .5rem; }
        .checklist-grid>div:nth-child(n+2):nth-child(-n+6) { border-right: 1px dashed #d1d5db; }
        .checklist-grid>div:nth-child(6) { border-right: none; }
        .checklist-label-capsule { font-size: .65rem; font-weight: 7-00; text-transform: uppercase; text-align: center; word-break: keep-all; padding: .15rem .35rem; border-radius: 9999px; line-height: 1; color: white; box-shadow: 0 1px 2px 0 rgba(0, 0, 0, .05); }
        .col-progress-codal { background-color: #8b5cf6; }
        .col-progress-lectures { background-color: #facc15; }
        .col-progress-reviewer { background-color: #3b82f6; }
        .col-progress-barqas { background-color: #10b981; }
        .col-progress-cases { background-color: #f97316; }
        .capsule-codal { background-color: #8b5cf6; }
        .capsule-books { background-color: #eab308; }
        .capsule-reviewer { background-color: #3b82f6; }
        .capsule-barqas { background-color: #10b981; }
        .capsule-cases { background-color: #f97316; }
        .tick-all-icon { cursor: pointer; transition: color .2s, transform .2s; color: #9ca3af; }
        .tick-all-icon.checked { color: #10b981; }
        .tick-all-icon.partial { color: #f59e0b; }
        .tick-all-icon:hover { transform: scale(1.1); }
        .col-progress-bar-container { height: .4rem; background: #e5e7eb; border-radius: 9999px; overflow: hidden; width: 100%; }
        .col-progress-bar { height: 100%; transition: width .3s ease-in-out; }
        .status-message-row { padding-top: .25rem; padding-bottom: .25rem; }
        
        .depth3-content-wrapper .checklist-grid>div:first-child { grid-column: 1 / span 7; padding-left: 2.5rem; }
        .depth2-topic-row { grid-column: 1 / span 1; display: flex; align-items: flex-start; }
        
        /* SUBJECT PANEL THEMES (The missing pieces) */
        
        /* REMEDIAL Law (Purple Theme) */
        .syllabus-panel-rem .syllabus-summary {
            background-color: #674ea7;
            border-left: 5px solid #8e7cc3;
        }
        .syllabus-panel-rem .topic-header {
            background-color: #ede9fe;
            border-left: 3px solid #8b5cf6;
        }
        .syllabus-checkbox-rem:checked { background-color: #8b5cf6 !important; } 

        /* CRIMINAL Law (Red Theme) */
        .syllabus-panel-crim .syllabus-summary {
            background-color: #b33a3a;
            border-left: 5px solid #d94a4a;
        }
        .syllabus-panel-crim .topic-header {
            background-color: #fee2e2;
            border-left: 3px solid #ef4444;
        }
        .syllabus-checkbox-crim:checked { background-color: #ef4444 !important; }

        /* LABOR Law (Green Theme) */
        .syllabus-panel-lab {
            --lab-color: #38761d;
            --lab-color-dark: #274e13;
        }
        .syllabus-panel-lab .syllabus-summary {
            background-color: var(--lab-color);
            border-left: 5px solid #6aa84f;
        }
        .syllabus-panel-lab .topic-header {
            background-color: #f6fff6;
            border-left: 3px solid var(--lab-color);
        }
        .syllabus-checkbox-lab:checked { background-color: var(--lab-color) !important; }
        .bg-lab-button { background-color: var(--lab-color); }
        .hover\:bg-lab-button-dark:hover { background-color: var(--lab-color-dark); }

        /* CIVIL Law (Blue Theme) */
        .syllabus-panel-civ {
            --civ-color: #1e3a8a;
            --civ-color-dark: #142a63;
        }
        .syllabus-panel-civ .syllabus-summary {
            background-color: var(--civ-color);
            border-left: 5px solid #3b82f6;
        }
        .syllabus-panel-civ .topic-header {
            background-color: #eff6ff;
            border-left: 3px solid var(--civ-color);
        }
        .syllabus-checkbox-civ:checked { background-color: #2563eb !important; }
        .bg-civ-button { background-color: #2563eb; }
        .hover\:bg-civ-button-dark:hover { background-color: #1d4ed8; }

        /* COMMERCIAL Law (Yellow Theme) */
        .syllabus-panel-comm {
            --comm-color: #eab308; /* Yellow-600 */
            --comm-color-dark: #b88f06;
            --comm-color-light: #fefce8;
            --comm-checkbox-color: #eab308;
        }
        .syllabus-panel-comm .syllabus-summary {
            background-color: var(--comm-color);
            border-left: 5px solid #facc15;
            color: #111827 !important; 
        }
        .syllabus-panel-comm .syllabus-summary-title-row .flex:first-child,
        .syllabus-panel-comm .syllabus-progress-metrics span,
        .syllabus-panel-comm .syllabus-progress-metrics i {
             color: #111827 !important;
        }
        .syllabus-panel-comm .topic-header {
            background-color: var(--comm-color-light);
            border-left: 3px solid var(--comm-color);
        }
        .syllabus-checkbox-comm:checked { accent-color: var(--comm-checkbox-color); }
        .bg-comm-button { background-color: var(--comm-color); }
        .hover\:bg-comm-button-dark:hover { background-color: var(--comm-color-dark); }
        
        /* POLITICAL Law (Brown Theme) */
        .syllabus-panel-poli {
            --poli-color: #795548; /* Brown */
            --poli-color-dark: #553b32;
            --poli-color-light: #efe9e0;
        }
        .syllabus-panel-poli .syllabus-summary {
            background-color: var(--poli-color);
            border-left: 5px solid #a1887f;
        }
        .syllabus-panel-poli .topic-header {
            background-color: var(--poli-color-light);
            border-left: 3px solid var(--poli-color);
        }
        .syllabus-checkbox-poli:checked { accent-color: var(--poli-color); }
        .bg-poli-button { background-color: var(--poli-color); }
        .hover\:bg-poli-button-dark:hover { background-color: var(--poli-color-dark); }
        /* END SUBJECT PANEL THEMES */
        
    </style>
</head>

<body class="bg-gray-100 min-h-screen p-1 sm:p-2">
    
    <div class="main-content-wrapper">
        <div class="max-w-6xl mx-auto space-y-2">

            <!-- 1. HEADER PANEL -->
            <header class="header-bg text-white py-3 px-4 sm:py-4 sm:px-6 rounded-xl shadow-2xl">
                <div class="flex items-center justify-between">
                    <div class="flex-shrink-0 w-16 h-16 flex items-center justify-center rounded-full overflow-hidden">
                        <img src="https://raw.githubusercontent.com/ariiannemay/2026-USACOL-Comprehensive-Exam-Tracker/main/USA.png" alt="USA Logo" class="w-full h-full object-cover" onerror="this.outerHTML = '<i data-lucide=\'graduation-cap\' class=\'w-12 h-12 text-yellow-300\'></i>'">
                    </div>
                    <div class="text-center mx-4 flex-grow">
                        <h1 class="text-xl sm:text-3xl font-extrabold header-font tracking-wider mb-2 underline">UNIVERSITY OF SAN AGUSTIN</h1>
                        <h2 class="text-3xl sm:text-5xl italic font-extrabold header-font tracking-widest" style="text-shadow: 2px 2px 0 #000000;">2026 COMPREHENSIVE EXAM REVIEW TRACKER</h2>
                    </div>
                    <div class="flex-shrink-0 w-24 h-24 flex items-center justify-center rounded-full overflow-hidden">
                        <img src="https://raw.githubusercontent.com/ariiannemay/2026-USACOL-Comprehensive-Exam-Tracker/main/usacol%20logo.png" alt="USACoL Logo" class="w-full h-full object-cover" onerror="this.outerHTML = '<i data-lucide=\'shield\' class=\'w-12 h-12 text-yellow-300\'></i>'">
                    </div>
                </div>
            </header>

            <!-- 2. COUNTDOWN PANELS (Hourglass color fixed to inherited white) -->
            <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                <div id="card-day-1" class="bg-white rounded-xl shadow-lg border border-gray-300 relative overflow-hidden">
                    <!-- Applied UPPERCASE to header -->
                    <div class="flex items-center justify-between card-header-bg text-white p-2 text-lg font-bold text-center border-b-4 border-custom-yellow uppercase">
                        <i data-lucide="hourglass" class="w-6 h-6 mr-2"></i>Comprehensive Exam Day 1<i data-lucide="hourglass" class="w-6 h-6 ml-2"></i>
                    </div>
                    <div class="p-2 text-center">
                        <div class="mb-2 flex justify-center items-center">
                            <span id="target-date-display-1" class="date-display-wrapper" data-target-date="2026-06-14"><span class="date-text"></span></span>
                        </div>
                        <div class="grid grid-cols-4 py-2 border-y-2 border-dashed border-gray-300">
                            <div class="flex flex-col"><span id="days-1" class="time-value">000</span><span class="time-label">Days</span></div>
                            <div class="flex flex-col border-l-2 border-r-2 border-dashed border-gray-300"><span id="hrs-1" class="time-value">00</span><span class="time-label">Hrs</span></div>
                            <div class="flex flex-col border-r-2 border-dashed border-gray-300"><span id="mins-1" class="time-value">00</span><span class="time-label">Mins</span></div>
                            <div class="flex flex-col"><span id="secs-1" class="time-value">00</span><span class="time-label">Secs</span></div>
                        </div>
                    </div>
                </div>
                <div id="card-day-2" class="bg-white rounded-xl shadow-lg border border-gray-300 relative overflow-hidden">
                    <!-- Applied UPPERCASE to header -->
                    <div class="flex items-center justify-between card-header-bg text-white p-2 text-lg font-bold text-center border-b-4 border-custom-yellow uppercase">
                        <i data-lucide="hourglass" class="w-6 h-6 mr-2"></i>Comprehensive Exam Day 2<i data-lucide="hourglass" class="w-6 h-6 ml-2"></i>
                    </div>
                    <div class="p-2 text-center">
                        <div class="mb-2 flex justify-center items-center">
                            <span id="target-date-display-2" class="date-display-wrapper" data-target-date="2026-06-21"><span class="date-text"></span></span>
                        </div>
                        <div class="grid grid-cols-4 py-2 border-y-2 border-dashed border-gray-300">
                            <div class="flex flex-col"><span id="days-2" class="time-value">000</span><span class="time-label">Days</span></div>
                            <div class="flex flex-col border-l-2 border-r-2 border-dashed border-gray-300"><span id="hrs-2" class="time-value">00</span><span class="time-label">Hrs</span></div>
                            <div class="flex flex-col border-r-2 border-dashed border-gray-300"><span id="mins-2" class="time-value">00</span><span class="time-label">Mins</span></div>
                            <div class="flex flex-col"><span id="secs-2" class="time-value">00</span><span class="time-label">Secs</span></div>
                        </div>
                    </div>
                </div>
                <div id="card-day-3" class="bg-white rounded-xl shadow-lg border border-gray-300 relative overflow-hidden">
                    <!-- Applied UPPERCASE to header -->
                    <div class="flex items-center justify-between card-header-bg text-white p-2 text-lg font-bold text-center border-b-4 border-custom-yellow uppercase">
                        <i data-lucide="hourglass" class="w-6 h-6 mr-2"></i>Comprehensive Exam Day 3<i data-lucide="hourglass" class="w-6 h-6 ml-2"></i>
                    </div>
                    <div class="p-2 text-center">
                        <div class="mb-2 flex justify-center items-center">
                            <span id="target-date-display-3" class="date-display-wrapper" data-target-date="2026-06-28"><span class="date-text"></span></span>
                        </div>
                        <div class="grid grid-cols-4 py-2 border-y-2 border-dashed border-gray-300">
                            <div class="flex flex-col"><span id="days-3" class="time-value">000</span><span class="time-label">Days</span></div>
                            <div class="flex flex-col border-l-2 border-r-2 border-dashed border-gray-300"><span id="hrs-3" class="time-value">00</span><span class="time-label">Hrs</span></div>
                            <div class="flex flex-col border-r-2 border-dashed border-gray-300"><span id="mins-3" class="time-value">00</span><span class="time-label">Mins</span></div>
                            <div class="flex flex-col"><span id="secs-3" class="time-value">00</span><span class="time-label">Secs</span></div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 3. Overall Progress (DASHBOARD) - Floating Effect -->
            <div id="overall-dashboard" class="mt-4 p-0">
                <div class="dashboard-container">
                    
                    <!-- LEFT SIDE: CHART & METRICS - Aligns with Day 1 Card -->
                    <div class="chart-panel">
                        
                        <!-- Today Is (Border reduced to 2px) -->
                        <div class="header-bg p-1.5 rounded-lg mb-2 text-center header-font flex flex-col items-center justify-center border-b-2 border-custom-yellow">
                            <span id="today-date-display" class="text-white today-date-text block font-extrabold" style="text-shadow: none;"></span>
                        </div>
                        
                        <!-- NEW: Welcome/Name Input -->
                        <div class="flex flex-col items-center mb-2">
                            <input type="text" id="user-name-input" placeholder="Input your name here..." 
                                   class="w-full text-center text-xl font-bold header-font border-b border-gray-300 
                                          focus:border-blue-500 outline-none p-1 bg-transparent text-gray-800"
                                   maxlength="30">
                        </div>

                        <!-- Review Progress Title -->
                        <h3 class="text-xl font-extrabold header-font tracking-wider text-chart-title text-center mt-2 mb-2">YOUR REVIEW PROGRESS</h3>
                        
                        <!-- Chart Area (Reduced size) -->
                        <div class="pie-chart-wrapper">
                            <div id="global-pie-chart" class="relative" style="width: 180px; height: 180px;">
                                <!-- SVG chart will be dynamically injected here -->
                            </div>
                            
                            <!-- Done Metric (Left of Pie) -->
                            <div class="metric-pie-side left">
                                <span id="global-progress-done" class="text-chart-done metric-value">0.0%</span>
                                <span class="text-chart-done block leading-tight">DONE</span>
                                <span class="text-gray-600 font-normal block leading-tight"><span id="global-total-done-count">0</span> TOPICS</span>
                            </div>

                            <!-- To Read Metric (Right of Pie, Red) -->
                            <div class="metric-pie-side right">
                                <span id="global-progress-toread" class="text-chart-toread metric-value">0.0%</span>
                                <span class="text-chart-toread block leading-tight">TO-READ</span>
                                <span class="text-gray-600 font-normal block leading-tight"><span id="global-total-toread-count">0</span> TOPICS</span>
                            </div>
                        </div>
                        
                    </div>

                    <!-- Spacer Column (To replicate the gap-6 between Day 1 and Day 2 cards) -->
                    <div class="hidden lg:block border-r border-gray-300"></div>

                    <!-- RIGHT SIDE: SCHEDULE TABLE - Aligns with Day 2 and Day 3 Cards -->
                    <div class="schedule-panel">
                        <table class="schedule-table">
                            <thead>
                                <tr class="schedule-header">
                                    <th style="width: 20%;" class="border-b-2 border-r-2 border-t-2 border-l-2 text-white">DATE</th>
                                    <th style="width: 55%;" class="border-b-2 border-t-2 border-r-2 text-white">SUBJECT</th>
                                    <th style="width: 25%;" class="border-b-2 border-t-2 border-r-2 text-white">PROGRESS*</th>
                                </tr>
                            </thead>
                            <tbody id="schedule-table-body">
                                <!-- Rows dynamically populated by JS -->
                            </tbody>
                        </table>
                        
                    </div>

                </div>
            </div>

            <!-- 4. SUBJECT TRACKERS (Dynamic Content) -->
            <div id="subject-trackers-container" class="space-y-4">
                
                <!-- CALENDAR MODULE INJECTION POINT (Before REM Tracker) -->
                <div id="calendar-module-placeholder"></div>
                
                <!-- Subject panels will be dynamically injected here by the JS modules in this order: rem, crim, lab, civ, comm, poli -->
                <div id="subject-tracker-panel-rem"></div>
                <div id="subject-tracker-panel-crim"></div>
                <div id="subject-tracker-panel-lab"></div>
                <div id="subject-tracker-panel-civ"></div>
                <div id="subject-tracker-panel-comm"></div>
                <div id="subject-tracker-panel-poli"></div> 
            </div>

            <!-- 5. GLOBAL DATA MANAGEMENT BUTTONS (UPDATED) -->
            <div class="max-w-6xl mx-auto mt-6 mb-6 flex space-x-3 px-2 sm:px-0">
                <button onclick="exportAllData()" class="flex-1 px-3 py-2 bg-green-600 text-white font-semibold text-sm rounded-lg shadow-lg hover:bg-green-700 transition duration-150 uppercase flex items-center justify-center">
                    <i data-lucide="download-cloud" class="w-4 h-4 mr-1"></i> Export All Data
                </button>
                <button onclick="document.getElementById('global-file-input').click()" class="flex-1 px-3 py-2 bg-blue-600 text-white font-semibold text-sm rounded-lg shadow-lg hover:bg-blue-700 transition duration-150 uppercase flex items-center justify-center">
                    <i data-lucide="upload-cloud" class="w-4 h-4 mr-1"></i> Import Existing Data
                </button>
            </div>
            
            <!-- START: AESTHETIC CLOUD NOTE BLOCK (Inserted here) -->
            <div class="max-w-6xl mx-auto mt-8 mb-6 px-4 sm:px-0">
                <div class="bg-blue-50/70 backdrop-blur-sm border border-blue-200 shadow-xl p-5 rounded-xl transition duration-300 hover:shadow-2xl hover:border-blue-300">
                    <p class="font-bold text-sm text-blue-800 mb-2 flex items-center">
                        <i data-lucide="cloud" class="w-4 h-4 mr-2 text-blue-500"></i>
                        TRACKER LIMITATIONS
                    </p>
                    <ul class="list-disc list-outside ml-5 text-sm text-gray-700 space-y-2">
                        <!-- Progress Calculation Logic -->
                        <li class="pl-1">
                            <strong style="color: #6d1c1c;">Progress Metric:</strong> Overall progress updates and a topic counts as “done” only once <strong>3 out of 5 boxes</strong> per topic row are checked.
                        </li>
                        <!-- Data Portability Limitation (Rephrased) -->
                        <li class="pl-1">
                            <strong style="color: #6d1c1c;">Data Portability:</strong> Your review progress is saved <strong>only within your current browser</strong> (Local Storage). Your data will not be synchronized automatically if you clear your browsing data or switch devices. To transfer your progress to a new device or browser, please use the <strong>Export All Data</strong> and <strong>Import Existing Data</strong> functions.
                        </li>
                    </ul>
                </div>
            </div>
            <!-- END: AESTHETIC CLOUD NOTE BLOCK -->

        </div>
    </div>
    
    <!-- GLOBAL FOOTER (Moved outside max-w-6xl container) -->
    <footer class="global-app-footer">
        <p class="quote">
            Trust that your hard work will never betray you. You did not come this far to only come this far.
        </p>
        <p class="signature mt-1">
            <!-- Updated signature to use image URL -->
            <img src="https://raw.githubusercontent.com/ariiannemay/2026-USACOL-Comprehensive-Exam-Tracker/main/missattycpa.PNG" 
                 alt="missattycpa signature" 
                 class="inline-block h-3.5"
                 onerror="this.outerHTML = '<span class=\'text-miss\'>made by miss</span><span class=\'text-atty\'>atty</span><span class=\'text-cpa\'>cpa</span>'">
            <span class="date-text-signature">| november 2025</span>
        </p>
    </footer>

    <!-- Modals (Date Edit & Message) -->
    <div id="date-edit-modal" class="fixed inset-0 bg-black bg-opacity-70 hidden items-center justify-center z-50">
        <div class="bg-white p-6 rounded-lg shadow-xl w-80">
            <h3 id="modal-title" class="text-xl font-bold text-gray-900 mb-4">Edit Target Date</h3>
            <label for="new-target-date" class="block text-sm font-medium text-gray-700 mb-2">Select New Date:</label>
            <input type="date" id="new-target-date" class="w-full p-2 border border-gray-300 rounded-lg mb-4">
            <p id="modal-error" class="text-sm text-red-600 hidden mb-4">Please select a future date.</p>
            <div class="flex justify-end space-x-3">
                <button id="modal-cancel-btn" class="px-4 py-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300">Cancel</button>
                <button id="modal-save-btn" class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700">Save</button>
            </div>
        </div>
    </div>

    <!-- Consolidated file input for all import actions -->
    <input type="file" id="global-file-input" accept=".json" class="hidden" onchange="importAllData(event)"> 

    <div id="message-modal" class="fixed inset-0 bg-black bg-opacity-70 hidden items-center justify-center z-50">
        <div class="bg-white p-6 rounded-lg shadow-xl w-96 max-w-sm">
            <h3 id="message-modal-title" class="text-xl font-bold text-gray-900 mb-4">Message</h3>
            <div id="message-modal-content" class="text-sm text-gray-700 mb-4 break-words"></div>
            <div id="modal-actions" class="flex justify-end space-x-3 mt-4">
                <button id="message-modal-close-btn" class="px-3 py-1.5 text-sm font-semibold bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 transition duration-150">Close</button>
            </div>
        </div>
    </div>

    <!-- Dynamic JavaScript Loader and Core Logic -->
    <script>
        // --- CORE UTILITY AND COUNTDOWN LOGIC (REMAINS IN INDEX) ---
        
        const CHECKLIST_COLUMNS = ['codal', 'books', 'reviewer', 'barqas', 'cases'];
        const COUNTDOWN_DATA = [
            {id:1,targetDate:localStorage.getItem('comp_exam_date_1')||'2026-06-14'},
            {id:2,targetDate:localStorage.getItem('comp_exam_date_2')||'2026-06-21'},
            {id:3,targetDate:localStorage.getItem('comp_exam_date_3')||'2026-06-28'}
        ];
        
        const DOM_ELEMENTS = {
            modal: document.getElementById('date-edit-modal'),
            modalTitle: document.getElementById('modal-title'),
            dateInput: document.getElementById('new-target-date'),
            saveBtn: document.getElementById('modal-save-btn'),
            cancelBtn: document.getElementById('modal-cancel-btn'),
            errorMsg: document.getElementById('modal-error'),
            globalFileInput: document.getElementById('global-file-input'), // Renamed to be global
            messageModal: document.getElementById('message-modal'),
            messageModalTitle: document.getElementById('message-modal-title'),
            messageModalContent: document.getElementById('message-modal-content'),
            messageModalCloseBtn: document.getElementById('message-modal-close-btn'),
            subjectContainer: document.getElementById('subject-trackers-container')
        };
        
        let currentEditingId = null;
        const SUBJECT_LOGIC_MAP = {}; 
        const ALL_SUBJECT_STORAGE_KEYS = [
            'rem_ethics_progress', 'crim_progress', 'lab_progress', 
            'civ_progress', 'comm_tax_progress', 'poli_progress'
        ];

        // --- Schedule Data (Central source of truth for table) ---
        const SCHEDULE_DATA = [
            { id: 1, dateId: 1, day: 'SUNDAY', subject: 'Political and Public International Law', weight: '15%', subjectName: 'poli' },
            { id: 2, dateId: 1, day: 'SUNDAY', subject: 'Commercial and Taxation Laws', weight: '20%', subjectName: 'comm' },
            { id: 3, dateId: 2, day: 'SUNDAY', subject: 'Civil Law and Land Titles and Deeds', weight: '20%', subjectName: 'civ' },
            { id: 4, dateId: 2, day: 'SUNDAY', subject: 'Labor and Social Legislation', weight: '10%', subjectName: 'lab' },
            { id: 5, dateId: 3, day: 'SUNDAY', subject: 'Criminal Law', weight: '10%', subjectName: 'crim' },
            { id: 6, dateId: 3, day: 'SUNDAY', subject: 'Remedial Law, Legal Ethics, & Legal Forms', weight: '25%', subjectName: 'rem' }
        ];

        // --- User Name Storage/Loading ---
        const USER_NAME_KEY = 'user_display_name';
        const EMOJI = '✨';

        function loadUserName() {
            const nameInput = document.getElementById('user-name-input');
            const savedName = localStorage.getItem(USER_NAME_KEY);
            if (nameInput) {
                nameInput.value = savedName ? `Welcome, ${savedName}! ${EMOJI}` : '';
                nameInput.placeholder = 'Input your name here...';
                
                nameInput.addEventListener('change', (event) => {
                    let name = event.target.value.replace(/^Welcome,\s?/, '').replace('!', '').replace(EMOJI, '').trim();
                    
                    if (name) {
                        localStorage.setItem(USER_NAME_KEY, name);
                        event.target.value = `Welcome, ${name}! ${EMOJI}`;
                    } else {
                        localStorage.removeItem(USER_NAME_KEY);
                        event.target.value = '';
                        event.target.placeholder = 'Input your name here...';
                    }
                });
            }
        }

        // Utility Functions
        function formatUniqueDate(dateString){
            if(!dateString)return'';
            const date=new Date(dateString+'T00:00:00');
            return date.toLocaleDateString('en-US',{year:'numeric',month:'long',day:'numeric'}).toUpperCase();
        }
        
        function getLocalDisplayDate() {
            const dateOptions = { year: 'numeric', month: 'long', day: 'numeric' };
            const weekdayOptions = { weekday: 'long' };

            const datePart = new Date().toLocaleDateString('en-US', dateOptions).toUpperCase();
            const weekdayPart = new Date().toLocaleDateString('en-US', weekdayOptions).toUpperCase();
            
            return `TODAY IS ${datePart} (${weekdayPart})`;
        }

        function formatNumber(num){return num.toString().padStart(num>=100?3:2,'0');}
        function downloadFile(data,filename,type){const blob=new Blob([data],{type:type});const url=URL.createObjectURL(blob);const a=document.createElement('a');a.href=url;a.download=filename;document.body.appendChild(a);a.click();document.body.removeChild(a);URL.revokeObjectURL(url);}
        function showMessageModal(title,content){
            const modal=DOM_ELEMENTS.messageModal;
            const titleEl=DOM_ELEMENTS.messageModalTitle;
            const contentEl=DOM_ELEMENTS.messageModalContent;
            if(titleEl)titleEl.textContent=title;
            if(contentEl)contentEl.innerHTML=content;
            
            const actionsEl=document.getElementById('modal-actions');
            if(actionsEl){
                actionsEl.innerHTML=`\n<button id="message-modal-close-btn" class="px-3 py-1.5 text-sm font-semibold bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 transition duration-150">Close</button>\n`;
                document.getElementById('message-modal-close-btn')?.addEventListener('click', closeMessageModal);
            }
            if(modal){
                modal.classList.remove('hidden');
                modal.style.display='flex';
            }
        }
        function closeMessageModal(){DOM_ELEMENTS.messageModal.classList.add('hidden');DOM_ELEMENTS.messageModal.style.display='none';}
        
        // Countdown Logic
        function calculateCountdown(targetDateString,id){const now=new Date();const target=new Date(targetDateString+'T00:00:00Z');if(target<=now){const elements=[`days-${id}`,`hrs-${id}`,`mins-${id}`,`secs-${id}`];elements.forEach(elId=>{const el=document.getElementById(elId);if(el)el.textContent=elId===`days-${id}`?'000':'00';});return;}const diffInMilliseconds=target-now;const days=Math.floor(diffInMilliseconds/(1000*60*60*24));const hours=Math.floor(diffInMilliseconds%(1000*60*60*24)/(1000*60*60));const minutes=Math.floor(diffInMilliseconds%(1000*60*60)/(1000*60));const seconds=Math.floor(diffInMilliseconds%(1000*60)/1000);document.getElementById(`days-${id}`).textContent=formatNumber(days);document.getElementById(`hrs-${id}`).textContent=formatNumber(hours);document.getElementById(`mins-${id}`).textContent=formatNumber(minutes);document.getElementById(`secs-${id}`).textContent=formatNumber(seconds);}
        function updateAllCountdowns(){COUNTDOWN_DATA.forEach(data=>{calculateCountdown(data.targetDate,data.id);});}
        function openModal(id){currentEditingId=id;const data=COUNTDOWN_DATA.find(d=>d.id===id);document.getElementById('modal-title').textContent=`Edit Target Date - Day ${id}`;document.getElementById('new-target-date').value=data.targetDate;document.getElementById('modal-error').classList.add('hidden');document.getElementById('date-edit-modal').classList.remove('hidden');document.getElementById('date-edit-modal').style.display='flex';}
        function closeModal(){document.getElementById('date-edit-modal').classList.add('hidden');document.getElementById('date-edit-modal').style.display='none';currentEditingId=null;}
        
        function saveModal(){
            const newDateString=document.getElementById('new-target-date').value;
            const newDate=new Date(newDateString);
            const now=new Date();
            if(newDate<=now||!newDateString){
                document.getElementById('modal-error').textContent="Please select a future date.";
                document.getElementById('modal-error').classList.remove('hidden');
                return;
            }
            const data=COUNTDOWN_DATA.find(d=>d.id===currentEditingId);
            if(data){
                data.targetDate=newDateString;
                document.querySelector(`#target-date-display-${currentEditingId} .date-text`).textContent = formatUniqueDate(newDateString);
                localStorage.setItem(`comp_exam_date_${currentEditingId}`,newDateString);
                updateAllCountdowns();
                
                // NEW: Trigger calendar refresh if the module is loaded
                if (window.CALENDAR_APP && typeof window.CALENDAR_APP.refreshCalendar === 'function') {
                    window.CALENDAR_APP.refreshCalendar();
                }
            }
            closeModal();
            // Re-render schedule table after a countdown date is changed
            updateScheduleTable();
        }

        // Global File Upload Handler (Used by all subject modules)
        function handleFileUpload(event){
            const file = event.target.files[0];
            const targetSubject = event.target.dataset.targetSubject;
            
            if (file && targetSubject && SUBJECT_LOGIC_MAP[targetSubject]) {
                SUBJECT_LOGIC_MAP[targetSubject].processImport(file);
            } else if (!file) {
                showMessageModal("Upload Canceled", "No file was selected for upload.");
            } else {
                showMessageModal("Upload Error", "Could not determine the target subject for the upload.");
            }
            event.target.value = '';
        }

        // --- GLOBAL EXPORT/IMPORT FUNCTIONS (UPDATED) ---

        function exportAllData() {
            const data = {};
            
            // 1. Gather fixed data (Name, Countdown Dates)
            data.user_name = localStorage.getItem(USER_NAME_KEY) || null;
            
            data.dates = {};
            COUNTDOWN_DATA.forEach((d) => {
                data.dates[`comp_exam_date_${d.id}`] = localStorage.getItem(`comp_exam_date_${d.id}`);
            });

            // 2. Gather all subject data
            data.subjects = {};
            ALL_SUBJECT_STORAGE_KEYS.forEach(key => {
                 const progress = localStorage.getItem(key);
                 if (progress) {
                     try {
                         data.subjects[key] = JSON.parse(progress);
                     } catch(e) {
                         data.subjects[key] = {};
                     }
                 }
            });

            // 3. Gather Calendar and Notepad data (if module is loaded)
            if (window.CALENDAR_APP) {
                data.calendar_events = localStorage.getItem(window.CALENDAR_APP.CALENDAR_EVENTS_KEY);
                data.notepad_content = localStorage.getItem(window.CALENDAR_APP.NOTEPAD_CONTENT_KEY);
            }


            const jsonString = JSON.stringify(data, null, 2);
            downloadFile(jsonString, 'comprehensive-review-tracker-backup.json', 'application/json');
            showMessageModal("Export Complete", "<p class='text-green-600'>All data (progress, dates, name, calendar, and notes) has been downloaded as **comprehensive-review-tracker-backup.json**</p>");
        }
        
        function importAllData(event) {
            const file = event.target.files[0];
            event.target.value = '';

            if (!file || !file.name.endsWith('.json')) {
                showMessageModal("Import Error", "<p class='text-red-600'>Please select a valid .json file for import.</p>");
                return;
            }
            
            const reader = new FileReader();
            reader.onload = function(e) {
                const jsonString = e.target.result;
                try {
                    const importedData = JSON.parse(jsonString);
                    if (typeof importedData !== 'object' || importedData === null) {
                         throw new Error("Invalid file structure.");
                    }
                    
                    let subjectsImported = 0;
                    let calendarRefreshed = false;

                    // 1. Import Subject Data
                    if (importedData.subjects) {
                        Object.keys(importedData.subjects).forEach(key => {
                            if (ALL_SUBJECT_STORAGE_KEYS.includes(key)) {
                                localStorage.setItem(key, JSON.stringify(importedData.subjects[key]));
                                subjectsImported++;
                            }
                        });
                    }
                    
                    // 2. Import Calendar and Notepad data
                    if (window.CALENDAR_APP) {
                        if (importedData.calendar_events) {
                             localStorage.setItem(window.CALENDAR_APP.CALENDAR_EVENTS_KEY, importedData.calendar_events);
                             calendarRefreshed = true;
                        }
                        if (importedData.notepad_content) {
                             localStorage.setItem(window.CALENDAR_APP.NOTEPAD_CONTENT_KEY, importedData.notepad_content);
                             // Directly update the notepad content via the module's exposed method
                             window.CALENDAR_APP.setNotes(importedData.notepad_content);
                        }
                    }


                    // 3. Import User Name
                    if (importedData.user_name) {
                        localStorage.setItem(USER_NAME_KEY, importedData.user_name);
                        loadUserName();
                    } else {
                        localStorage.removeItem(USER_NAME_KEY);
                        loadUserName();
                    }

                    // 4. Import Dates
                    if (importedData.dates) {
                        Object.keys(importedData.dates).forEach(key => {
                            if (key.startsWith('comp_exam_date_')) {
                                localStorage.setItem(key, importedData.dates[key]);
                            }
                        });
                    }

                    // 5. Update UI: Re-render everything
                    COUNTDOWN_DATA.forEach(data => {
                        const savedDate = localStorage.getItem(`comp_exam_date_${data.id}`);
                        data.targetDate = savedDate || data.targetDate;
                        document.querySelector(`#target-date-display-${data.id} .date-text`).textContent = formatUniqueDate(data.targetDate);
                    });
                    updateAllCountdowns();

                    Object.values(SUBJECT_LOGIC_MAP).forEach(logic => {
                        logic.render();
                    });
                    window.updateOverallDashboard();

                    if (window.CALENDAR_APP && calendarRefreshed) {
                         window.CALENDAR_APP.refreshCalendar();
                    }

                    showMessageModal("Import Success", `<p class='text-green-600'>Successfully imported data for ${subjectsImported} subjects, dates, name, calendar, and notes. The tracker has been refreshed.</p>`);

                } catch (e) {
                    console.error("Global Import error:", e);
                    showMessageModal("Import Failed", `<p class='text-red-600'>Failed to import data. Please ensure the file is a valid JSON backup from this tracker. Error: ${e.message}</p>`);
                }
            };
            reader.onerror = function() { showMessageModal("Import Error", `<p class='text-red-600'>Error reading the file.</p>`); };
            reader.readAsText(file);
        }

        window.exportAllData = exportAllData;
        window.importAllData = importAllData;

        // --- END GLOBAL EXPORT/IMPORT FUNCTIONS ---


        // Subject Logic Loader (Functionality remains the same)
        function loadSubjectPanel(subjectName, filePath) {
            const script = document.createElement('script');
            script.src = filePath;
            script.type = 'text/javascript';
            script.onload = () => {
                if (window[`create${subjectName.toUpperCase()}_LOGIC`]) {
                    const logic = window[`create${subjectName.toUpperCase()}_LOGIC`]();
                    SUBJECT_LOGIC_MAP[subjectName] = logic;
                    
                    const panelPlaceholder = document.getElementById(`subject-tracker-panel-${subjectName}`);
                    if (panelPlaceholder) {
                        const newPanelHtml = logic.getPanelHtmlWrapper(logic.SUBJECT_NAME, logic.SUBJECT_TITLE, logic.SUBJECT_ICON);
                        panelPlaceholder.outerHTML = newPanelHtml;
                    }
                    
                    const currentLogic = SUBJECT_LOGIC_MAP[subjectName];
                    
                    window.requestAnimationFrame(() => {
                        const collapseBtn = document.getElementById(`collapse-all-btn-${subjectName}`);

                        collapseBtn?.addEventListener('click', currentLogic.toggleAllSections);
                        
                        currentLogic.render();
                    });
                } else {
                    console.error(`Failed to find initialization function for ${subjectName}`);
                }
            };
            document.head.appendChild(script);
        }

        // --- GLOBAL DASHBOARD LOGIC (Functionality remains the same) ---
        function drawPieChart(donePercent) {
            const chartEl = document.getElementById('global-pie-chart');
            if (!chartEl) return;

            let fillColor;
            if (donePercent <= 25) {
                fillColor = '#ef4444'; 
            } else if (donePercent <= 50) {
                fillColor = '#f97316';
            } else if (donePercent <= 75) {
                fillColor = '#facc15';
            } else {
                fillColor = '#10b981';
            }
            
            const backgroundRingColor = (donePercent < 100) ? '#ef4444' : '#e5e7eb';
            const centerTextColor = fillColor; 
            const centerFontSize = '2.5rem'; 
            const centerFontFamily = 'Bebas Neue, sans-serif'; 

            let totalTopics = 0;
            Object.values(SUBJECT_LOGIC_MAP).forEach(logic => {
                const mainTopics = logic.SYLLABUS_DATA.filter(t => t.depth === 2 && t.trackable);
                totalTopics += mainTopics.length;
            });
            const totalTopicsText = `Total Topics: ${totalTopics}`;

            const size = 180; 
            const radius = size / 2;
            const strokeWidth = 35; 
            const center = size / 2;
            
            const circumference = 2 * Math.PI * (radius - strokeWidth / 2);
            const doneOffset = circumference * (1 - (donePercent / 100));

            chartEl.style.width = `${size}px`;
            chartEl.style.height = `${size}px`;

            chartEl.innerHTML = `
                <svg width="${size}" height="${size}" viewBox="0 0 ${size} ${size}">
                    <circle 
                        cx="${center}" 
                        cy="${center}" 
                        r="${radius - strokeWidth / 2}" 
                        fill="none" 
                        stroke="${backgroundRingColor}" 
                        stroke-width="${strokeWidth}"
                    />
                    
                    <circle
                        class="ring-done"
                        cx="${center}"
                        cy="${center}"
                        r="${radius - strokeWidth / 2}"
                        fill="none"
                        stroke="#38761d" 
                        stroke-width="${strokeWidth}"
                        stroke-dasharray="${circumference}"
                        stroke-dashoffset="${doneOffset}"
                        transform="rotate(-90 ${center} ${center})"
                        stroke-linecap="round"
                    />

                    <circle 
                        cx="${center}" 
                        cy="${center}" 
                        r="${radius - strokeWidth}" 
                        fill="white"
                    />
                    
                    <text 
                        x="${center}" 
                        y="${center - 10}" 
                        text-anchor="middle" 
                        alignment-baseline="central" 
                        font-size="${centerFontSize}"
                        font-weight="900" 
                        fill="${centerTextColor}"
                        font-family="${centerFontFamily}" 
                        style="text-shadow: 1px 1px 0 #cccccc; letter-spacing: 1px;"
                    >
                        ${(donePercent).toFixed(0)}%
                    </text>
                     <text 
                        x="${center}" 
                        y="${center + 20}" 
                        text-anchor="middle" 
                        alignment-baseline="central" 
                        font-size="0.6rem"
                        font-weight="bold" 
                        fill="#4a5568"
                        font-family="Inter, sans-serif" 
                        style="text-shadow: none;"
                    >
                        ${totalTopicsText}
                    </text>

                </svg>
            `;
        }

        function updateScheduleTable() {
            const tableBody = document.getElementById('schedule-table-body');
            if (!tableBody) return;

            let html = '';
            let lastDateId = null;

            SCHEDULE_DATA.forEach((item, index) => {
                const countdownData = COUNTDOWN_DATA.find(d => d.id === item.dateId);
                
                const dateString = countdownData ? countdownData.targetDate : 'N/A';
                
                let dayOfWeek = item.day;
                let displayDate = dateString;
                if (dateString !== 'N/A') {
                    const dateObj = new Date(dateString + 'T00:00:00Z');
                    if (!isNaN(dateObj)) {
                        dayOfWeek = dateObj.toLocaleDateString('en-US', { weekday: 'long' }).toUpperCase();
                        displayDate = dateObj.toLocaleDateString('en-US', { month: 'long', day: 'numeric', year: 'numeric' });
                    }
                }
                
                const subjectLogic = SUBJECT_LOGIC_MAP[item.subjectName];
                
                let progressPercent = '0.0';
                let progressFraction = 0;
                
                if (subjectLogic) {
                    const progress = subjectLogic.getProgress();
                    const syllabusData = subjectLogic.SYLLABUS_DATA;
                    const mainTopics = syllabusData.filter(t => t.depth === 2 && t.trackable);
                    const currentSubjectTrackable = mainTopics.length;
                    let currentSubjectDone = 0;

                    mainTopics.forEach(topic => {
                        const topicProgress = progress[topic.id] || {};
                        const boxesTicked = CHECKLIST_COLUMNS.filter(col => topicProgress[col] === true).length;
                        if (boxesTicked >= 3) {
                            currentSubjectDone++;
                        }
                    });
                    progressFraction = currentSubjectTrackable > 0 ? (currentSubjectDone / currentSubjectTrackable) : 0;
                    progressPercent = (progressFraction * 100).toFixed(1);
                }
                
                let progressClass;
                if (progressFraction <= 0.25) {
                    progressClass = 'bg-progress-red';
                } else if (progressFraction <= 0.5) {
                    progressClass = 'bg-progress-orange';
                } else if (progressFraction <= 0.75) {
                    progressClass = 'bg-progress-yellow';
                } else {
                    progressClass = 'bg-progress-green';
                }


                let dateCell = '';
                if (item.dateId !== lastDateId) {
                    dateCell = `<td rowspan="2" class="text-center font-bold text-sm border-r border-gray-300">
                                    ${displayDate.toUpperCase()}<br><span class="text-gray-400 font-normal text-xs">${dayOfWeek}</span>
                                </td>`;
                    lastDateId = item.dateId;
                }

                const rowClass = (index + 1) % 2 === 0 ? 'border-b-2 border-gray-300/50' : 'border-b border-gray-200';
                
                html += `
                    <tr class="${rowClass}">
                        ${dateCell}
                        <td class="border-r border-gray-300">
                            <div class="subject-cell bg-${item.subjectName}" data-subject="${item.subjectName}">
                                ${item.subject} <span class="font-normal">(${item.weight})</span>
                            </div>
                        </td>
                        <td>
                            <div class="text-center text-sm font-semibold mb-0.5">${progressPercent}%</div>
                            <div id="sparkline-${item.subjectName}" class="progress-bar-sparkline">
                                <div class="sparkline-fill ${progressClass}" style="width: ${progressPercent}%;"></div>
                            </div>
                        </td>
                    </tr>
                `;
            });

            tableBody.innerHTML = html;
        }

        function updateOverallDashboard() {
            document.getElementById('today-date-display').textContent = getLocalDisplayDate();

            let totalTrackableTopics = 0;
            let totalDoneTopics = 0;
            let totalToReadTopics = 0;

            Object.values(SUBJECT_LOGIC_MAP).forEach(logic => {
                const progress = logic.getProgress();
                const syllabusData = logic.SYLLABUS_DATA;
                
                const mainTopics = syllabusData.filter(t => t.depth === 2 && t.trackable);
                const currentSubjectTrackable = mainTopics.length;
                let currentSubjectDone = 0;

                mainTopics.forEach(topic => {
                    const topicProgress = progress[topic.id] || {};
                    const boxesTicked = CHECKLIST_COLUMNS.filter(col => topicProgress[col] === true).length;
                    
                    if (boxesTicked >= 3) {
                        currentSubjectDone++;
                    }
                });

                totalTrackableTopics += currentSubjectTrackable;
                totalDoneTopics += currentSubjectDone;
            });

            totalToReadTopics = totalTrackableTopics - totalDoneTopics;

            const donePercent = totalTrackableTopics > 0 ? (totalDoneTopics / totalTrackableTopics) * 100 : 0;
            const toReadPercent = 100 - donePercent;

            drawPieChart(donePercent);
            updateScheduleTable();

            document.getElementById('global-progress-done').textContent = `${donePercent.toFixed(1)}%`;
            document.getElementById('global-total-done-count').textContent = totalDoneTopics;
            
            document.getElementById('global-progress-toread').textContent = `${toReadPercent.toFixed(1)}%`;
            document.getElementById('global-total-toread-count').textContent = totalToReadTopics;
        }

        window.updateOverallDashboard = updateOverallDashboard;
        
        // Subject Logic Factory (Assumed to be defined in separate files like rem_logic.js)
        // ... (window.createSyllabusLogic and related helper functions omitted for brevity, assumed to be loaded by external scripts)

        // --- CALENDAR MODULE LOADER ---
        async function loadCalendarModule(url, targetElementId) {
            try {
                // In a real deployed environment, this would fetch the external file.
                // In this simulated environment, we assume the content is locally available
                // or use a mock fetch if necessary. Since the user uploaded the file
                // I will simulate its loading by fetching it by name.
                const response = await fetch(url);
                if (!response.ok) {
                    throw new Error(`Failed to load ${url}: ${response.statusText}`);
                }
                const htmlContent = await response.text();
                
                const target = document.getElementById(targetElementId);
                if (target) {
                    target.innerHTML = htmlContent;

                    // Execute the embedded script inside the module content
                    const scriptTag = target.querySelector('script');
                    if (scriptTag && scriptTag.textContent) {
                        eval(scriptTag.textContent);
                    }
                }
            } catch (error) {
                console.error("Error loading calendar module:", error);
                const target = document.getElementById(targetElementId);
                if (target) {
                    target.innerHTML = `<p class="text-red-500 p-4 bg-red-100 rounded-lg">Error loading calendar module: ${error.message}. Please ensure ${url} is accessible.</p>`;
                }
            }
        }


        // --- INITIALIZATION ---
        window.onload = () => {
            // 1. Initialize Countdown Dates
            COUNTDOWN_DATA.forEach(data => {
                const savedDate = localStorage.getItem(`comp_exam_date_${data.id}`);
                const finalDate = savedDate || data.targetDate;
                if (finalDate) {
                    data.targetDate = finalDate;
                    document.querySelector(`#target-date-display-${data.id} .date-text`).textContent = formatUniqueDate(finalDate);
                }
            });

            // Display today's date
            document.getElementById('today-date-display').textContent = getLocalDisplayDate();
            setInterval(() => {
                document.getElementById('today-date-display').textContent = getLocalDisplayDate();
            }, 60000); 

            // 2. Load Calendar Module (This must be awaited before starting subject loaders for proper flow)
            loadCalendarModule('reviewcalendar_module.html', 'calendar-module-placeholder');
            
            // 3. Load Subject Panels (Triggered after the Calendar is initialized)
            // Note: The subject logic files (e.g., 'rem_logic.js') are assumed to be present in the GitHub repository.
            // I've kept the original loader calls here:
            loadSubjectPanel('rem', 'rem_logic.js');
            loadSubjectPanel('crim', 'crim_logic.js');
            loadSubjectPanel('lab', 'lab_logic.js');
            loadSubjectPanel('civ', 'civ_logic.js');
            loadSubjectPanel('comm', 'comm_logic.js');
            loadSubjectPanel('poli', 'poli_logic.js');
            
            // 4. Initialize Lucide Icons for static content
            if (lucide && lucide.createIcons) {
                lucide.createIcons();
            }

            // 5. Attach General Event Listeners and load user name
            updateAllCountdowns();
            setInterval(updateAllCountdowns, 1000);
            
            loadUserName();
            
            setTimeout(window.updateOverallDashboard, 500); 
            
            document.getElementById('target-date-display-1').addEventListener('click', () => openModal(1));
            document.getElementById('target-date-display-2').addEventListener('click', () => openModal(2));
            document.getElementById('target-date-display-3').addEventListener('click', () => openModal(3));
            
            document.getElementById('modal-save-btn').addEventListener('click', saveModal);
            document.getElementById('modal-cancel-btn').addEventListener('click', closeModal);
            
            document.getElementById('message-modal-close-btn')?.addEventListener('click', closeMessageModal);
        };
    </script>
</body>
</html>
